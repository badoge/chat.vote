const arenaBetterAi={arena:null,firstInit:!0,consts:{halfAcrossMap:400,jumpThreshold:200,elevatorToTargetThreshold:322,elevatorHeightThreshold:80,enemyColorMap:{blue:"red",red:"blue"},characters:["chad","soy"]},elevators:[],floors:[{y:Number.MAX_SAFE_INTEGER,planks:[{fromX:-1,toX:Number.MAX_SAFE_INTEGER}]}],generic:{},behaviors:{melee:{},range:{}},classes:{},breatheLifeInto:t=>{const e=t.initializeBot;if(t.initializeBot=function(t){e.call(this,t),this.bot.isSmart=!0,this.bot.preferredRange=Math.max(40,Math.floor(.4*this.attack.speedX)),this.bot.nextSmartMove=t,this.bot.smartBehavior=arenaBetterAi.consts.characters[Math.floor(arenaBetterAi.consts.characters.length*Math.random())],this.bot.smartBehaviorChangeFunction=()=>{this.bot.smartBehaviorChangeCount-=1,this.bot.smartBehaviorChangeCount?(this.bot.smartBehavior=arenaBetterAi.consts.characters[Math.floor(arenaBetterAi.consts.characters.length*Math.random())],setTimeout(this.bot.smartBehaviorChangeFunction,this.bot.smartBehaviorToggleTimer)):this.bot.smartBehavior="chad"},this.bot.smartBehaviorToggleTimer=Math.floor(2e3+5e3*Math.random()),this.bot.smartBehaviorChangeCount=5+Math.floor(10*Math.random()),this.bot.smartBehaviorChangeFunction(),"priest"!==this.class&&(this.ability.availableAt=Date.now()+this.bot.nextAbility-t),this.canAttack=!1,this.timers.attackDelay=this.source.time.addEvent({delay:this.attackDelay*(1+2*Math.random()),callback:()=>{this.canAttack=!0}})},arenaBetterAi.classes.hasOwnProperty(t.class)){switch(t.processBotAction=function(t){"started"!==arenaBetterAi.arena.state||this.dead||this.bot.isPassive||this.bot.nextSmartMove>t||(arenaBetterAi.classes[this.class].call(this,t),this.bot.nextSmartMove=Math.max(this.bot.nextSmartMove,t+200))},t.class){case"paladin":t.originalTakeDamage=t.takeDamage,t.takeDamage=function(){return this.doAbility(),t.originalTakeDamage.apply(this,arguments)};break;case"rogue":t.originalTakeDamage=t.takeDamage,t.takeDamage=function(){if(!(Date.now()>this.ability.availableAt&&Math.random()<.7))return t.originalTakeDamage.apply(this,arguments);this.doAbility()};break;case"shaman":t.doAttack=()=>{};break}return t}},initialize:t=>{arenaBetterAi.firstInit&&(arenaBetterAi.firstInit=!1,arenaBetterAi.arena=t,t.aux.addUnitWithNoBrains=t.aux.addUnit,t.aux.addUnit=function(){const e=t.aux.addUnitWithNoBrains.apply(this,arguments);return e.originalSetControllable=e.setControllable,e.setControllable=function(){return e.originalTakeDamage&&(e.takeDamage=e.originalTakeDamage),e.originalSetControllable()},arenaBetterAi.breatheLifeInto(e)}),arenaBetterAi.elevators.length=0,arenaBetterAi.floors.length=1,arenaBetterAi.floors[0].y=t.params.height,t.groups.platforms.children.iterate((e=>{const a=e.getTopLeft(),r=e.getTopRight(),i=Math.ceil((a.y+r.y)/2);let o;for(o=arenaBetterAi.floors.length-1;o>=0;o--)if(arenaBetterAi.floors[o].y>=i){arenaBetterAi.floors[o].y>i&&arenaBetterAi.floors.splice(++o,0,{y:i,planks:[]});break}arenaBetterAi.floors[o].planks.push({y:i,fromX:Math.max(a.x,0),toX:Math.min(r.x,t.params.width)}),a.x>0&&a.x<t.params.width&&(a.jumpDirection=1,a.dropDirection=-1,arenaBetterAi.elevators.push(a)),r.x>0&&r.x<t.params.width&&(r.jumpDirection=-1,r.dropDirection=1,arenaBetterAi.elevators.push(r))})),arenaBetterAi.elevators.forEach((t=>{t.floor=0;for(let e=0;e<arenaBetterAi.floors.length;e++)Math.abs(arenaBetterAi.floors[e].y-t.y)<1&&(t.floor=e)})),arenaBetterAi.consts.elevatorToTargetThreshold=t.params.height/3,arenaBetterAi.consts.elevatorHeightThreshold=t.params.height/10,arenaBetterAi.consts.halfAcrossMap=.5*t.params.width,console.info("[ArenaBetterAi] Script loaded!")}};window.arenaBetterAi=arenaBetterAi,arenaBetterAi.classes.paladin=function(t){arenaBetterAi.behaviors.melee[this.bot.smartBehavior].call(this,t)},arenaBetterAi.classes.rogue=function(t){arenaBetterAi.behaviors.melee[this.bot.smartBehavior].call(this,t)},arenaBetterAi.classes.priest=function(t){this.hp<this.maxHP&&this.doAbility(),arenaBetterAi.behaviors.range[this.bot.smartBehavior].call(this,t)},arenaBetterAi.classes.hunter=function(t){if(arenaBetterAi.behaviors.range[this.bot.smartBehavior].call(this,t),this.bot.nextAbility<t){const e=arenaBetterAi.generic.getClosestUnitsInfoForRanged(this)[0];if(!e.unit||e.distance>600||e.distance<300)return;this.bot.nextAbility=t+this.ability.cooldown+1e3*Math.random(),this.doAbility()}},arenaBetterAi.classes.mage=function(t){this.bot.nextAbility<t&&(this.bot.nextAbility=t+this.ability.cooldown+1e3*Math.random(),this.doAbility()),arenaBetterAi.behaviors.range[this.bot.smartBehavior].call(this,t)},arenaBetterAi.classes.shaman=function(t){this.bot.nextAbility<t&&(this.bot.nextAbility=t+this.ability.cooldown+1e3*Math.random(),this.doAbility()),arenaBetterAi.behaviors.range.soy.call(this,t)},arenaBetterAi.behaviors.melee.chad=function(t){const e=arenaBetterAi.generic.getClosestUnitInfo(this);if(!e.unit)return;const a=Math.abs(e.dy);if(a>arenaBetterAi.consts.elevatorHeightThreshold){const a=arenaBetterAi.generic.findOptimalElevator(this,e.unit);if(!a)return this.bot.nextSmartMove=t+555,void this.doMove(Math.random()-.5);if(e.dy<0){if(Math.abs(a.jumpX-this.object.x)<30)return this.doMove(a.elevator.jumpDirection),this.doJump(),void(this.bot.nextSmartMove=t+1111);this.doMove(a.jumpX-this.object.x)}else{const e=a.dropX-this.object.x;this.doMove(Math.abs(e<50)?a.elevator.dropDirection:e),this.bot.nextSmartMove=t+888}}else e.unit.object.body.velocity.y<-arenaBetterAi.consts.jumpThreshold&&this.doJump(),this.doMove(Math.sign(e.dx)),Math.abs(e.dx)<this.bot.preferredRange&&a<10&&this.doAttack()},arenaBetterAi.behaviors.melee.soy=function(){const t=arenaBetterAi.generic.getClosestUnitInfo(this);if(t.unit){if(Math.abs(t.dx)<this.bot.preferredRange&&Math.abs(t.dy)<20)return this.doMove(Math.sign(t.dx)),void this.doAttack();if(t.distance<150)return this.doMove(-t.dx),void(Math.random()<.3&&this.doJump());this.doMove(1-2*Math.random()),Math.random()<.3&&this.doJump()}},arenaBetterAi.behaviors.range.chad=function(t){const e=arenaBetterAi.generic.getClosestUnitsInfoForRanged(this);let a=e[0].unit?e[0]:e[1];if(!a.unit)return;a.ady<10&&(this.doMove(Math.sign(a.dx)),this.doAttack());if(Math.abs(a.dy)>arenaBetterAi.consts.elevatorHeightThreshold){const e=arenaBetterAi.generic.findOptimalElevator(this,a.unit);if(!e)return this.bot.nextSmartMove=t+555,void this.doMove(Math.random()-.5);if(a.dy<0){if(Math.abs(e.jumpX-this.object.x)<30)return this.doMove(e.elevator.jumpDirection),this.doJump(),void(this.bot.nextSmartMove=t+1111);this.doMove(e.jumpX-this.object.x)}else{const a=e.dropX-this.object.x;this.doMove(Math.abs(a<50)?e.elevator.dropDirection:a),this.bot.nextSmartMove=t+888}}else if(a=e[1].unit?e[1]:e[0],a.unit){if(a.distance<this.bot.preferredRange){let t=-a.dx;return this.object.x<this.bot.preferredRange&&(t=1),this.object.x>arenaBetterAi.arena.params.width-this.bot.preferredRange&&(t=-1),this.doMove(t),void(Math.random()<.5&&this.doJump())}this.doMove(0)}},arenaBetterAi.behaviors.range.soy=function(){const t=arenaBetterAi.generic.getClosestUnitsInfoForRanged(this);let e=t[0].unit?t[0]:t[1];if(e.unit){if(Math.abs(e.dy)<20&&(this.doMove(Math.sign(e.dx)),this.doAttack()),e=t[1].unit?t[1]:t[0],e.distance<this.bot.preferredRange){let t=-e.dx;return this.object.x<this.bot.preferredRange&&(t=1),this.object.x>arenaBetterAi.arena.params.width-this.bot.preferredRange&&(t=-1),this.doMove(t),void(Math.random()<.5&&this.doJump())}this.doMove(1-2*Math.random()),Math.random()<.3&&this.doJump()}},arenaBetterAi.generic.getDistanceInfo=function(t,e){const a={unit:e};return a.dx=e.object.x-t.object.x,a.dy=e.object.y-t.object.y,a.distance=Math.sqrt(a.dx*a.dx+a.dy*a.dy),a},arenaBetterAi.generic.getDistanceToElevator=function(t,e){const a={elevator:e};return a.dx=e.x-t.object.x,a.dy=e.y-t.object.y,a.distance=Math.sqrt(a.dx*a.dx+a.dy*a.dy),a},arenaBetterAi.generic.getSimpleDistanceToElevator=function(t,e){let a=e.x-t.object.x,r=e.y-t.object.y;return Math.sqrt(a*a+r*r)},arenaBetterAi.generic.getMultiUnitFloor=function(){const t=new Array(arguments.length).fill(0);for(let e=0;e<arenaBetterAi.floors.length;e++)for(let a=0;a<arguments.length;a++)arguments[a].object.y<arenaBetterAi.floors[e].y&&(t[a]=e);return t},arenaBetterAi.generic.findOptimalElevator=function(t,e){const a={elevator:{bad:1},distance:Number.MAX_SAFE_INTEGER,dToTarget:Number.MAX_SAFE_INTEGER,dToUnit:Number.MAX_SAFE_INTEGER},r={elevator:{bad:1},distance:Number.MAX_SAFE_INTEGER,dToTarget:Number.MAX_SAFE_INTEGER,dToUnit:Number.MAX_SAFE_INTEGER},i=e.object.x>t.object.x?[t.object.x,e.object.x]:[e.object.x,t.object.x],o=arenaBetterAi.generic.getMultiUnitFloor(t,e);if(o[0]===o[1])return null;const n=o[0]<o[1];Math.abs(o[0]-o[1]);arenaBetterAi.elevators.forEach((o=>{if(n?t.object.y-o.y<0:o.y-t.object.y<-20)return;if(o.x<=i[1]&&o.x>=i[0]){let t=arenaBetterAi.generic.getSimpleDistanceToElevator(e,o);t<r.dToTarget&&(r.elevator=o,r.dToTarget=t)}let s=arenaBetterAi.generic.getSimpleDistanceToElevator(t,o);s<a.dToUnit&&(a.elevator=o,a.dToUnit=s)}));const s=r.elevator.bad?a:r;if(s.bad)return null;const h=arenaBetterAi.generic.getDistanceToElevator(t,s.elevator);return h.jumpX=s.elevator.x-.6*t.speed*h.elevator.jumpDirection,h.dropX=s.elevator.x+10*h.elevator.dropDirection,h},arenaBetterAi.generic.getClosestUnitInfo=function(t){const e=t.team||"~~~";let a={unit:null,distance:Number.MAX_SAFE_INTEGER};const r=r=>{if(r===t||r.dead||r.team===e)return;const i=arenaBetterAi.generic.getDistanceInfo(t,r);a.distance>i.distance&&(a=i)};return arenaBetterAi.arena.units.forEach(r),arenaBetterAi.arena.teams.red.units.forEach(r),arenaBetterAi.arena.teams.blue.units.forEach(r),arenaBetterAi.arena.summons.forEach(r),a},arenaBetterAi.generic.getClosestUnitsInfoForRanged=function(t){const e=t.team||"~~~";let a={unit:null,ady:Number.MAX_SAFE_INTEGER},r={unit:null,distance:Number.MAX_SAFE_INTEGER};const i=i=>{if(i===t||i.dead||i.team===e)return;const o=arenaBetterAi.generic.getDistanceInfo(t,i);o.ady=Math.abs(o.dy),r.distance>o.distance&&(r=o),(a.ady>o.ady||a.ady==o.ady&&a.distance>o.distance)&&(a=o)};return arenaBetterAi.arena.units.forEach(i),arenaBetterAi.arena.teams.red.units.forEach(i),arenaBetterAi.arena.teams.blue.units.forEach(i),arenaBetterAi.arena.summons.forEach(i),[a,r]};