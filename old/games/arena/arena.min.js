let loginButton,loginExpiredModal,aboutModal,elements={grid:document.getElementById("grid"),gameDiv:document.getElementById("gameDiv"),loginExpiredModal:document.getElementById("loginExpiredModal"),aboutModal:document.getElementById("aboutModal"),status:document.getElementById("status"),topRight:document.getElementById("topRight"),loginButton:document.getElementById("loginButton"),channelName:document.getElementById("channelName"),darkTheme:document.getElementById("darkTheme"),toastContainer:document.getElementById("toastContainer")},darkTheme=!0,USER={channel:"",twitchLogin:!1,access_token:"",userID:"",platform:""};function handleMessage(e,a,t,n){let r=t.split(" ").filter(Boolean);if("!join"==r[0]&&r[1]||"DonkRogue"==r[0]||"DonkHunter"==r[0]||"DonkMage"==r[0]||"DonkPaladin"==r[0]||"DonkPriest"==r[0]||"DonkShaman"==r[0]){let e="";if(e="!join"==r[0]?r[1].toLowerCase():r[0],arena.aux.findUnitByName(a.username))return;switch(e){case"rogue":case"DonkRogue":arena.aux.addUnit(a.username,a.color||"#FFFFFF","rogue");break;case"hunter":case"DonkHunter":arena.aux.addUnit(a.username,a.color||"#FFFFFF","hunter");break;case"mage":case"DonkMage":arena.aux.addUnit(a.username,a.color||"#FFFFFF","mage");break;case"paladin":case"DonkPaladin":arena.aux.addUnit(a.username,a.color||"#FFFFFF","paladin");break;case"priest":case"DonkPriest":arena.aux.addUnit(a.username,a.color||"#FFFFFF","priest");break;case"shaman":case"DonkShaman":arena.aux.addUnit(a.username,a.color||"#FFFFFF","shaman");break;default:break}}}window.onload=function(){darkTheme="true"===(localStorage.getItem("darkTheme")||"true"),elements.darkTheme.checked=darkTheme??!0,switchTheme(elements.darkTheme.checked),loadAndConnect(),USER.channel||(loginButton=new bootstrap.Popover(elements.loginButton)),loginExpiredModal=new bootstrap.Modal(elements.loginExpiredModal),aboutModal=new bootstrap.Modal(elements.aboutModal),enableTooltips(),enablePopovers(),elements.channelName.addEventListener("keydown",(e=>{"Enter"===e.key&&connect()})),elements.darkTheme.onchange=function(){switchTheme(this.checked),saveSettings()}};let arenaSetup={chatters:[],params:{showUnitNames:!0,unitScale:.75,exponentialSoundLevels:!0,notify:!0,notifyDuration:3333,killfeed:!0,killFeedDuration:3333,killFeedHardLimit:69,width:1280,height:720,style:"",parent:"div#game"},settings:{goFullscreenOnStart:!1,exitFullscreenOnEnd:!1,unitLimit:999,allowNewUnitsAfterStart:!1,playerCanWalkWhileFreezeTime:!1,music:!0,musicVolume:.3,sound:!0,soundVolume:.6},resources:{image:{sky:"/games/pics/arena-bg.png",ground:"/games/pics/arena-longbar.png","fs-in":"/games/pics/go-fullscreen.png","fs-out":"/games/pics/exit-fullscreen.png","icon-blink":"/games/pics/icon-blink.png","icon-grenade":"/games/pics/icon-grenade.png","icon-heal":"/games/pics/icon-heal.png","icon-meteor":"/games/pics/icon-meteor.png","icon-summon":"/games/pics/icon-summon.png","icon-repel":"/games/pics/icon-repel.png",rogue:"/games/pics/donk-rogue.png",hunter:"/games/pics/donk-hunter.png",mage:"/games/pics/donk-mage.png",paladin:"/games/pics/donk-paladin.png",priest:"/games/pics/donk-priest.png",shaman:"/games/pics/donk-shaman.png",dummy:"/games/pics/megalul.png"},audio:{"dummy-attack":"/games/arena/audio/rogue-attack.mp3","dummy-hit":"/games/arena/audio/rogue-hit.mp3","rogue-attack":"/games/arena/audio/rogue-attack.mp3","hunter-attack":"/games/arena/audio/hunter-attack.mp3","mage-attack":"/games/arena/audio/mage-attack.mp3","rogue-hit":"/games/arena/audio/rogue-hit.mp3","hunter-hit":"/games/arena/audio/hunter-hit.mp3","mage-hit":"/games/arena/audio/mage-hit.mp3","paladin-attack":"/games/arena/audio/paladin-attack.mp3","paladin-hit":"/games/arena/audio/paladin-hit.mp3","priest-attack":"/games/arena/audio/priest-attack.mp3","priest-hit":"/games/arena/audio/priest-hit.mp3","shaman-attack":"/games/arena/audio/mage-attack.mp3","shaman-hit":"/games/arena/audio/mage-hit.mp3","unit-death":"/games/arena/audio/unit-death.mp3",heal:"/games/arena/audio/heal.mp3",blink:"/games/arena/audio/blink.mp3",grenade:"/games/arena/audio/grenade.mp3","grenade-explode":"/games/arena/audio/grenade-impact.mp3",meteor:"/games/arena/audio/meteor.mp3",repel:"/games/arena/audio/repel.mp3","arena-ost":{resources:["/games/arena/audio/arena-ost-full.mp3"],spritemap:{"ost-main-begin":{start:123.4,end:136.303,loop:!1},"ost-main-loop":{start:136.303,end:148.15,loop:!0},"ost-suspense-begin":{start:171.58,end:171.93,loop:!1},"ost-suspense-loop":{start:171.93,end:189.72,loop:!0},"ost-finale-begin":{start:189.72,end:189.72,loop:!1},"ost-finale-loop":{start:189.72,end:201.58,loop:!0}}},"arena-end":"/games/arena/audio/arena-end.mp3"},spritesheet:{"hit-melee":["/games/pics/hit-melee.png",{frameWidth:32,frameHeight:32}],"hit-bullet":["/games/pics/hit-bullet.png",{frameWidth:16,frameHeight:16}],"hit-fireball":["/games/pics/hit-fireball.png",{frameWidth:32,frameHeight:32}],"hit-weakmagic":["/games/pics/hit-weakmagic.png",{frameWidth:24,frameHeight:24}],"abil-blink":["/games/pics/blink2.png",{frameWidth:64,frameHeight:64}],"abil-grenade":["/games/pics/grenade-flying.png",{frameWidth:16,frameHeight:16}],meteor:["/games/pics/meteor.png",{frameWidth:64,frameHeight:64}],"meteor-smoke":["/games/pics/meteor-smoke.png",{frameWidth:64,frameHeight:64}],explosion:["/games/pics/explosion.png",{frameWidth:128,frameHeight:128}]}},callbacks:{arenaStart:()=>{},unitDied:(e,a,t)=>{},arenaEnd:e=>{},arenaRestart:()=>{}},reset:function(){arena.aux.resetArena(),html.startBtn.disabled=!1,html.streamerRogue.disabled=!1,html.streamerHunter.disabled=!1,html.streamerMage.disabled=!1,html.streamerPaladin.disabled=!1,html.streamerPriest.disabled=!1,html.streamerShaman.disabled=!1,html.addBotBtn.disabled=!1,html.bulkAddBotBtn.disabled=!1}};const html={killfeed:document.querySelector("#killfeed"),autoFullscreenInput:document.querySelector("input#bAutoFullscreen"),teamModeInput:document.querySelector("input#bTeamMode"),streamerRogue:document.querySelector("button#streamerRogue"),streamerHunter:document.querySelector("button#streamerHunter"),streamerMage:document.querySelector("button#streamerMage"),streamerPaladin:document.querySelector("button#streamerPaladin"),streamerPriest:document.querySelector("button#streamerPriest"),streamerShaman:document.querySelector("button#streamerShaman"),startBtn:document.querySelector("button#bStartGame"),addBotBtn:document.querySelector("button#bAddBot"),bulkAddBotBtn:document.querySelector("button#bAddBots"),addPassiveBotBtn:document.querySelector("button#bAddDummies"),cleanUpBtn:document.querySelector("button#bCleanUp")};html.startBtn.addEventListener("click",(()=>{try{arena.aux.startArena(),html.startBtn.disabled=!0,html.streamerRogue.disabled=!0,html.streamerHunter.disabled=!0,html.streamerMage.disabled=!0,html.streamerPaladin.disabled=!0,html.streamerPriest.disabled=!0,html.streamerShaman.disabled=!0}catch(e){showToast(e,"warning",3e3)}})),html.addBotBtn.addEventListener("click",(()=>{let e=document.querySelector("input#sBotName").value.trim();document.querySelector("input#sBotName").value="";let a=document.querySelector("select#sBotClass").value.toLowerCase();try{let t=Math.round(Math.random())?"yellow":null;arena.aux.addUnit(e,t,a)}catch(e){showToast(e,"warning",3e3)}})),html.bulkAddBotBtn.addEventListener("click",(()=>{let e=parseInt(document.getElementById("botsNumber").value,10);if(isNaN(e))console.warn("Bulk add: User input is NaN");else for(arena.settings.unitLimit&&e>arena.settings.unitLimit&&(showToast("You've requested too many units! \nWill spawn as many as possible instead.","warning",6e3),e=arena.settings.unitLimit);e>0;){e-=1;try{arena.aux.addUnit()}catch(e){}}})),html.autoFullscreenInput.addEventListener("change",(e=>{arena.settings.exitFullscreenOnEnd=e.target.checked,arena.settings.goFullscreenOnStart=e.target.checked})),html.cleanUpBtn.addEventListener("click",(()=>{arena.aux.resetArena(),html.startBtn.disabled=!1,html.streamerRogue.disabled=!1,html.streamerHunter.disabled=!1,html.streamerMage.disabled=!1,html.streamerPaladin.disabled=!1,html.streamerPriest.disabled=!1,html.streamerShaman.disabled=!1})),html.streamerRogue.addEventListener("click",(()=>{arena.player&&(arena.player.destroy(),arena.player=null);try{arena.aux.addPlayer(USER.channel,"#FF0000","rogue")}catch(e){showToast(e,"warning",3e3)}})),html.streamerHunter.addEventListener("click",(()=>{arena.player&&(arena.player.destroy(),arena.player=null);try{arena.aux.addPlayer(USER.channel,"#FF0000","hunter")}catch(e){showToast(e,"warning",3e3)}})),html.streamerMage.addEventListener("click",(()=>{arena.player&&(arena.player.destroy(),arena.player=null);try{arena.aux.addPlayer(USER.channel,"#FF0000","mage")}catch(e){showToast(e,"warning",3e3)}})),html.streamerPaladin.addEventListener("click",(()=>{arena.player&&(arena.player.destroy(),arena.player=null);try{arena.aux.addPlayer(USER.channel,"#FF0000","paladin")}catch(e){showToast(e,"warning",3e3)}})),html.streamerPriest.addEventListener("click",(()=>{arena.player&&(arena.player.destroy(),arena.player=null);try{arena.aux.addPlayer(USER.channel,"#FF0000","priest")}catch(e){showToast(e,"warning",3e3)}})),html.streamerShaman.addEventListener("click",(()=>{arena.player&&(arena.player.destroy(),arena.player=null);try{arena.aux.addPlayer(USER.channel,"#FF0000","shaman")}catch(e){showToast(e,"warning",3e3)}})),document.querySelector("#sSound").addEventListener("input",(e=>{arena.settings.soundVolume=e.target.value/100,document.getElementById("sSoundlabel").innerHTML=e.target.value})),document.querySelector("#sMusic").addEventListener("input",(e=>{arena.settings.musicVolume=e.target.value/100,document.getElementById("sMusiclabel").innerHTML=e.target.value})),html.teamModeInput.addEventListener("change",(e=>{arena.aux.toggleTeamMode(e.target.checked)})),arenaSetup.callbacks.unitDied=(e,a,t)=>{const n=document.createElement("div");n.classList.add("killfeed-line"),n.innerHTML=`\n    <span style="color: ${a?a.color:"white"};">${a?a.name:""}</span>\n    <span style="color: white;">${t}</span>\n    <span style="color: ${e?e.color:"white"};">${e?e.name:""}</span>`,html.killfeed.appendChild(n),setTimeout((()=>n.remove()),3e3)},arenaSetup.callbacks.arenaEnd=e=>{console.log("The champion is: ",e),document.querySelectorAll("div#controls > div.control-line").forEach((e=>e.style.display=""))},arenaSetup.callbacks.arenaRestart=()=>{arenaBetterAi.initialize(arena)};