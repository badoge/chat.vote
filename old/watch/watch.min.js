let client,modal1,modal2,modal3,player,chat,pausetime,done=!1,latency=0,input=new URLSearchParams(window.location.search),channel=input.get("c"),video=input.get("v"),time=parseInt(input.get("t")),secs=Math.floor(Date.now()/1e3-time),elements={toastContainer:document.getElementById("toastContainer")};function connect(){let e={options:{clientId:CLIENT_ID,debug:!1},connection:{secure:!0,reconnect:!0},channels:[channel]};client=new tmi.client(e),client.on("message",(function(e,t,n,o){if(!n.startsWith("="))return;let a=n.replace("=","").split(" ").filter(Boolean),l=a.slice(1),c=a[0].toLowerCase(),i=0;if("pause"==c&&t.username==channel)return player.pauseVideo(),void(pausetime=Math.floor(Date.now()/1e3));if("play"==c&&t.username==channel)return player.playVideo(),void(time+=Math.floor(Date.now()/1e3)-pausetime);if("rewind"==c&&t.username==channel)return i=null==l[0]?5:parseInt(l[0]),time+=i,void sync();if("skip"==c&&t.username==channel)return i=null==l[0]?5:parseInt(l[0]),time-=i,void sync()})),client.on("connected",(async function(e,t){console.log(`Connected to ${e}:${t}`)})),client.connect().catch(console.error)}function sync(){if(chat.isPaused())return void modal3.show();null!=localStorage.getItem("channel")&&localStorage.getItem("channel")==channel||(latency=parseInt(Math.ceil(chat.getPlaybackStats().hlsLatencyBroadcaster)));let e=Math.floor(Date.now()/1e3-time)-latency;player.seekTo(e,!0)}function embedchat(){chat=new Twitch.Embed("twitch-embed",{width:"100%",height:"100%",channel:channel,allowfullscreen:"false",parent:["chat.vote"]})}function embedvideo(){let e=document.createElement("script");e.src="https://www.youtube.com/iframe_api";let t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}function onYouTubeIframeAPIReady(){player=new YT.Player("player",{height:"100%",width:"100%",videoId:video,playerVars:{playsinline:1},events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}})}function onPlayerReady(e){e.target.playVideo()}function onPlayerStateChange(e){e.data!=YT.PlayerState.PLAYING||done||(e.target.seekTo(secs,!0),done=!0)}function copyToClipboard(){let e=document.getElementById("roomurl");e.select(),e.setSelectionRange(0,99999),navigator.clipboard.writeText(e.value)}function getvidid(e){let t=e.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/);return!(!t||11!=t[7].length)&&t[7]}function getlink(){let e=document.getElementById("channelname").value.replace(/\s+/g,"").toLowerCase(),t=document.getElementById("videolink").value;if(!e)return void showToast("No Twitch channel provided","warning",3e3);if(!t)return void showToast("No YouTube video provided","warning",3e3);let n="https://chat.vote/watch/?";n+="c="+e;let o=getvidid(t);n+="&v="+o;let a=Math.floor(Date.now()/1e3)+10;n+="&t="+a,document.getElementById("modal1body").innerHTML=`\n  <h5>Here is your room URL, Share it with your viewers :)</h5>\n  <div class="input-group mb-3">\n  <input type="text" id="roomurl" class="form-control" value=${n} aria-label="Room URL">\n  <button class="btn btn-outline-secondary" type="button" onclick="copyToClipboard()"><i class="material-icons notranslate">content_copy</i></button>\n  </div>\n  <div id="countdown">\n  <h6>Watch party starts in:<h6>\n  <div class="values text-warning"></div>\n  </div>`;let l=new easytimer.Timer;l.start({countdown:!0,startValues:{seconds:10}}),document.querySelector("#countdown .values").innerHTML=l.getTimeValues().toString(),l.addEventListener("secondsUpdated",(function(e){document.querySelector("#countdown .values").innerHTML=l.getTimeValues().toString()})),l.addEventListener("targetAchieved",(function(e){window.location.replace(n)}))}window.onload=function(){modal1=new bootstrap.Modal(document.getElementById("modal1")),modal2=new bootstrap.Modal(document.getElementById("modal2")),modal3=new bootstrap.Modal(document.getElementById("modal3")),null!=localStorage.getItem("channel")&&(document.getElementById("channelname").value=localStorage.getItem("channel")),null==input||null==channel||null==video?modal1.show():(embedvideo(),embedchat(),connect())};