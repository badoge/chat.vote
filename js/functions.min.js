const CLIENT_ID="qn0wimnszbqlwfnszdz3wwfz430eqr",CLIENT_ID_YT="975425654977-2ckljuapg94eukqrnm1rgqup5npo95m9.apps.googleusercontent.com",API_KEY_YT="AIzaSyAMCaIslOwxlmotLsNN4NB2ia949h4GLP0",GETrequestOptions={method:"GET",redirect:"follow"},spinner='<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>';let channelBadges={subscriber:[],bits:[]},globalBadges={},customBadges=[];async function get7TVPFP(e){return e?new Promise((async function(t,a){try{let a=await fetch(`https://7tv.io/v3/users/twitch/${e}`,GETrequestOptions);200!==a.status&&t("/pics/donk.png");let o=await a.json();t(o?.user?.avatar_url?o.user.avatar_url:"/pics/donk.png")}catch(e){t("/pics/donk.png"),console.log("getprofilepic 7tv error",e)}})):"/pics/donk.png"}async function getTwitchPFP(e,t){let a=new Headers;a.append("client-id",CLIENT_ID),a.append("Authorization",`Bearer ${t}`);let o={method:"GET",headers:a,redirect:"follow"};return new Promise((async function(t,a){try{let a=await fetch(`https://api.twitch.tv/helix/users?login=${e}`,o);t((await a.json()).data[0].profile_image_url)}catch(e){t("/pics/donk.png"),console.log("getprofilepic twitch error",e)}}))}async function getGlobalTwitchEmotes(e=!1){let t=[];try{let a=await fetch("https://api.okayeg.com/emotes/global",GETrequestOptions),o=await a.json(),n=["R-)",";-p",";p",";-P",":-p",":p",":-P",";-)",":-\\",":\\",":-/",":-o",":o",":-O","8-)","B-)","o.o","o_o","o.O","o_O","O.O","O_O","O.o",":-Z",":Z",":-z",":z",":-|",":-D",":-(",":-)"];for(let a=0,s=o.data.length;a<s;a++)n.includes(o.data[a].name)||t.push({name:o.data[a].name,url:`https://static-cdn.jtvnw.net/emoticons/v2/${o.data[a].id}/default/dark/${e?"3.0":"1.0"}`});return t}catch(e){return console.log("getGlobalTwitchEmotes error",e),[]}}async function getGlobalBTTVEmotes(e=!1){let t=[],a=["SoSnowy","IceCold","SantaHat","TopHat","ReinDeer","CandyCane","cvMask","cvHazmat"];try{let o=await fetch("https://api.betterttv.net/3/cached/emotes/global",GETrequestOptions),n=await o.json();for(let o=0,s=n.length;o<s;o++)t.push({name:n[o].code,url:`https://cdn.betterttv.net/emote/${n[o].id}/${e?"3x":"1x"}`,zerowidth:a.includes(n[o].code)});return t}catch(e){return console.log("getGlobalBTTVEmotes error",e),[]}}async function getGlobalFFZEmotes(e=!1){let t=[];try{let a=await fetch("https://api.frankerfacez.com/v1/set/global",GETrequestOptions),o=await a.json();for(let a=0;a<o.default_sets.length;a++){let n=o.default_sets[a];for(let a=0,s=o.sets[n].emoticons.length;a<s;a++){let s=o.sets[n].emoticons[a],r=s.urls[e?"4":"1"];s.animated&&(r=s.animated[e?"4":"1"]),t.push({name:s.name,url:r,zerowidth:!1})}}return t}catch(e){return console.log("getGlobalFFZEmotes error",e),[]}}async function getGlobal7TVEmotes(e=!1){let t=[];try{let a=await fetch("https://7tv.io/v3/emote-sets/global",GETrequestOptions),o=await a.json();for(let a=0,n=o.emotes.length;a<n;a++){let n=o.emotes[a].data.host.files.filter((e=>"AVIF"==e.format));t.push({name:o.emotes[a].name,url:`${o.emotes[a].data.host.url}/${n[e?3:0].name}`,zerowidth:1==o.emotes[a].flags})}return t}catch(e){return console.log("getGlobal7TVEmotes error",e),[]}}async function getEmoji(){let e=[];try{let t=await fetch("/games/emoji.json",GETrequestOptions),a=await t.json();for(let t=0,o=a.length;t<o;t++)e.push({name:a[t].emoji,desc:a[t].description,url:"emoji"});return e}catch(e){return console.log("getEmoji error",e),[]}}async function getChannelTwitchEmotes(e,t=!1){let a=[];try{let o=await fetch(`https://api.okayeg.com/emotes?channel=${e}`,GETrequestOptions),n=await o.json();if(n.data.id&&n.data.emotes.length>0){for(let e=0,o=n.data.emotes.length;e<o;e++)a.push({name:n.data.emotes[e].name,url:`https://static-cdn.jtvnw.net/emoticons/v2/${n.data.emotes[e].id}/default/dark/${t?"3.0":"1.0"}`});return a}}catch(e){return console.log("getChannelTwitchEmotes error",e),[]}}async function getChannelBTTVEmotes(e,t=!1){if(!e)return[];let a=[];try{let o=await fetch(`https://api.betterttv.net/3/cached/users/twitch/${e}`,GETrequestOptions);if(200!==o.status)return[];let n=await o.json();if("user not found"!=n?.message){for(let e=0,o=n.channelEmotes.length;e<o;e++)a.push({name:n.channelEmotes[e].code,url:`https://cdn.betterttv.net/emote/${n.channelEmotes[e].id}/${t?"3x":"1x"}`,zerowidth:!1});for(let e=0,o=n.sharedEmotes.length;e<o;e++)a.push({name:n.sharedEmotes[e].code,url:`https://cdn.betterttv.net/emote/${n.sharedEmotes[e].id}/${t?"3x":"1x"}`,zerowidth:!1});return a}return[]}catch(e){return console.log("getChannelBTTVEmotes error",e),[]}}async function getChannelFFZEmotes(e,t=!1){let a=[];try{let o=await fetch(`https://api.frankerfacez.com/v1/room/id/${e}`,GETrequestOptions);if(200!==o.status)return[];let n=await o.json(),s=n.room.set,r=n.sets[s];for(let e=0,o=r.emoticons.length;e<o;e++){let o=r.emoticons[e].urls[t?"4":"1"];r.emoticons[e].animated&&(o=r.emoticons[e].animated[t?"4":"1"]),a.push({name:r.emoticons[e].name,url:o,zerowidth:!1})}return a}catch(e){return console.log("getChannelFFZEmotes error",e),[]}}async function getChannel7TVEmotes(e,t=!1){if(!e)return[];let a=[];try{let o=await fetch(`https://7tv.io/v3/users/twitch/${e}`,GETrequestOptions);if(200!==o.status)return[];let n=await o.json();for(let e=0,o=n.emote_set.emotes.length;e<o;e++){let o=n.emote_set.emotes[e].data.host.files.filter((e=>"AVIF"==e.format));a.push({name:n.emote_set.emotes[e].name,url:`${n.emote_set.emotes[e].data.host.url}/${o[t?3:0].name}`,zerowidth:1==n.emote_set.emotes[e].flags})}return a}catch(e){return console.log("getChannel7TVEmotes error",e),[]}}function showToast(e,t,a){let o=Date.now(),n=`<div id="${o}" class="toast align-items-center text-bg-${t} border-0" role="alert" data-bs-autohide="false" aria-live="assertive" aria-atomic="true">\n      <div class="d-flex">\n      <div class="toast-body" style="font-size:1.2em">${e}</div>\n      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n      </div>\n      </div>`;elements.toastContainer.innerHTML+=n;let s=[].slice.call(document.querySelectorAll(".toast")).map((function(e){return new bootstrap.Toast(e,{animation:!1,autohide:!1})}));s[s.length-1].show(),setTimeout((function(){s[s.length-1].hide(),document.getElementById(o).remove()}),a)}async function checkTags(e,t){if(!t||!e)return!1;let a=new Headers;a.append("client-id",CLIENT_ID),a.append("Authorization",`Bearer ${t}`);let o={method:"GET",headers:a,redirect:"follow"};return new Promise((async function(t,a){try{let a=await fetch(`https://api.twitch.tv/helix/channels?broadcaster_id=${e}`,o),n=await a.json();if(!n.data[0].tags||0==n.data[0].tags.length)return;let s=["브이튜버","pngtuber","버튜버","버츄얼","vstreamer","ｖtuber","live2d"];for(let e=0;e<n.data[0].tags.length;e++){let a=n.data[0].tags[e].toLowerCase();a.includes("vtube")&&t(!0),s.includes(a)&&t(!0)}t(!1)}catch(e){t(!1),console.log("checkTags error",e)}}))}async function getUserID(e){try{let t=await fetch(`https://helper.donk.workers.dev/twitch/users?login=${e}`,GETrequestOptions);return(await t.json())?.data[0]?.id||""}catch(e){return""}}async function getStreamerColor(e){try{let t=await fetch(`https://helper.donk.workers.dev/twitch/chat/color?user_id=${e}`,GETrequestOptions);return(await t.json())?.data[0]?.color||"#FFFFFF"}catch(e){return console.log("getStreamerColor error",e),"#FFFFFF"}}async function sendUsername(e,t,a,o=null){let n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({site:e,channel:t,platform:a,stream:o}),redirect:"follow"};try{let e=await fetch("https://helper.donk.workers.dev/log/username",n);console.log("sendUsername response",e.status)}catch(e){console.log("sendUsername error",e)}}async function sendData(e,t,a,o,n=null){if(!t)return;let s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({site:e,channel:t,platform:a,data:o,stream:n}),redirect:"follow"};try{let e=await fetch("https://helper.donk.workers.dev/log/data",s);console.log("sendData response",e.status)}catch(e){console.log("sendData error",e)}}function showConfetti(e){let t,a,o;switch(parseInt(e,10)){case 1:t=100,a=1,o=1e3;break;case 2:t=500,a=2,o=2e3;break;case 3:t=1e3,a=3,o=3e3;break;case 4:t=1e4,a=5,o=5e3;break;default:return}confetti.maxCount=t,confetti.speed=a,confetti.start(o)}async function getChannelBadges(e){return new Promise((async function(t,a){try{let a=await fetch(`https://api.okayeg.com/emotes?channel=${e}`,GETrequestOptions),o=await a.json();o.data.badges&&0!=o.data.badges.length||t({subscriber:[],bits:[]});let n={subscriber:[],bits:[]};if(o.data.badges.length>0){let e=[],a=[];o.data.badges[0]&&("subscriber"==o.data.badges[0].set_id&&(e=o.data.badges[0].versions),"bits"==o.data.badges[0].set_id&&(a=o.data.badges[0].versions)),o.data.badges[1]&&("subscriber"==o.data.badges[1].set_id&&(e=o.data.badges[1].versions),"bits"==o.data.badges[1].set_id&&(a=o.data.badges[1].versions));for(let t=0,a=e.length;t<a;t++)n.subscriber.push({id:e[t].id,url:e[t].image_url_4x});for(let e=0,t=a.length;e<t;e++)n.bits.push({id:a[e].id,url:a[e].image_url_4x});t(n)}}catch(e){console.log("getChannelBadges error",e),t({subscriber:[],bits:[]})}}))}async function getGlobalBadges(){return new Promise((async function(e,t){try{let t=await fetch("https://api.okayeg.com/badges/global",GETrequestOptions),a=await t.json();if(a.data&&0!=a.data.length||e({}),a.data.length>0){let t={};for(let e=0,o=a.data.length;e<o;e++)t[a.data[e].set_id]=a.data[e].versions;e(t)}}catch(t){console.log("getGlobalBadges error",t),e({})}}))}async function getCustomBadges(){return new Promise((async function(e,t){try{let t=await fetch("https://badges.donk.workers.dev",GETrequestOptions),a=await t.json();a&&0!=a.length||e([]),e(a)}catch(t){console.log("getCustomBadges error",t),e([])}}))}async function loadBadges(e){0==Object.keys(globalBadges).length&&(globalBadges=await getGlobalBadges()),0==channelBadges.subscriber.length&&(channelBadges=await getChannelBadges(e)),0==customBadges.length&&(customBadges=await getCustomBadges())}function addBadges(e,t,a=null){try{let o="";a&&(o+='<i class="material-icons notranslate" style="color:#f18805;" title="First-time chatter">warning_amber</i>');for(let e=0;e<customBadges.length;e++)customBadges[e].users.includes(t)&&customBadges[e].sites.includes("chat.vote")&&(o+=`<img src="${customBadges[e].url}" class="chat-badge" title="${customBadges[e].name}"/>`);if("streamer"==e)return o+='<img src="https://static-cdn.jtvnw.net/badges/v1/5527c58c-fb7d-422d-b71b-f309dcb85cc1/3" class="chat-badge" title="Broadcaster"/>',o;for(const t in e)if("subscriber"==t&&e.subscriber&&channelBadges.subscriber.length>0){o+=`<img src="${channelBadges.subscriber.find((t=>t.id===e.subscriber)).url}" class="chat-badge" title="Subscriber"/>`}else if("bits"==t&&channelBadges.bits.length>0){o+=`<img src="${channelBadges.bits.find((t=>t.id===e.bits)).url}" class="chat-badge" title="Bits"/>`}else if(Object.keys(globalBadges).length>0){o+=`<img src="${globalBadges[t].find((a=>a.id===e[t])).image_url_4x}" class="chat-badge" title="${t}"/>`}return o}catch(e){return console.log(e),""}}function replaceEmotes(e,t){if(e=e.split(" "),0!=t.length)for(let a=0,o=e.length;a<o;a++)for(let o=0,n=t.length;o<n;o++)e[a]==t[o].name&&(t[o].zerowidth?e[a]=`<img title="${t[o].name}" alt="${t[o].name}" src="${t[o].url}" \n            style="height:1.5em; margin-left:${0==a?"0px":"-24px"}">`:e[a]=`<img title="${t[o].name}" alt="${t[o].name}" src="${t[o].url}" style="height:1.5em;">`);return e.join(" ")}function changeSiteLinkTarget(e){let t=document.getElementsByClassName("site-link");for(let a=0;a<t.length;a++)t[a].setAttribute("target",e)}function switchGame(e){switch(e){case"draw":location.href="/games/draw";break;case"arena":location.href="/games/arena";break;case"eb":location.href="/games/emotes";break;case"dh":location.href="/games/donkhunt";break;case"shapes":location.href="/games/shapes";break;case"nim":location.href="/games/nim";break;case"nw":location.href="/games/wordle";break;case"c4":location.href="/games/connect4";break;case"ttt":location.href="/games/tictactoe";break;case"guessr":window.open("https://guessr.tv","_blank").focus();break;case"about":aboutModal.show();break;default:break}}async function getLinkInfo(e,t){if(e.getAttribute("data-bs-title")==spinner){let a=e.getAttribute("href");if(!a)return;a=`LINKPREVIEW${encodeURIComponent(a)}`;let o=bootstrap.Tooltip.getInstance(e);try{let n=await fetch(`https://helper.donk.workers.dev/cors/?${a}`,GETrequestOptions),s=await n.json();if(200!=s?.status&&s?.message)return e.setAttribute("data-bs-title",s.message),void o.setContent({".tooltip-inner":s.message});let r=DOMPurify.sanitize(decodeURIComponent(s.tooltip),{ALLOWED_TAGS:["div","li","br","b","span","hr"]});s.thumbnail&&t&&(r=`<img class="previewThumbnail" src="${s.thumbnail}" alt="link preview thumbnail">`+r),e.setAttribute("data-bs-title",r),o.setContent({".tooltip-inner":r})}catch(t){e.setAttribute("data-bs-title","Could not get link preview :("),o.setContent({".tooltip-inner":"Could not get link preview :("})}}}async function checkImage(e){try{const t=await fetch(`https://helper.donk.workers.dev/cors/?${e}`);return!!(await t.blob()).type.startsWith("image/")}catch(e){return!1}}function linkifyElementID(e,t){linkifyElement(document.getElementById(e),{className:"linktooltip",attributes:{tabindex:"0",rel:"noopener noreferrer",target:"_blank",role:"button","data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-container":"body","data-bs-title":spinner},formatHref:{mention:e=>"https://twitch.tv"+e}},document);[...document.querySelectorAll("a.linktooltip")].map((function(e){e.getAttribute("data-bs-title")==spinner&&e.addEventListener("show.bs.tooltip",(function(){getLinkInfo(e,t)}));const a=document.getElementsByClassName("tooltip show");for(;a.length>0;)a[0].parentNode.removeChild(a[0]);return new bootstrap.Tooltip(e,{animation:!1,html:!0,delay:{show:200,hide:0},trigger:"hover"})}))}function enableTooltips(){[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map((e=>new bootstrap.Tooltip(e,{trigger:"hover"})))}function enablePopovers(){[...document.querySelectorAll('[data-bs-toggle="popover"]')].map((e=>new bootstrap.Popover(e)))}async function checkToken(e){let t=new Headers;t.append("Authorization",`OAuth ${e}`);let a={method:"GET",headers:t,redirect:"follow"};return new Promise((async function(e,t){try{let t=await fetch("https://id.twitch.tv/oauth2/validate",a);t.ok||e(!1),(await t.json()).expires_in<600?e(!1):e(!0)}catch(t){console.log("checkToken error",t),e(!1)}}))}function spamTest(e,t,a=100,o=null){if(!e&&!t)return'spamTest("vote/suggest/join", count, optional max delay in ms, optional number of options for type vote)';let n=[{"badge-info":{subscriber:"30"},badges:{moderator:"1",subscriber:"3030","glhf-pledge":"1"},"badge-info-raw":"subscriber/30","badges-raw":"moderator/1,subscriber/3030,glhf-pledge/1"},{"badge-info":{subscriber:"33"},badges:{moderator:"1",subscriber:"3030","game-developer":"1"},"badge-info-raw":"subscriber/30","badges-raw":"moderator/1,subscriber/3030,game-developer/1"},{"badge-info":null,badges:{moderator:"1"},"badge-info-raw":null,"badges-raw":"moderator/1"},{"badge-info":null,badges:{vip:"1"},"badge-info-raw":null,"badges-raw":"vip/1"},{"badge-info":null,badges:null,"badge-info-raw":null,"badges-raw":null}];for(let s=0;s<t;s++){let t=uuidv4(),s=n[Math.floor(Math.random()*n.length)],r="";switch(e){case"suggest":r=`!suggest ${uuidv4()}`;break;case"join":r=`!join ${uuidv4()}`;break;case"vote":if(!o)return'no number of options provided - spamTest("vote", count, delay, number of options)';r=(Math.floor(Math.random()*o)+1).toString();break;default:return'invalid input - spamTest("vote/suggest/join", count, optional max delay in ms, optional number of options for type vote)'}let i={"badge-info":s["badge-info"],badges:s.badges,color:"#"+(16777215*Math.random()<<0).toString(16),"display-name":t,emotes:null,"first-msg":!1,flags:null,id:uuidv4(),mod:!0,"returning-chatter":!1,"room-id":"135944158",subscriber:!0,"tmi-sent-ts":Date.now(),turbo:!1,"user-id":Math.floor(1e9*Math.random()).toString(),"user-type":"mod","emotes-raw":null,"badge-info-raw":s["badge-info-raw"],"badges-raw":s["badges-raw"],username:t,"message-type":"chat"};setTimeout((()=>{client.emit("message","#mwwmwwwwmwwwwwwwmwwwwmwww",i,r,!1)}),Math.random()*a)}}function uuidv4(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)))}function ISO8601ToSeconds(e){let t=e.match(/(-)?P(?:([.,\d]+)Y)?(?:([.,\d]+)M)?(?:([.,\d]+)W)?(?:([.,\d]+)D)?(?:T(?:([.,\d]+)H)?(?:([.,\d]+)M)?(?:([.,\d]+)S)?)?/);t[1];return(void 0===t[2]?0:31536e3*t[2])+(void 0===t[3]?0:2592e3*t[3])+(void 0===t[4]?0:604800*t[4])+(void 0===t[5]?0:86400*t[5])+(void 0===t[6]?0:3600*t[6])+(void 0===t[7]?0:60*t[7])+(void 0===t[8]?0:parseFloat(t[8]))}function convertTwitchVODDuration(e){const t=/(?:(\d+)h)?(?:(\d+)m)?(?:(\d+)s)?/.exec(e);if(!t)throw new Error("Invalid duration format");const[,a,o,n]=t;let s=0;return a&&(s+=60*parseInt(a)*60),o&&(s+=60*parseInt(o)),n&&(s+=parseInt(n)),s}function secondsToTimeString(e){let t=new Date(1e3*e).toISOString().slice(11,19);return t.startsWith("00:")?t.substring(3):t}function formatViewCount(e){return Intl.NumberFormat("en-US",{notation:"compact",maximumFractionDigits:1}).format(e)}function replacer(e,t){return t instanceof Map?{dataType:"Map",value:Array.from(t.entries())}:t}function reviver(e,t){return"object"==typeof t&&null!==t&&"Map"===t.dataType?new Map(t.value):t}