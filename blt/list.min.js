let blacklistModal,optionsModal,brackets,elements={blacklistModal:document.getElementById("blacklistModal"),reason:document.getElementById("reason"),optionsModal:document.getElementById("optionsModal"),optionsModalBody:document.getElementById("optionsModalBody"),toastContainer:document.getElementById("toastContainer"),main:document.getElementById("main"),list:document.getElementById("list"),blacklisted:document.getElementById("blacklisted")},blacklistID="";function blacklist(t){blacklistID=t,blacklistModal.show()}function showOptions(t){const e=brackets.findIndex((e=>e.id===t));if(e>-1){let t='<ul class="list-group" style="max-height: 600px; overflow: auto">';for(let n=0;n<brackets[e].bracket.options.length;n++){let o=brackets[e].bracket.options[n];t+=`\n      <li class="list-group-item">\n      ${escapeString(o.name)||'<span class="text-body-secondary">no name</span>'} - \n      ${escapeString(o.value)||'<span class="text-body-secondary">no value</span>'} - \n      ${escapeString(o.type)||'<span class="text-body-secondary">no type</span>'} - \n      ${escapeString(o.thumbnail)||'<span class="text-body-secondary">no thumbnail</span>'}\n      </li>`}t+="</ul>",elements.optionsModalBody.innerHTML=t,optionsModal.show()}else showToast("bracket not found","danger",3e3)}async function blacklistSubmit(){let t={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id:blacklistID,reason:elements.reason.value})};try{let e=await fetch("https://blt.donk.workers.dev/blacklist",t),n=await e.json();showToast(n.message,"info",3e3),blacklistModal.hide(),loadList()}catch(t){showToast("Could not blacklist bracket","danger",3e3),console.log("blacklistSubmit error",t)}}async function unblacklist(t){let e={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id:t})};try{let t=await fetch("https://blt.donk.workers.dev/unblacklist",e),n=await t.json();showToast(n.message,"info",3e3),loadList()}catch(t){showToast("Could not unblacklist bracket","danger",3e3),console.log("unblacklist error",t)}}async function loadList(){elements.list.innerHTML=spinner,elements.blacklisted.innerHTML=spinner;let t={headers:{Accept:"application/json","Content-Type":"application/json"}};try{let e=await fetch("https://blt.donk.workers.dev/list",t),n=await e.json();for(let t=0;t<n.length;t++)n[t]=JSON.parse(n[t]);console.log(n),brackets=n;let o='\n    <div class="card">\n    <div class="card-body">\n    <ul class="list-group" style="max-height: 500px; overflow: auto">';for(let t=0;t<n.length;t++){let e=n[t];e.id&&!e.blacklisted&&(o+=`\n      <li class="list-group-item">\n      ${e.id} - ${escapeString(e.username)} - \n      ${escapeString(e.bracket.title)} - ${escapeString(e.bracket.description)} - ${e.bracket.options.length} options \n      <br><button type="button" class="btn btn-danger float-end me-2" onclick="blacklist('${e.id}')">Blacklist</button>\n      <button type="button" class="btn btn-info float-end me-2" onclick="showOptions('${e.id}')">Options</button>\n      </li>`)}o+="\n    </ul>\n    </div>\n    </div>";let s='\n    <div class="card">\n    <div class="card-body">\n    <ul class="list-group" style="max-height: 500px; overflow: auto">';for(let t=0;t<n.length;t++){let e=n[t];e.blacklisted&&(s+=`\n    <li class="list-group-item">\n    ${e.reason||"no reason"} - ${e.id} - ${escapeString(e.username)} - \n    ${escapeString(e.bracket.title)} - ${escapeString(e.bracket.description)} - ${e.bracket.options.length} options \n    <br><button type="button" class="btn btn-danger float-end me-2" onclick="unblacklist('${e.id}')">Unblacklist</button>\n    <button type="button" class="btn btn-info float-end me-2" onclick="showOptions('${e.id}')">Options</button>\n    </li>`)}s+="\n    </ul>\n    </div>\n    </div>",elements.list.innerHTML=o,elements.blacklisted.innerHTML=s}catch(t){showToast("Could not load list","danger",3e3),console.log(t)}}window.onload=async function(){let t={headers:{Accept:"application/json","Content-Type":"application/json"}};try{let e=await fetch("https://blt.donk.workers.dev/check",t),n=await e.json();if(200!==e.status||"OK"!==n.message)return void(elements.main.innerHTML="You don't have permission to view this page")}catch(t){return void(elements.main.innerHTML="You don't have permission to view this page")}loadList(),blacklistModal=new bootstrap.Modal(elements.blacklistModal),optionsModal=new bootstrap.Modal(elements.optionsModal)};