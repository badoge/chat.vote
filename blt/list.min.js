let blacklistModal,optionsModal,brackets,elements={blacklistModal:document.getElementById("blacklistModal"),reason:document.getElementById("reason"),optionsModal:document.getElementById("optionsModal"),optionsModalBody:document.getElementById("optionsModalBody"),toastContainer:document.getElementById("toastContainer"),main:document.getElementById("main"),list:document.getElementById("list"),blacklisted:document.getElementById("blacklisted")},blacklistID="";function blacklist(t){blacklistID=t,blacklistModal.show()}function showOptions(t){const e=brackets.findIndex((e=>e.id===t));if(e>-1){let t='<ul class="list-group" style="max-height: 600px; overflow: auto">';for(let o=0;o<brackets[e].bracket.options.length;o++){let n=brackets[e].bracket.options[o];t+=`\n      <li class="list-group-item">\n      ${validator.escape(n.name)||'<span class="text-body-secondary">no name</span>'} - \n      ${validator.escape(n.value)||'<span class="text-body-secondary">no value</span>'} - \n      ${validator.escape(n.type)||'<span class="text-body-secondary">no type</span>'} - \n      ${validator.escape(n.thumbnail)||'<span class="text-body-secondary">no thumbnail</span>'}\n      </li>`}t+="</ul>",elements.optionsModalBody.innerHTML=t,optionsModal.show()}else showToast("bracket not found","danger",3e3)}async function blacklistSubmit(){let t={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id:blacklistID,reason:elements.reason.value}),redirect:"follow"};try{let e=await fetch("https://blt.donk.workers.dev/blacklist",t),o=await e.json();showToast(o.message,"info",3e3),blacklistModal.hide(),loadList()}catch(t){showToast("Could not blacklist bracket","danger",3e3),console.log("blacklistSubmit error",t)}}async function unblacklist(t){let e={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id:t}),redirect:"follow"};try{let t=await fetch("https://blt.donk.workers.dev/unblacklist",e),o=await t.json();showToast(o.message,"info",3e3),loadList()}catch(t){showToast("Could not unblacklist bracket","danger",3e3),console.log("unblacklist error",t)}}async function loadList(){elements.list.innerHTML=spinner,elements.blacklisted.innerHTML=spinner;let t={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},redirect:"follow"};try{let e=await fetch("https://blt.donk.workers.dev/list",t),o=await e.json();for(let t=0;t<o.length;t++)o[t]=JSON.parse(o[t]);console.log(o),brackets=o;let n='\n    <div class="card">\n    <div class="card-body">\n    <ul class="list-group" style="max-height: 500px; overflow: auto">';for(let t=0;t<o.length;t++){let e=o[t];e.id&&!e.blacklisted&&(n+=`\n      <li class="list-group-item">\n      ${e.id} - ${validator.escape(e.username)} - \n      ${validator.escape(e.bracket.title)} - ${validator.escape(e.bracket.description)} - ${e.bracket.options.length} options \n      <br><button type="button" class="btn btn-danger float-end me-2" onclick="blacklist('${e.id}')">Blacklist</button>\n      <button type="button" class="btn btn-info float-end me-2" onclick="showOptions('${e.id}')">Options</button>\n      </li>`)}n+="\n    </ul>\n    </div>\n    </div>";let a='\n    <div class="card">\n    <div class="card-body">\n    <ul class="list-group" style="max-height: 500px; overflow: auto">';for(let t=0;t<o.length;t++){let e=o[t];e.blacklisted&&(a+=`\n    <li class="list-group-item">\n    ${e.reason||"no reason"} - ${e.id} - ${validator.escape(e.username)} - \n    ${validator.escape(e.bracket.title)} - ${validator.escape(e.bracket.description)} - ${e.bracket.options.length} options \n    <br><button type="button" class="btn btn-danger float-end me-2" onclick="unblacklist('${e.id}')">Unblacklist</button>\n    <button type="button" class="btn btn-info float-end me-2" onclick="showOptions('${e.id}')">Options</button>\n    </li>`)}a+="\n    </ul>\n    </div>\n    </div>",elements.list.innerHTML=n,elements.blacklisted.innerHTML=a}catch(t){showToast("Could not load list","danger",3e3),console.log(t)}}window.onload=async function(){let t={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},redirect:"follow"};try{let e=await fetch("https://blt.donk.workers.dev/check",t),o=await e.json();if(200!==e.status||"OK"!==o.message)return void(elements.main.innerHTML="You don't have permission to view this page")}catch(t){return void(elements.main.innerHTML="You don't have permission to view this page")}loadList(),blacklistModal=new bootstrap.Modal(elements.blacklistModal),optionsModal=new bootstrap.Modal(elements.optionsModal)};