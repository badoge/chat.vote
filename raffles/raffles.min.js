let client,raffle_open,extraTimer,timer_raffle,rafflePopover,loginButton,resetSettingsModal,loginExpiredModal,restartRaffleModal,fancyRaffleModal,settingsOffcanvas,tickSound,revealSound,elements={resetSettingsModal:document.getElementById("resetSettingsModal"),loginExpiredModal:document.getElementById("loginExpiredModal"),restartRaffleModal:document.getElementById("restartRaffleModal"),fancyRaffleModal:document.getElementById("fancyRaffleModal"),claw:document.getElementById("claw"),slot:document.getElementById("slot"),fancyRaffleWinner:document.getElementById("fancyRaffleWinner"),status:document.getElementById("status"),topRight:document.getElementById("topRight"),loginButton:document.getElementById("loginButton"),channelName:document.getElementById("channelName"),darkTheme:document.getElementById("darkTheme"),enableRaffle:document.getElementById("enableRaffle"),enableRaffleText:document.getElementById("enableRaffleText"),raffleCommandButton:document.getElementById("raffleCommandButton"),raffleCommandText:document.getElementById("raffleCommandText"),settingsOffcanvas:document.getElementById("settingsOffcanvas"),raffleUsers:document.getElementById("raffleUsers"),entrants:document.getElementById("entrants"),raffleOutput:document.getElementById("raffleOutput"),extraTimerDiv:document.getElementById("extraTimerDiv"),extraTimerMins:document.getElementById("extraTimerMins"),startExtraTimer:document.getElementById("startExtraTimer"),stopExtraTimer:document.getElementById("stopExtraTimer"),unpauseExtraTimer:document.getElementById("unpauseExtraTimer"),pauseExtraTimer:document.getElementById("pauseExtraTimer"),extraCountdown:document.getElementById("extraCountdown"),raffleCommand:document.getElementById("raffleCommand"),removeWinner:document.getElementById("removeWinner"),whoCanJoinCard:document.getElementById("whoCanJoinCard"),whoCanJoin:document.getElementById("whoCanJoin"),selectAll:document.getElementById("selectAll"),unselectAll:document.getElementById("unselectAll"),plebBonus:document.getElementById("plebBonus"),followerBonus:document.getElementById("followerBonus"),subBonus:document.getElementById("subBonus"),tier1Bonus:document.getElementById("tier1Bonus"),tier2Bonus:document.getElementById("tier2Bonus"),tier3Bonus:document.getElementById("tier3Bonus"),modBonus:document.getElementById("modBonus"),vipBonus:document.getElementById("vipBonus"),firstTimeChatterBonus:document.getElementById("firstTimeChatterBonus"),followAge:document.getElementById("followAge"),followAgeUnit:document.getElementById("followAgeUnit"),subAge:document.getElementById("subAge"),tier1SubAge:document.getElementById("tier1SubAge"),tier2SubAge:document.getElementById("tier2SubAge"),tier3SubAge:document.getElementById("tier3SubAge"),allowPlebs:document.getElementById("allowPlebs"),allowFollowers:document.getElementById("allowFollowers"),allowSubs:document.getElementById("allowSubs"),allowTier1:document.getElementById("allowTier1"),allowTier2:document.getElementById("allowTier2"),allowTier3:document.getElementById("allowTier3"),allowMods:document.getElementById("allowMods"),allowVips:document.getElementById("allowVips"),allowFirstTimeChatters:document.getElementById("allowFirstTimeChatters"),splitTiers:document.getElementById("splitTiers"),subsRow:document.getElementById("subsRow"),tier1Row:document.getElementById("tier1Row"),tier2Row:document.getElementById("tier2Row"),tier3Row:document.getElementById("tier3Row"),animateDrawing:document.getElementById("animateDrawing"),useTwitchPFP:document.getElementById("useTwitchPFP"),autoRerollEnabled:document.getElementById("autoRerollEnabled"),rerollTimerValueMinutes:document.getElementById("rerollTimerValueMinutes"),extraTimerEnabled:document.getElementById("extraTimerEnabled"),announceWinner:document.getElementById("announceWinner"),confirmJoin:document.getElementById("confirmJoin"),linkPreviewThumbnailsEnabled:document.getElementById("linkPreviewThumbnailsEnabled"),refreshWarningEnabled:document.getElementById("refreshWarningEnabled"),bttvGlobalEmotes:document.getElementById("bttvGlobalEmotes"),bttvChannelEmotes:document.getElementById("bttvChannelEmotes"),ffzGlobalEmotes:document.getElementById("ffzGlobalEmotes"),ffzChannelEmotes:document.getElementById("ffzChannelEmotes"),seventvGlobalEmotes:document.getElementById("seventvGlobalEmotes"),seventvChannelEmotes:document.getElementById("seventvChannelEmotes"),toastContainer:document.getElementById("toastContainer"),raffleTitle:document.getElementById("raffleTitle"),titleHint:document.getElementById("titleHint")},raffle_users=[],raffle_tickets=[],currentTime=0,currentRaffleWinner="",raffleWinners=[],thirdPartyEmotes=[],firstTimeChatters=[],darkTheme=!0,USER={channel:"",twitchLogin:!1,access_token:"",userID:"",platform:""},RAFFLES={raffleCommand:"!join",removeWinner:!0,allowPlebs:!0,allowFollowers:!0,allowSubs:!0,allowTier1:!0,allowTier2:!0,allowTier3:!0,allowMods:!0,allowVips:!0,allowFirstTimeChatters:!0,plebBonus:0,followerBonus:0,subBonus:0,tier1Bonus:0,tier2Bonus:0,tier3Bonus:0,modBonus:0,vipBonus:0,firstTimeChatterBonus:0,followAge:0,followAgeUnit:"min",subAge:0,tier1SubAge:0,tier2SubAge:0,tier3SubAge:0,splitTiers:!1,animateDrawing:!0,useTwitchPFP:!1,autoRerollEnabled:!1,rerollTimerValueMinutes:0,extraTimerEnabled:!1,announceWinner:!1,confirmJoin:!1,linkPreviewThumbnailsEnabled:!1,refreshWarningEnabled:!1};async function refreshData(){darkTheme=elements.darkTheme.checked??!0,USER.twitchLogin||(USER.channel=escapeString(elements.channelName.value.replace(/\s+/g,"").toLowerCase()),USER.platform="twitch"),!USER.userID&&USER.channel&&(USER.userID=await getUserID(USER.channel)),RAFFLES.raffleCommand=elements.raffleCommand.value.replace(/\s+/g,"").toLowerCase()??"!join",elements.raffleCommand.value=RAFFLES.raffleCommand,RAFFLES.raffleCommand||(RAFFLES.raffleCommand="!join",elements.raffleCommand.value="!join"),RAFFLES.removeWinner=elements.removeWinner.checked??!0,RAFFLES.allowPlebs=elements.allowPlebs.checked??!0,RAFFLES.allowFollowers=elements.allowFollowers.checked??!0,RAFFLES.allowSubs=elements.allowSubs.checked??!0,RAFFLES.allowTier1=elements.allowTier1.checked??!0,RAFFLES.allowTier2=elements.allowTier2.checked??!0,RAFFLES.allowTier3=elements.allowTier3.checked??!0,RAFFLES.allowMods=elements.allowMods.checked??!0,RAFFLES.allowVips=elements.allowVips.checked??!0,RAFFLES.allowFirstTimeChatters=elements.allowFirstTimeChatters.checked??!0,RAFFLES.plebBonus=parseInt(elements.plebBonus.value,10)||0,RAFFLES.followerBonus=parseInt(elements.followerBonus.value,10)||0,RAFFLES.subBonus=parseInt(elements.subBonus.value,10)||0,RAFFLES.tier1Bonus=parseInt(elements.tier1Bonus.value,10)||0,RAFFLES.tier2Bonus=parseInt(elements.tier2Bonus.value,10)||0,RAFFLES.tier3Bonus=parseInt(elements.tier3Bonus.value,10)||0,RAFFLES.modBonus=parseInt(elements.modBonus.value,10)||0,RAFFLES.vipBonus=parseInt(elements.vipBonus.value,10)||0,RAFFLES.firstTimeChatterBonus=parseInt(elements.firstTimeChatterBonus.value,10)||0,RAFFLES.followAge=parseInt(elements.followAge.value,10)||0,RAFFLES.followAgeUnit=elements.followAgeUnit.value||"min",RAFFLES.subAge=parseInt(elements.subAge.value,10)||0,RAFFLES.tier1SubAge=parseInt(elements.tier1SubAge.value,10)||0,RAFFLES.tier2SubAge=parseInt(elements.tier2SubAge.value,10)||0,RAFFLES.tier3SubAge=parseInt(elements.tier3SubAge.value,10)||0,RAFFLES.splitTiers=elements.splitTiers.checked??!1,RAFFLES.animateDrawing=elements.animateDrawing.checked??!0,RAFFLES.useTwitchPFP=elements.useTwitchPFP.checked??!1,RAFFLES.autoRerollEnabled=elements.autoRerollEnabled.checked??!1,RAFFLES.rerollTimerValueMinutes=parseFloat(elements.rerollTimerValueMinutes.value)??0,RAFFLES.extraTimerEnabled=elements.extraTimerEnabled.checked??!1,RAFFLES.announceWinner=elements.announceWinner.checked??!1,RAFFLES.confirmJoin=elements.confirmJoin.checked??!1,RAFFLES.linkPreviewThumbnailsEnabled=elements.linkPreviewThumbnailsEnabled.checked??!1,RAFFLES.refreshWarningEnabled=elements.refreshWarningEnabled.checked??!1,elements.raffleCommandButton.innerHTML=RAFFLES.raffleCommand||"!join",elements.raffleCommandText.innerHTML=RAFFLES.raffleCommand||"!join"}function saveSettings(){refreshData(),localStorage.setItem("USER",JSON.stringify(USER)),localStorage.setItem("RAFFLES",JSON.stringify(RAFFLES)),localStorage.setItem("darkTheme",darkTheme),updateWhoCanJoin()}function load_localStorage(){localStorage.getItem("USER")?(USER=JSON.parse(localStorage.getItem("USER")),elements.channelName.value=USER.channel||""):console.log("localStorage user info not found"),localStorage.getItem("RAFFLES")?(RAFFLES=JSON.parse(localStorage.getItem("RAFFLES")),elements.raffleCommand.value=RAFFLES.raffleCommand||"!join",elements.raffleCommandButton.innerHTML=RAFFLES.raffleCommand||"!join",elements.raffleCommandText.innerHTML=RAFFLES.raffleCommand||"!join",elements.removeWinner.checked=RAFFLES.removeWinner??!0,elements.allowPlebs.checked=RAFFLES.allowPlebs??!0,elements.allowFollowers.checked=RAFFLES.allowFollowers??!0,elements.allowSubs.checked=RAFFLES.allowSubs??!0,elements.allowTier1.checked=RAFFLES.allowTier1??!0,elements.allowTier2.checked=RAFFLES.allowTier2??!0,elements.allowTier3.checked=RAFFLES.allowTier3??!0,elements.allowMods.checked=RAFFLES.allowMods??!0,elements.allowVips.checked=RAFFLES.allowVips??!0,elements.allowFirstTimeChatters.checked=RAFFLES.allowFirstTimeChatters??!0,elements.plebBonus.value=parseInt(RAFFLES.plebBonus,10)||0,elements.followerBonus.value=parseInt(RAFFLES.followerBonus,10)||0,elements.subBonus.value=parseInt(RAFFLES.subBonus,10)||0,elements.tier1Bonus.value=parseInt(RAFFLES.tier1Bonus,10)||0,elements.tier2Bonus.value=parseInt(RAFFLES.tier2Bonus,10)||0,elements.tier3Bonus.value=parseInt(RAFFLES.tier3Bonus,10)||0,elements.modBonus.value=parseInt(RAFFLES.modBonus,10)||0,elements.vipBonus.value=parseInt(RAFFLES.vipBonus,10)||0,elements.firstTimeChatterBonus.value=parseInt(RAFFLES.firstTimeChatterBonus,10)||0,elements.followAge.value=parseInt(RAFFLES.followAge,10)||0,elements.followAgeUnit.value=RAFFLES.followAgeUnit||"min",elements.subAge.value=parseInt(RAFFLES.subAge,10)||0,elements.tier1SubAge.value=parseInt(RAFFLES.tier1SubAge,10)||0,elements.tier2SubAge.value=parseInt(RAFFLES.tier2SubAge,10)||0,elements.tier3SubAge.value=parseInt(RAFFLES.tier3SubAge,10)||0,elements.splitTiers.checked=RAFFLES.splitTiers??!1,elements.animateDrawing.checked=RAFFLES.animateDrawing??!0,elements.useTwitchPFP.checked=RAFFLES.useTwitchPFP??!1,elements.autoRerollEnabled.checked=RAFFLES.autoRerollEnabled??!1,elements.rerollTimerValueMinutes.disabled=!elements.autoRerollEnabled.checked,elements.rerollTimerValueMinutes.value=parseFloat(RAFFLES.rerollTimerValueMinutes)||0,elements.extraTimerEnabled.checked=RAFFLES.extraTimerEnabled??!1,elements.announceWinner.checked=RAFFLES.announceWinner??!1,elements.confirmJoin.checked=RAFFLES.confirmJoin??!1,elements.linkPreviewThumbnailsEnabled.checked=RAFFLES.linkPreviewThumbnailsEnabled??!1,elements.refreshWarningEnabled.checked=RAFFLES.refreshWarningEnabled??!1,RAFFLES.extraTimerEnabled&&showExtraTimer(),splitTiers(RAFFLES.splitTiers),updateWhoCanJoin()):console.log("localStorage raffle settings not found")}function resetSettings(e=!1){return e&&localStorage.setItem("USER",JSON.stringify({channel:"",twitchLogin:!1,access_token:"",userID:"",platform:""})),localStorage.setItem("RAFFLES",JSON.stringify({raffleCommand:"!join",removeWinner:!0,allowPlebs:!0,allowFollowers:!0,allowSubs:!0,allowTier1:!0,allowTier2:!0,allowTier3:!0,allowMods:!0,allowVips:!0,allowFirstTimeChatters:!0,plebBonus:0,followerBonus:0,subBonus:0,tier1Bonus:0,tier2Bonus:0,tier3Bonus:0,modBonus:0,vipBonus:0,firstTimeChatterBonus:0,followAge:0,followAgeUnit:"min",subAge:0,tier1SubAge:0,tier2SubAge:0,tier3SubAge:0,splitTiers:!1,animateDrawing:!0,useTwitchPFP:!1,autoRerollEnabled:!1,rerollTimerValueMinutes:0,extraTimerEnabled:!1,announceWinner:!1,confirmJoin:!1,linkPreviewThumbnailsEnabled:!1,refreshWarningEnabled:!1})),location.reload(),!1}function restartRaffle(){raffle_users=[],raffle_tickets=[],currentRaffleWinner="",raffleWinners=[],document.getElementById("countdown_raffle")&&document.getElementById("countdown_raffle").remove(),timer_raffle&&(timer_raffle.reset(),timer_raffle.stop()),elements.raffleUsers.innerHTML="",elements.raffleOutput.innerHTML="",elements.entrants.innerHTML="Entrants: 0"}function login(){return elements.topRight.innerHTML='<div class="btn-group" role="group" aria-label="log in button group">\n    <button type="button" class="btn btn-twitch"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div></button>\n    <div class="btn-group" role="group">\n        <button id="btnGroupDropLogin" type="button" class="btn btn-twitch dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">\n      </button>\n        <ul class="dropdown-menu dropdown-menu-lg-end" aria-labelledby="btnGroupDrop1">\n            <li><a class="dropdown-item" onclick="logout()" href="#"><i class="material-icons notranslate">logout</i>Log out</a></li>\n        </ul>\n    </div>\n</div>',window.open("/prompt.html","loginWindow","toolbar=0,status=0,scrollbars=0,width=500px,height=800px"),!1}function connect(){elements.status.innerHTML='\n  <h4>\n  <span class="badge bg-warning">Connecting... \n  <div class="spinner-border" style="width:18px;height:18px;" role="status"><span class="visually-hidden">Loading...</span></div>\n  </span>\n  </h4>',elements.topRight.innerHTML='\n  <div class="btn-group" role="group" aria-label="log in button group">\n  <button type="button" class="btn btn-twitch"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div></button>\n  <div class="btn-group" role="group">\n  <button id="btnGroupDropLogin" type="button" class="btn btn-twitch dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"></button>\n  <ul class="dropdown-menu dropdown-menu-lg-end" aria-labelledby="btnGroupDrop1">\n  <li><a class="dropdown-item" onclick="logout()" href="#"><i class="material-icons notranslate">logout</i>Log out</a></li>\n  </ul>\n  </div>\n  </div>',refreshData(),getEmotes(),loadBadges(USER.channel);let e={options:{clientId:CLIENT_ID,debug:!1},connection:{secure:!0,reconnect:!0},channels:[USER.channel]};client=new tmi.client(e),client.on("message",(async(e,t,n,l)=>{t.username==currentRaffleWinner&&(RAFFLES.autoRerollEnabled&&timer_raffle.isRunning()&&(document.getElementById("countdown_raffle").remove(),timer_raffle.reset(),timer_raffle.stop()),raffleWinnerChat(t,n)),t["first-msg"]&&firstTimeChatters.push(t.username);let a=n.split(" ").filter(Boolean)[0].toLowerCase();if(a==RAFFLES.raffleCommand&&raffle_open){if(raffle_users.some((e=>e.username===t.username)))return;if(RAFFLES.removeWinner&&raffleWinners.includes(t.username))return;if(RAFFLES.splitTiers){if(!RAFFLES.allowTier1&&t?.badges?.subscriber?.length<=3)return;if(!RAFFLES.allowTier2&&t?.badges?.subscriber?.length>3&&t?.badges?.subscriber.startsWith("2"))return;if(!RAFFLES.allowTier3&&t?.badges?.subscriber?.length>3&&t?.badges?.subscriber.startsWith("3"))return}else if(!RAFFLES.allowSubs&&t.subscriber)return;if(!RAFFLES.allowPlebs&&!t.subscriber)return;if(!RAFFLES.allowMods&&t.mod)return;if(!RAFFLES.allowVips&&t.vip)return;if(!RAFFLES.allowFirstTimeChatters&&firstTimeChatters.includes(t.username))return;let e={id:t["user-id"],username:t.username,displayname:t["display-name"],tickets:1,color:t.color,badges:t.badges,emotes:t.emotes,time:t["tmi-sent-ts"],msg:n};RAFFLES.splitTiers?(RAFFLES.tier1Bonus>0&&t?.badges?.subscriber?.length<=3&&(e.tickets+=RAFFLES.tier1Bonus),RAFFLES.tier2Bonus>0&&t?.badges?.subscriber?.length>3&&t?.badges?.subscriber.startsWith("2")&&(e.tickets+=RAFFLES.tier2Bonus),RAFFLES.tier3Bonus>0&&t?.badges?.subscriber?.length>3&&t?.badges?.subscriber.startsWith("3")&&(e.tickets+=RAFFLES.tier3Bonus)):RAFFLES.subBonus>0&&t.subscriber&&(e.tickets+=RAFFLES.subBonus),RAFFLES.plebBonus>0&&!t.subscriber&&(e.tickets+=RAFFLES.plebBonus),RAFFLES.modBonus>0&&t.mod&&(e.tickets+=RAFFLES.modBonus),RAFFLES.vipBonus>0&&t.vip&&(e.tickets+=RAFFLES.vipBonus),RAFFLES.firstTimeChatterBonus>0&&firstTimeChatters.includes(t.username)&&(e.tickets+=RAFFLES.firstTimeChatterBonus),addUserToRaffle(e)}if(a==RAFFLES.raffleCommand&&!raffle_open&&(Date.now()-currentTime)/1e3>10)return currentTime=Date.now(),rafflePopover.show(),void setTimeout((function(){rafflePopover.hide()}),3e3);"!reset"!=a||t.username!=USER.channel&&"badoge"!=t.username||resetSettings()})),client.on("timeout",((e,t,n,l,a)=>{if(t==currentRaffleWinner){elements.raffleOutput.lastChild.innerHTML='<small class="text-body-secondary">Message deleted</small>'}})),client.on("connected",(async(e,t)=>{console.log(`Connected to ${e}:${t}`),elements.status.innerHTML='<h4><span class="badge bg-success">Connected :)</span></h4>',saveSettings(),sendUsername("chat.vote/raffles",USER.channel,"twitch"==USER.platform?`twitch - ${USER.twitchLogin}`:"youtube"),loadPFP()})),client.on("disconnected",(e=>{elements.status.innerHTML=`<h4><span class="badge bg-danger">Disconnected: ${e}</span></h4>`})),client.on("notice",((e,t,n)=>{elements.status.innerHTML=`<h4><span class="badge bg-danger">Disconnected: ${n}</span></h4>`})),client.connect().catch(console.error)}async function loadPFP(){if(!USER.channel)return void(elements.topRight.innerHTML=' <div class="btn-group" role="group" aria-label="login options">\n    <a\n      role="button"\n      id="loginButton"\n      onclick="login()"\n      class="btn btn-twitch"\n      tabindex="0"\n      data-bs-container="body"\n      data-bs-custom-class="custom-popover"\n      data-bs-placement="bottom"\n      data-bs-trigger="manual"\n      data-bs-toggle="popover"\n      data-bs-title="Not signed in"\n      data-bs-content="You need sign in first before enabling the raffle"\n      ><span class="twitch-icon"></span>Sign in with Twitch</a\n    >\n    <div class="btn-group" role="group">\n      <button\n        id="btnGroupDropLogin"\n        type="button"\n        class="btn btn-twitch dropdown-toggle"\n        data-bs-toggle="dropdown"\n        data-bs-auto-close="outside"\n        aria-label="other login option, connect manually"\n        aria-expanded="false"\n      ></button>\n      <div class="dropdown-menu dropdown-menu-end" aria-labelledby="btnGroupDropLogin">\n        <div class="p-3" style="width: 300px">\n          <label for="channelName" class="form-label">Connect to chat directly</label>\n          <div class="input-group mb-3">\n            <span class="input-group-text" id="directLoginChannel">twitch.tv/</span>\n            <input type="text" class="form-control" id="channelName" aria-describedby="directLoginChannel" />\n          </div>\n          <small class="text-body-secondary">Some features will not be available if you connect directly</small><br />\n          <button type="button" onclick="connect()" class="btn btn-primary float-end">Connect</button>\n        </div>\n      </div>\n    </div>\n  </div>');let e=await get7TVPFP(USER.userID);"/pics/donk.png"==e&&USER.access_token&&(e=await getTwitchPFP(USER.channel,USER.access_token)),elements.topRight.innerHTML=`\n  <div class="btn-group" role="group" aria-label="Button group with nested dropdown">\n  <button type="button" id="btnGroupDrop2" class="btn btn-${darkTheme?"dark":"secondary"}"><img src="${e}" alt="profile pic" style="height:2em;"></button>\n  <div class="btn-group" role="group">\n  <button id="btnGroupDrop1" type="button" class="btn btn-${darkTheme?"dark":"secondary"} dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">\n  ${USER.channel}\n  </button>\n  <ul class="dropdown-menu dropdown-menu-lg-end" aria-labelledby="btnGroupDrop1">\n  <li><a class="dropdown-item" onclick="logout()" href="#"><i class="material-icons notranslate">logout</i>Log out</a></li>\n  </ul>\n  </div>\n  </div>`}function addUserToRaffle(e){raffle_users.push(e);let t=e.username==e.displayname.toLowerCase()?`${e.displayname}`:`${e.displayname} (${e.username})`,n=e.color?e.color:"#FFFFFF",l=addBadges(e.badges,e.id,firstTimeChatters.includes(e.username));elements.raffleUsers.insertAdjacentHTML("afterbegin",`\n    <li id="${e.username}_raffle" class="list-group-item">\n    ${l}<span style="color:${n};"> ${t}</span>: ${e.tickets} ${1==e.tickets?"ticket":"tickets"} \n    <i class="material-icons notranslate deletebtn float-end" onclick="removeFromRaffle('${e.username}')">highlight_off</i>\n    </li>`),elements.entrants.innerHTML=`Entrants: ${raffle_users.length}`,joinedUsers.push(e.username)}async function drawRaffleWinner(){if(raffle_users.length<1)showToast("No one has joined the raffle","warning",2500);else if(RAFFLES.animateDrawing)drawRaffleWinnerFancy();else{let e=[];for(let t=0,n=raffle_users.length;t<n;t++)for(let n=raffle_users[t].tickets;n>0;n--)e.push(raffle_users[t].username);currentRaffleWinner=e[Math.floor(Math.random()*e.length)],raffleWinners.push(currentRaffleWinner);let t=raffle_users.find((e=>e.username==currentRaffleWinner));RAFFLES.autoRerollEnabled&&startRaffleTimer();let n=document.createElement("p");if(n.classList.add("h2"),n.innerHTML=`Winner #${raffleWinners.length}: <a class="link-success cursorPointer" onclick=window.open("https://www.twitch.tv/popout/${USER.channel}/viewercard/${currentRaffleWinner}?popout=","_blank","width=340,height=800")>${currentRaffleWinner}</a>`,elements.raffleOutput.append(n),RAFFLES.announceWinner&&USER.twitchLogin){let t=Math.ceil(raffle_users.find((e=>e.username===currentRaffleWinner)).tickets/e.length*100);botSay(`PogChamp @${currentRaffleWinner} won the raffle with a ${t}% chance to win :) 🎊`)}RAFFLES.removeWinner&&removeFromRaffle(currentRaffleWinner),raffleWinnerChat({"user-id":t.id,username:t.username,"display-name":t.displayname,color:t.color,badges:t.badges,emotes:t.emotes,time:t.time},t.msg,!0)}}class Slot{constructor(e,t,n){this.username=e,this.pfp=t||"/pics/donk.png",this.color=n||"#ffffff",this.measureUnit="px",this.ordinal=0,this.left=0,this.div=document.createElement("div"),this.div.classList.add("slot-element"),RAFFLES.useTwitchPFP?this.div.innerHTML=`<span style="color:${this.color};"> ${this.username} </span>\n        <div style="height: 310px; width: 300px; border-bottom: 10px solid transparent; background: radial-gradient(circle, rgba(255,255,255,1) 0%, ${this.color} 100%);">\n          <img\n            style="background: linear-gradient(0deg, ${this.color} 1%, rgba(100,100,100,1) 40%); height: 300px; width: 300px;"\n            src="${this.pfp}"\n            alt="${this.username}"\n            title="${this.username}"\n          />\n        </div>`:this.div.innerHTML=`<span style="color:${this.color};"> ${this.username} </span>\n        <div style="height: 310px; width: 300px; border-bottom: 10px solid transparent; background: radial-gradient(circle, rgba(255,255,255,1) 0%, ${this.color} 100%);">\n          <img style="background: ${this.color}; height: 300px; width: 300px;" src="${this.pfp}" alt="${this.username}" title="${this.username}" />\n        </div>`}init(e=0){this.ordinal=-e}resetPosition(e=0){this.left=e,this.setPositionDOM(0)}scroll(e=0){this.left-=e,this.left<(this.ordinal-2)*app.animation.constants.ELEMENT_WIDTH&&(tickSound.play(),this.left+=app.slotOptions.length*app.animation.constants.ELEMENT_WIDTH),this.setPositionDOM(this.left)}setPositionDOM(e=0){this.div.style.left=e+this.measureUnit}checkEquatorPosition(){if(!this.div.parentNode)return void console.warn("Div is not attached to anything! Cannot calculate position!",this);const e=this.div.parentNode.getBoundingClientRect(),t=e.x+e.width/2,n=this.div.getBoundingClientRect(),l=[n.x,n.x+n.width];return l[0]<=t&&l[1]>=t}cloneSelf(){return new Slot(this.username,this.pfp,this.color)}destroy(){this.div.parentNode&&this.div.parentNode.removeChild(this.div)}}const detectWinner=function(){revealSound.play();let e=null;for(let t=0,n=app.slotOptions.length;t<n;t++)app.slotOptions[t].checkEquatorPosition()&&(e=app.slotOptions[t]);if(e){const t=e.cloneSelf();elements.fancyRaffleWinner.appendChild(t.div),app.spinStarted=!1,raffleWinners.push(e.username),currentRaffleWinner=e.username;let n=raffle_users.find((e=>e.username==currentRaffleWinner));RAFFLES.autoRerollEnabled&&startRaffleTimer();let l=document.createElement("p");if(l.classList.add("h2"),l.innerHTML=`Winner #${raffleWinners.length}: <a class="link-success cursorPointer" onclick=window.open("https://www.twitch.tv/popout/${USER.channel}/viewercard/${e.username}?popout=","_blank","width=340,height=800")>${e.username}</a>`,elements.raffleOutput.append(l),RAFFLES.announceWinner&&USER.twitchLogin){let e=Math.ceil(raffle_users.find((e=>e.username===currentRaffleWinner)).tickets/raffle_users.reduce((function(e,t){return e+t.tickets}),0)*100);botSay(`PogChamp @${currentRaffleWinner} won the raffle with a ${e}% chance to win :) 🎊`)}RAFFLES.removeWinner&&removeFromRaffle(e.username),raffleWinnerChat({username:n.username,"display-name":n.displayname,color:n.color,badges:n.badges,emotes:n.emotes,time:n.time},n.msg,!0),setTimeout((()=>{fancyRaffleModal.hide(),elements.fancyRaffleWinner.innerHTML="",elements.slot.innerHTML='<div class="spinner-border" style="width: 10rem; height: 10rem; margin-left: auto; margin-right: auto; display:block;" role="status"><span class="visually-hidden">Loading...</span></div>'}),2e3)}else window.alert("Could not determine winner FeelsDonkMan")},animateRoll=function(){if(app.animation.speed+=app.animation.acceleration,app.animation.speed<0)app.animation.speed=0,app.animation.acceleration=0,setTimeout(detectWinner,1e3);else{for(let e=0,t=app.slotOptions.length;e<t;e++)app.slotOptions[e].scroll(app.animation.speed);window.requestAnimationFrame(animateRoll)}};Array.prototype.shuffle=function(){for(let e=this.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[this[e],this[t]]=[this[t],this[e]]}return this};const app={slotOptions:[],animation:{constants:{ELEMENT_WIDTH:310,SLOW_DOWN:-.1,STARTING_SPEED:40},acceleration:0,speed:0,projectedFPS:0},spinStarted:!1,ready:!1};async function drawRaffleWinnerFancy(){fancyRaffleModal.show(),elements.claw.style.display="none";let e=[];for(let t=0,n=raffle_users.length;t<n;t++)for(let n=raffle_users[t].tickets;n>0;n--)e.push(raffle_users[t]);if(e=e.shuffle().slice(0,100),RAFFLES.useTwitchPFP){let t=await getPFP(e.map((e=>e.username)));if(0!=t)for(let n=0,l=e.length;n<l;n++)if(t.find((t=>t.login===e[n].username))){let l=t.find((t=>t.login===e[n].username)).profile_image_url;l&&(e[n].pfp=l)}}else for(let t=0,n=e.length;t<n;t++)e[t].pfp="/pics/raffledonk.png";for(let e=0,t=app.slotOptions.length;e<t;e++)app.slotOptions[e].destroy();app.slotOptions.length=0;for(let t=0,n=e.length;t<n;t++)app.slotOptions.push(new Slot(e[t].username,e[t].pfp,e[t].color));if(app.spinStarted)return;if(app.spinStarted=!0,app.slotOptions.length<1)return app.spinStarted=!1,window.alert("Nothing to spin!");for(;app.slotOptions.length<20;)for(let e=0,t=app.slotOptions.length;e<t;e++)app.slotOptions.push(app.slotOptions[e].cloneSelf());elements.fancyRaffleWinner.innerHTML="",elements.slot.innerHTML="",elements.claw.style.display="block",app.slotOptions.shuffle().forEach(((e,t)=>{e.init(t),e.resetPosition(-20),elements.slot.appendChild(e.div)})),app.animation.speed=app.animation.constants.STARTING_SPEED;const t=60/app.animation.projectedFPS;app.animation.speed*=t,setTimeout((()=>{app.animation.acceleration=app.animation.constants.SLOW_DOWN,app.animation.acceleration*=t*t}),Math.round(1500+1e3*Math.random())),animateRoll()}const fpsBenchmark=function(){let e=performance.now(),t=0,n=0,l=!0;console.log("Performance test started.");const a=function(){let s=performance.now();t+=1,n=((t-1)*n-e+s)/t,e=s,l&&window.requestAnimationFrame(a)};a(),setTimeout((()=>{l=!1,app.animation.projectedFPS=1e3/n,console.info(`Performance test ended.\n- avg frame time: ${n}\n- projected FPS: ${app.animation.projectedFPS}\n- test frames drawn: ${t} in 1 sec`)}),1e3)};async function getPFP(e){let t=[];try{let n=await fetch(`https://helper.donk.workers.dev/twitch/users?login=${e.join(",")}`),l=await n.json();for(let e=0,n=l.data.length;e<n;e++)t.push(l.data[e]);return t}catch(e){return console.log("getPFP",e),0}}function relativeTime(e){const t=new Intl.RelativeTimeFormat("en",{numeric:"auto"}),n=Math.round((parseInt(e,10)-(new Date).getTime())/6e4);return t.format(n,"minute")}function raffleWinnerChat(e,t,n=!1){let l=escapeString(t);if(e.emotes){let n=[];for(const[l,a]of Object.entries(e.emotes))for(let e=0,s=a.length;e<s;e++){if(n.some((e=>e.id==l)))continue;let s=a[e].split("-");n.push({emote:[...t].slice(parseInt(s[0],10),parseInt(s[1],10)+1).join(""),id:l})}for(let e=0,t=n.length;e<t;e++){let t=`<img src="https://static-cdn.jtvnw.net/emoticons/v2/${n[e].id}/default/dark/1.0" title="${n[e].emote}" alt="${n[e].emote}" class="emote">`;l=l.replaceAll(n[e].emote,t)}}l=replaceEmotes(l,thirdPartyEmotes);let a=e.username==e["display-name"].toLowerCase()?`${e["display-name"]}`:`${e["display-name"]} (${e.username})`,s=e.color?e.color:"#FFFFFF",o=addBadges(e.badges,e["user-id"],firstTimeChatters.includes(e.username)),r=document.createElement("p");r.innerHTML=`${n?relativeTime(e.time):""} ${o}<span ${n?'class="text-body-secondary"':`style="color:${s};"`}> ${a}:</span> ${n?`<span class="text-body-secondary"> ${l}</span>`:l}`,elements.raffleOutput.append(r),linkifyElementID("raffleOutput",RAFFLES.linkPreviewThumbnailsEnabled)}function removeFromRaffle(e){raffle_users=raffle_users.filter((t=>t.username!==e)),document.getElementById(e+"_raffle").remove(),elements.entrants.innerHTML=`Entrants: ${raffle_users.length}`}async function getEmotes(){setTimeout((async()=>{let e=await getGlobalBTTVEmotes(),t=await getGlobalFFZEmotes(),n=await getGlobal7TVEmotes();if(elements.bttvGlobalEmotes.innerText=e.length,elements.ffzGlobalEmotes.innerText=t.length,elements.seventvGlobalEmotes.innerText=n.length,thirdPartyEmotes=[...thirdPartyEmotes,...e,...t,...n],USER.userID){let e=await getChannelBTTVEmotes(USER.userID),t=await getChannelFFZEmotes(USER.userID),n=await getChannel7TVEmotes(USER.userID);thirdPartyEmotes=[...thirdPartyEmotes,...e,...t,...n],elements.bttvChannelEmotes.innerText=e.length,elements.ffzChannelEmotes.innerText=t.length,elements.seventvChannelEmotes.innerText=n.length}}),3e3)}function checkLogin(){return!!USER.channel||(loginButton.show(),setTimeout((function(){loginButton.hide()}),4e3),!1)}function logout(){elements.topRight.innerHTML=' <div class="btn-group" role="group" aria-label="login options">\n  <a\n    role="button"\n    id="loginButton"\n    onclick="login()"\n    class="btn btn-twitch"\n    tabindex="0"\n    data-bs-container="body"\n    data-bs-custom-class="custom-popover"\n    data-bs-placement="bottom"\n    data-bs-trigger="manual"\n    data-bs-toggle="popover"\n    data-bs-title="Not signed in"\n    data-bs-content="You need sign in first before enabling the raffle"\n    ><span class="twitch-icon"></span>Sign in with Twitch</a\n  >\n  <div class="btn-group" role="group">\n    <button\n      id="btnGroupDropLogin"\n      type="button"\n      class="btn btn-twitch dropdown-toggle"\n      data-bs-toggle="dropdown"\n      data-bs-auto-close="outside"\n      aria-label="other login option, connect manually"\n      aria-expanded="false"\n    ></button>\n    <div class="dropdown-menu dropdown-menu-end" aria-labelledby="btnGroupDropLogin">\n      <div class="p-3" style="width: 300px">\n        <label for="channelName" class="form-label">Connect to chat directly</label>\n        <div class="input-group mb-3">\n          <span class="input-group-text" id="directLoginChannel">twitch.tv/</span>\n          <input type="text" class="form-control" id="channelName" aria-describedby="directLoginChannel" />\n        </div>\n        <small class="text-body-secondary">Some features will not be available if you connect directly</small><br />\n        <button type="button" onclick="connect()" class="btn btn-primary float-end">Connect</button>\n      </div>\n    </div>\n  </div>\n</div>',resetSettings(!0)}async function botSay(e,t=!1){let n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({channel:USER.channel,msg:t?`@${e.join(", @")} joined the raffle PogChamp`:e,access_token:USER.access_token})};try{let e=await fetch("https://api.chat.vote/say",n);console.log(`botSay response: ${e.status}`)}catch(e){console.log("botSay error",e)}}function startRaffleTimer(){document.getElementById("countdown_raffle")&&(document.getElementById("countdown_raffle").remove(),timer_raffle.reset(),timer_raffle.stop()),RAFFLES.rerollTimerValueMinutes=60*parseFloat(elements.rerollTimerValueMinutes.value),isNaN(RAFFLES.rerollTimerValueMinutes)||0!=RAFFLES.rerollTimerValueMinutes&&(elements.raffleOutput.innerHTML+='<div class="card border-danger" id="countdown_raffle" style="text-align: center; margin: 10px; display: none;">\n    <div class="card-body">\n    <div class="values" style="font-size: 3em;"></div>\n    </div>\n    </div>',timer_raffle=new easytimer.Timer,timer_raffle.addEventListener("secondTenthsUpdated",(function(e){document.querySelector("#countdown_raffle .values").innerHTML="Rerolling in "+timer_raffle.getTimeValues().toString(["minutes","seconds","secondTenths"])})),timer_raffle.addEventListener("targetAchieved",(function(e){document.getElementById("countdown_raffle").remove(),timer_raffle.reset(),timer_raffle.stop(),drawRaffleWinner()})),document.querySelector("#countdown_raffle .values").innerHTML="Rerolling in "+timer_raffle.getTimeValues().toString(["minutes","seconds","secondTenths"]),document.getElementById("countdown_raffle").style.display="",timer_raffle.start({countdown:!0,precision:"secondTenths",startValues:{seconds:RAFFLES.rerollTimerValueMinutes}}))}async function enableRaffleButton(){if(checkLogin())if(RAFFLES.allowPlebs||RAFFLES.allowSubs||RAFFLES.allowTier1||RAFFLES.allowTier2||RAFFLES.allowTier2||RAFFLES.allowTier3||RAFFLES.allowMods||RAFFLES.allowVips||RAFFLES.allowFirstTimeChatters)fpsBenchmark(),raffle_open=!0,elements.enableRaffle.classList.remove("btn-success"),elements.enableRaffle.classList.add("btn-danger"),elements.enableRaffleText.innerText="Close Raffle";else{showToast("No one will be able to join the raffle","danger",3e3),settingsOffcanvas.show(),elements.whoCanJoinCard.scrollIntoView();let e=setInterval((()=>{elements.whoCanJoinCard.classList.toggle("border-info")}),100);setTimeout((()=>{clearInterval(e),elements.whoCanJoinCard.classList.remove("border-info")}),1e3)}}function disableRaffleButton(){raffle_open=!1,elements.enableRaffle.classList.remove("btn-danger"),elements.enableRaffle.classList.add("btn-success"),elements.enableRaffleText.innerText="Open Raffle"}function changeRaffleCommand(){settingsOffcanvas.show(),setTimeout((()=>{elements.raffleCommand.focus(),elements.raffleCommand.select()}),500);let e=setInterval((()=>{elements.raffleCommand.classList.toggle("border-info")}),100);setTimeout((()=>{clearInterval(e),elements.raffleCommand.classList.remove("border-info")}),1e3)}function showExtraTimer(){elements.extraTimerDiv.style.display=""}function hideExtraTimer(){extraTimer&&extraTimer.isRunning()&&(extraTimer.reset(),extraTimer.stop()),elements.extraTimerDiv.style.display="none"}function startExtraTimer(){let e=60*parseFloat(elements.extraTimerMins.value);isNaN(e)||0==e||(extraTimer=new easytimer.Timer,extraTimer.addEventListener("secondTenthsUpdated",(function(e){document.querySelector("#extraCountdown .values").innerHTML=extraTimer.getTimeValues().toString(["minutes","seconds","secondTenths"])})),extraTimer.addEventListener("targetAchieved",(function(e){elements.extraCountdown.style.display="none",elements.unpauseExtraTimer.style.display="none",elements.pauseExtraTimer.style.display="none",elements.stopExtraTimer.style.display="none",elements.startExtraTimer.style.display="",extraTimer.reset(),extraTimer.stop()})),document.querySelector("#extraCountdown .values").innerHTML=extraTimer.getTimeValues().toString(["minutes","seconds","secondTenths"]),elements.extraCountdown.style.display="",elements.pauseExtraTimer.style.display="",elements.stopExtraTimer.style.display="",elements.startExtraTimer.style.display="none",extraTimer.start({countdown:!0,precision:"secondTenths",startValues:{seconds:e}}))}function pauseExtraTimer(){extraTimer.isRunning()&&(extraTimer.pause(),elements.pauseExtraTimer.style.display="none",elements.unpauseExtraTimer.style.display="")}function unpauseExtraTimer(){extraTimer.isPaused()&&(extraTimer.start(),elements.pauseExtraTimer.style.display="",elements.unpauseExtraTimer.style.display="none")}function stopExtraTimer(){extraTimer.reset(),extraTimer.stop(),elements.extraCountdown.style.display="none",elements.startExtraTimer.style.display="",elements.pauseExtraTimer.style.display="none",elements.stopExtraTimer.style.display="none",elements.unpauseExtraTimer.style.display="none"}function switchTheme(e){document.documentElement.setAttribute("data-bs-theme",e?"dark":"light"),document.getElementById("twitchLogo").style.filter=`invert(${e?.25:.65})`,document.getElementById("btnGroupDrop1")&&document.getElementById("btnGroupDrop2")&&(document.getElementById("btnGroupDrop1").classList.remove(""+(e?"btn-secondary":"btn-dark")),document.getElementById("btnGroupDrop1").classList.add(""+(e?"btn-dark":"btn-secondary")),document.getElementById("btnGroupDrop2").classList.remove(""+(e?"btn-secondary":"btn-dark")),document.getElementById("btnGroupDrop2").classList.add(""+(e?"btn-dark":"btn-secondary")))}async function loadAndConnect(){load_localStorage(),refreshData();const e=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});if(e.channel&&!USER.channel&&!USER.twitchLogin&&!USER.access_token&&!USER.userID){let t=e.channel.replace(/\s+/g,"").toLowerCase();elements.channelName.value=t,USER.channel=t,window.history.replaceState({},document.title,"/")}if(USER.twitchLogin){if(!await checkToken(USER.access_token))return USER.channel="",void loginExpiredModal.show();elements.announceWinner.disabled=!1,elements.confirmJoin.disabled=!1,document.querySelectorAll(".no-twitch-warn").forEach((e=>e.style.display="none"))}else elements.announceWinner.disabled=!0,elements.confirmJoin.disabled=!0,elements.announceWinner.checked=!1,elements.confirmJoin.checked=!1,document.querySelectorAll(".no-twitch-warn").forEach((e=>e.style.display="block"));USER.channel&&connect()}function splitTiers(e){e?(elements.subsRow.style.display="none",elements.tier1Row.style.display="",elements.tier2Row.style.display="",elements.tier3Row.style.display=""):(elements.subsRow.style.display="",elements.tier1Row.style.display="none",elements.tier2Row.style.display="none",elements.tier3Row.style.display="none")}function toggleEveryone(e){elements.allowPlebs.checked=e,elements.allowFollowers.checked=e,elements.allowSubs.checked=e,elements.allowTier1.checked=e,elements.allowTier2.checked=e,elements.allowTier3.checked=e,elements.allowMods.checked=e,elements.allowVips.checked=e,elements.allowFirstTimeChatters.checked=e}function updateWhoCanJoin(){let e={"Non subscribers":{allowed:RAFFLES.allowPlebs,tickets:1+RAFFLES.plebBonus},"Tier 1 subscribers":{allowed:RAFFLES.allowTier1,tickets:1+RAFFLES.tier1Bonus},"Tier 2 subscribers":{allowed:RAFFLES.allowTier2,tickets:1+RAFFLES.tier2Bonus},"Tier 3 subscribers":{allowed:RAFFLES.allowTier3,tickets:1+RAFFLES.tier3Bonus},Subscribers:{allowed:RAFFLES.allowSubs,tickets:1+RAFFLES.subBonus},Mods:{allowed:RAFFLES.allowMods,tickets:1+RAFFLES.modBonus},VIPs:{allowed:RAFFLES.allowVips,tickets:1+RAFFLES.vipBonus},"First time chatters":{allowed:RAFFLES.allowFirstTimeChatters,tickets:1+RAFFLES.firstTimeChatterBonus}};document.querySelector("#plebBadge > div").classList=RAFFLES.allowPlebs?"role-allowed":"role-not-allowed",document.querySelector("#subBadge > div").classList=!RAFFLES.splitTiers&&RAFFLES.allowSubs||RAFFLES.splitTiers&&(RAFFLES.allowTier1||RAFFLES.allowTier2||RAFFLES.allowTier3)?"role-allowed":"role-not-allowed",document.querySelector("#modBadge > div").classList=RAFFLES.allowMods?"role-allowed":"role-not-allowed",document.querySelector("#vipBadge > div").classList=RAFFLES.allowVips?"role-allowed":"role-not-allowed",document.querySelector("#firstmsgBadge > div").classList=RAFFLES.allowFirstTimeChatters?"role-allowed":"role-not-allowed";let t,n=[],l=[],a=0;for(let[s,o]of Object.entries(e))if(o.allowed){if(RAFFLES.splitTiers&&"Subscribers"==s){t=7;continue}if(!RAFFLES.splitTiers&&("Tier 1 subscribers"==s||"Tier 3 subscribers"==s||"Tier 2 subscribers"==s)){t=5;continue}n.push(s),l.push(`${s} will get ${o.tickets} ${1==o.tickets?"ticket":"tickets"}`),a+=o.tickets-1}0!=n.length?elements.whoCanJoin.innerHTML=`${1==n.length?"Only":""} ${t==n.length?"Everyone":n.join(", ")} will be able to join the raffle.<br>\n  ${0==a?"Everyone will get 1 ticket.":l.join(" - ")}`:elements.whoCanJoin.innerHTML='<span class="text-danger">No one will be able to join the raffle</span>'}let joinedUsers=[];setInterval((()=>{RAFFLES.confirmJoin&&joinedUsers.length>0&&(botSay(joinedUsers,!0),joinedUsers=[])}),1e3),window.onload=function(){darkTheme="true"===(localStorage.getItem("darkTheme")||"true"),elements.darkTheme.checked=darkTheme??!0,switchTheme(elements.darkTheme.checked),loadAndConnect(),rafflePopover=new bootstrap.Popover(elements.enableRaffle),USER.channel||(loginButton=new bootstrap.Popover(elements.loginButton)),resetSettingsModal=new bootstrap.Modal(elements.resetSettingsModal),loginExpiredModal=new bootstrap.Modal(elements.loginExpiredModal),restartRaffleModal=new bootstrap.Modal(elements.restartRaffleModal),fancyRaffleModal=new bootstrap.Modal(elements.fancyRaffleModal),settingsOffcanvas=new bootstrap.Offcanvas(elements.settingsOffcanvas),elements.settingsOffcanvas.addEventListener("hide.bs.offcanvas",(function(){saveSettings()})),enableTooltips(),enablePopovers(),elements.enableRaffle.addEventListener("click",(function(){raffle_open?disableRaffleButton():(enableRaffleButton(),changeSiteLinkTarget("_blank"))})),elements.channelName.addEventListener("keydown",(e=>{"Enter"===e.key&&connect()})),elements.raffleCommand.addEventListener("keydown",(e=>{"Enter"===e.key&&saveSettings()})),elements.raffleTitle.addEventListener("keydown",(e=>{"Enter"===e.key&&elements.raffleTitle.blur()})),elements.raffleTitle.addEventListener("input",(e=>{e.target.innerText?elements.titleHint.style.display="none":elements.titleHint.style.display=""})),elements.titleHint.addEventListener("click",(e=>{elements.raffleTitle.focus()})),elements.selectAll.addEventListener("click",(e=>{toggleEveryone(!0),saveSettings()})),elements.unselectAll.addEventListener("click",(e=>{toggleEveryone(!1),saveSettings()})),elements.darkTheme.onchange=function(){switchTheme(this.checked),saveSettings()},elements.splitTiers.onchange=function(){splitTiers(this.checked),saveSettings()},elements.autoRerollEnabled.onchange=function(){elements.rerollTimerValueMinutes.disabled=!this.checked,saveSettings()},elements.extraTimerEnabled.onchange=function(){saveSettings(),this.checked?showExtraTimer():hideExtraTimer()},elements.linkPreviewThumbnailsEnabled.onchange=function(){saveSettings();[...document.querySelectorAll("a.linktooltip")].map((function(e){return e.setAttribute("data-bs-title",spinner),e.addEventListener("show.bs.tooltip",(function(){getLinkInfo(e,RAFFLES.linkPreviewThumbnailsEnabled)})),new bootstrap.Tooltip(e,{animation:!1,html:!0,delay:{show:200,hide:0},trigger:"hover"})}))},tickSound=new Howl({src:["/raffles/tick.mp3"]}),revealSound=new Howl({src:["/raffles/reveal.mp3"]});const e=["Wife giveaway 💿","Winner gets VIP","Sub emote raffle","Steam key giveaway","Gifted sub giveaway","eg giveaway 🥚"];setInterval((()=>{elements.raffleTitle.classList.add("active"),setTimeout((()=>{elements.raffleTitle.setAttribute("data-placeholder",e[Math.floor(Math.random()*e.length)]),elements.raffleTitle.classList.remove("active")}),200)}),3e3)},window.onbeforeunload=function(){return RAFFLES.refreshWarningEnabled&&raffle_users.length>0?"Close/refresh warning enabled. You can turn it off in the settings":null};