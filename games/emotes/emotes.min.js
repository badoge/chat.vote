const placeholder='<div class="card placeholder-emote">\n<div class="card-body">\n<img src="/pics/donk.png" alt="placeholder donk" title="placeholder donk" />\n</div>\n</div>';let loginButton,settingsOffcanvas,loginExpiredModal,aboutModal,elements={grid:document.getElementById("grid"),gameDiv:document.getElementById("gameDiv"),loginExpiredModal:document.getElementById("loginExpiredModal"),aboutModal:document.getElementById("aboutModal"),vtsLink:document.getElementById("vtsLink"),status:document.getElementById("status"),topRight:document.getElementById("topRight"),loginButton:document.getElementById("loginButton"),channelName:document.getElementById("channelName"),darkTheme:document.getElementById("darkTheme"),toastContainer:document.getElementById("toastContainer"),settingsOffcanvas:document.getElementById("settingsOffcanvas"),twitchGlobal:document.getElementById("twitchGlobal"),bttvGlobal:document.getElementById("bttvGlobal"),ffzGlobal:document.getElementById("ffzGlobal"),seventvGlobal:document.getElementById("seventvGlobal"),twitchChannel:document.getElementById("twitchChannel"),bttvChannel:document.getElementById("bttvChannel"),ffzChannel:document.getElementById("ffzChannel"),seventvChannel:document.getElementById("seventvChannel"),hideName:document.getElementById("hideName"),blurEmote:document.getElementById("blurEmote"),emotesPerRound:document.getElementById("emotesPerRound"),emotesPerRoundLabel:document.getElementById("emotesPerRoundLabel"),turnLength:document.getElementById("turnLength"),turnLengthLabel:document.getElementById("turnLengthLabel"),emoteTimer:document.getElementById("emoteTimer"),emoteTimerLabel:document.getElementById("emoteTimerLabel"),twitchGlobalCount:document.getElementById("twitchGlobalCount"),bttvGlobalCount:document.getElementById("bttvGlobalCount"),ffzGlobalCount:document.getElementById("ffzGlobalCount"),seventvGlobalCount:document.getElementById("seventvGlobalCount"),twitchChannelCount:document.getElementById("twitchChannelCount"),bttvChannelCount:document.getElementById("bttvChannelCount"),ffzChannelCount:document.getElementById("ffzChannelCount"),seventvChannelCount:document.getElementById("seventvChannelCount"),qualified:document.getElementById("qualified"),output:document.getElementById("output"),timeBar:document.getElementById("timeBar"),progressBar:document.getElementById("progressBar"),progress:document.getElementById("progress"),emotes:document.getElementById("emotes"),timer:document.getElementById("timer"),timerValue:document.getElementById("timerValue"),start:document.getElementById("start")},USER={channel:"",twitchLogin:!1,access_token:"",userID:"",platform:""},allEmotes={twitchGlobal:[],bttvGlobal:[],ffzGlobal:[],seventvGlobal:[],twitchChannel:[],bttvChannel:[],ffzChannel:[],seventvChannel:[]},darkTheme=!0,EMOTEBENCHMARK={interval:null,turn:0,turnLength:15e3,emotesPerRound:1,emoteTimer:2e3,hideName:!1,blurEmote:!1,answer:"",qualified:[],qualifiedCurrentRound:[],wrong:[],usedEmotes:[],timer:null,twitchGlobal:!1,bttvGlobal:!1,ffzGlobal:!1,seventvGlobal:!1,twitchChannel:!1,bttvChannel:!1,ffzChannel:!1,seventvChannel:!1};function handleMessage(e,t,n,l){n.trim()==EMOTEBENCHMARK.answer.trim()&&((EMOTEBENCHMARK.qualified.includes(t.username)||1==EMOTEBENCHMARK.turn)&&(EMOTEBENCHMARK.qualifiedCurrentRound.includes(t.username)||EMOTEBENCHMARK.qualifiedCurrentRound.push(t.username)),elements.qualified.insertAdjacentHTML("afterbegin",`<span class="badge qualified rounded-pill me-1" style="background-color: ${t.color}">\n      ${addBadges(t.badges,t["user-id"],t["first-msg"])} ${t.username}\n      </span>`))}function start(){let e=[],t=[];if(EMOTEBENCHMARK.answer="",elements.emotes.innerHTML=placeholder.repeat(EMOTEBENCHMARK.emotesPerRound),EMOTEBENCHMARK.qualified=EMOTEBENCHMARK.qualifiedCurrentRound,EMOTEBENCHMARK.qualifiedCurrentRound=[],1==EMOTEBENCHMARK.qualified.length)return elements.output.innerHTML=`Game over. WINNER: ${EMOTEBENCHMARK.qualified[0]}`,elements.qualified.innerHTML="",stopTimer(),clearInterval(EMOTEBENCHMARK.interval),EMOTEBENCHMARK.interval=null,EMOTEBENCHMARK.turn=0,void(elements.start.disabled=!1);if(0==EMOTEBENCHMARK.qualified.length&&EMOTEBENCHMARK.turn>0)return elements.output.innerHTML="Game over. No one won",elements.qualified.innerHTML="",stopTimer(),clearInterval(EMOTEBENCHMARK.interval),EMOTEBENCHMARK.interval=null,EMOTEBENCHMARK.turn=0,void(elements.start.disabled=!1);if(EMOTEBENCHMARK.hideName=elements.hideName.checked,EMOTEBENCHMARK.blurEmote=elements.blurEmote.checked,EMOTEBENCHMARK.twitchGlobal&&allEmotes.twitchGlobal.forEach((t=>{e.push(t)})),EMOTEBENCHMARK.bttvGlobal&&allEmotes.bttvGlobal.forEach((t=>{e.push(t)})),EMOTEBENCHMARK.ffzGlobal&&allEmotes.ffzGlobal.forEach((t=>{e.push(t)})),EMOTEBENCHMARK.seventvGlobal&&allEmotes.seventvGlobal.forEach((t=>{e.push(t)})),EMOTEBENCHMARK.twitchChannel&&allEmotes.twitchChannel.forEach((t=>{e.push(t)})),EMOTEBENCHMARK.bttvChannel&&allEmotes.bttvChannel.forEach((t=>{e.push(t)})),EMOTEBENCHMARK.ffzChannel&&allEmotes.ffzChannel.forEach((t=>{e.push(t)})),EMOTEBENCHMARK.seventvChannel&&allEmotes.seventvChannel.forEach((t=>{e.push(t)})),EMOTEBENCHMARK.usedEmotes.forEach((t=>{e=e.filter((e=>e.name!=t))})),e.length<EMOTEBENCHMARK.emotesPerRound)return stopTimer(),elements.timeBar.style.visibility="hidden",clearInterval(EMOTEBENCHMARK.interval),EMOTEBENCHMARK.interval=null,EMOTEBENCHMARK.turn=0,showToast("Not enough emotes remaining.","warning",5e3),settingsOffcanvas.show(),void(elements.start.disabled=!1);elements.start.disabled=!0,EMOTEBENCHMARK.turn++,startTimer();for(let n=0;n<EMOTEBENCHMARK.emotesPerRound;n++){let n=e[Math.floor(Math.random()*e.length)];EMOTEBENCHMARK.usedEmotes.push(n.name),t.push(n)}elements.progressBar.style.width="100%",elements.progress.ariaValueNow=100,elements.timeBar.style.visibility="visible",setTimeout((()=>{elements.emotes.innerHTML="";for(let e=0;e<t.length;e++){let n=`<div class="text-body-secondary text-center">${EMOTEBENCHMARK.hideName?"ðŸ¤”":t[e].name}</div>`;elements.emotes.innerHTML+=`\n      <div class="border border-secondary rounded bg-body-tertiary emote">\n      <img src="${t[e].url}" alt="${t[e].name}" ${EMOTEBENCHMARK.blurEmote?'class="blur"':""} title="${t[e].name}">\n      ${n}\n      </div>`,EMOTEBENCHMARK.answer+=`${t[e].name} `}animateTimer(Math.max(EMOTEBENCHMARK.emoteTimer-100*(EMOTEBENCHMARK.turn-1),1e3)),elements.output.innerHTML="",elements.qualified.innerHTML=""}),2e3),EMOTEBENCHMARK.interval?console.log("interval already running"):EMOTEBENCHMARK.interval=setInterval(start,EMOTEBENCHMARK.turnLength)}function reset(){clearInterval(EMOTEBENCHMARK.interval),stopTimer(),elements.start.disabled=!1,EMOTEBENCHMARK.interval=null,EMOTEBENCHMARK.turn=0,EMOTEBENCHMARK.answer="",elements.emotes.innerHTML=placeholder,elements.qualified.innerHTML="",elements.output.innerHTML="",elements.timeBar.style.visibility="hidden",EMOTEBENCHMARK.qualified=[],EMOTEBENCHMARK.qualifiedCurrentRound=[],EMOTEBENCHMARK.twitchGlobal=!1,EMOTEBENCHMARK.bttvGlobal=!1,EMOTEBENCHMARK.ffzGlobal=!1,EMOTEBENCHMARK.seventvGlobal=!1,EMOTEBENCHMARK.twitchChannel=!1,EMOTEBENCHMARK.bttvChannel=!1,EMOTEBENCHMARK.ffzChannel=!1,EMOTEBENCHMARK.seventvChannel=!1,elements.twitchGlobal.checked=!1,elements.bttvGlobal.checked=!1,elements.ffzGlobal.checked=!1,elements.seventvGlobal.checked=!1,elements.twitchChannel.checked=!1,elements.bttvChannel.checked=!1,elements.ffzChannel.checked=!1,elements.seventvChannel.checked=!1,elements.hideName.checked=!1,elements.blurEmote.checked=!1,elements.emotesPerRound.value=1,elements.emotesPerRoundLabel.innerHTML="1",elements.turnLength.value=15,elements.turnLengthLabel.innerHTML="15",elements.emoteTimer.value=2,elements.emoteTimerLabel.innerHTML="2",EMOTEBENCHMARK.usedEmotes=[]}function animateTimer(e){let t={percent:100};anime({targets:t,percent:0,round:1,duration:e,easing:"easeOutQuart",update:function(){elements.progressBar.style.width=`${t.percent}%`,elements.progress.ariaValueNow=t.percent},complete:function(e){elements.emotes.innerHTML=placeholder.repeat(EMOTEBENCHMARK.emotesPerRound),elements.timeBar.style.visibility="hidden"}})}function startTimer(){elements.timer.style.visibility="visible",EMOTEBENCHMARK.timer&&EMOTEBENCHMARK.timer.isRunning()&&(EMOTEBENCHMARK.timer.reset(),EMOTEBENCHMARK.timer.stop()),isNaN(EMOTEBENCHMARK.turnLength)||0!=EMOTEBENCHMARK.turnLength&&(EMOTEBENCHMARK.timer=new easytimer.Timer,EMOTEBENCHMARK.timer.addEventListener("secondTenthsUpdated",(function(e){elements.timerValue.innerHTML="Round ends in "+EMOTEBENCHMARK.timer.getTimeValues().toString(["minutes","seconds","secondTenths"])})),EMOTEBENCHMARK.timer.addEventListener("targetAchieved",(function(e){elements.timerValue.innerHTML=`Round #${EMOTEBENCHMARK.turn} starting...`,EMOTEBENCHMARK.timer.reset(),EMOTEBENCHMARK.timer.stop()})),elements.timerValue.innerHTML=`Round #${EMOTEBENCHMARK.turn} starting...`,setTimeout((()=>{EMOTEBENCHMARK.timer.start({countdown:!0,precision:"secondTenths",startValues:{seconds:EMOTEBENCHMARK.turnLength/1e3-2}})}),2e3))}function stopTimer(){EMOTEBENCHMARK.timer&&EMOTEBENCHMARK.timer.isRunning()&&(EMOTEBENCHMARK.timer.reset(),EMOTEBENCHMARK.timer.stop()),elements.timer.style.visibility="hidden"}window.onload=async function(){darkTheme="true"===(localStorage.getItem("darkTheme")||"true"),elements.darkTheme.checked=darkTheme??!0,switchTheme(elements.darkTheme.checked),loadAndConnect(),USER.channel||(loginButton=new bootstrap.Popover(elements.loginButton)),loginExpiredModal=new bootstrap.Modal(elements.loginExpiredModal),aboutModal=new bootstrap.Modal(elements.aboutModal),settingsOffcanvas=new bootstrap.Offcanvas(elements.settingsOffcanvas),enableTooltips(),enablePopovers(),elements.channelName.addEventListener("keydown",(e=>{"Enter"===e.key&&connect()})),elements.darkTheme.onchange=function(){switchTheme(this.checked),saveSettings()},elements.twitchGlobal.onchange=function(){EMOTEBENCHMARK.twitchGlobal=this.checked},elements.bttvGlobal.onchange=function(){EMOTEBENCHMARK.bttvGlobal=this.checked},elements.ffzGlobal.onchange=function(){EMOTEBENCHMARK.ffzGlobal=this.checked},elements.seventvGlobal.onchange=function(){EMOTEBENCHMARK.seventvGlobal=this.checked},elements.twitchChannel.onchange=function(){EMOTEBENCHMARK.twitchChannel=this.checked},elements.bttvChannel.onchange=function(){EMOTEBENCHMARK.bttvChannel=this.checked},elements.ffzChannel.onchange=function(){EMOTEBENCHMARK.ffzChannel=this.checked},elements.seventvChannel.onchange=function(){EMOTEBENCHMARK.seventvChannel=this.checked},elements.emotesPerRound.oninput=function(){EMOTEBENCHMARK.emotesPerRound=parseInt(this.value,10)||1,elements.emotesPerRoundLabel.innerHTML=this.value,elements.emotes.innerHTML=placeholder.repeat(this.value)},elements.turnLength.oninput=function(){EMOTEBENCHMARK.turnLength=1e3*(parseInt(this.value,10)||15),elements.turnLengthLabel.innerHTML=this.value},elements.emoteTimer.oninput=function(){EMOTEBENCHMARK.emoteTimer=1e3*(parseInt(this.value,10)||2),elements.emoteTimerLabel.innerHTML=this.value},allEmotes.twitchGlobal=await getGlobalTwitchEmotes(!0),allEmotes.bttvGlobal=await getGlobalBTTVEmotes(!0),allEmotes.ffzGlobal=await getGlobalFFZEmotes(!0),allEmotes.seventvGlobal=await getGlobal7TVEmotes(!0),elements.twitchGlobalCount.innerHTML=`<br>${allEmotes.twitchGlobal.length} emotes`,elements.bttvGlobalCount.innerHTML=`<br>${allEmotes.bttvGlobal.length} emotes`,elements.ffzGlobalCount.innerHTML=`<br>${allEmotes.ffzGlobal.length} emotes`,elements.seventvGlobalCount.innerHTML=`<br>${allEmotes.seventvGlobal.length} emotes`,USER.channel&&(allEmotes.twitchChannel=await getChannelTwitchEmotes(USER.channel,!0),allEmotes.bttvChannel=await getChannelBTTVEmotes(USER.userID,!0),allEmotes.ffzChannel=await getChannelFFZEmotes(USER.userID,!0),allEmotes.seventvChannel=await getChannel7TVEmotes(USER.userID,!0),elements.twitchChannelCount.innerHTML=`<br>${allEmotes.twitchChannel.length} emotes`,elements.bttvChannelCount.innerHTML=`<br>${allEmotes.bttvChannel.length} emotes`,elements.ffzChannelCount.innerHTML=`<br>${allEmotes.ffzChannel.length} emotes`,elements.seventvChannelCount.innerHTML=`<br>${allEmotes.seventvChannel.length} emotes`)};