let voters=[];const keyboardLayout=["QWERTYUIOP","ASDFGHJKL","<ZXCVBNM>"].map((e=>e.split("")));let loginButton,loginExpiredModal,aboutModal,elements={grid:document.getElementById("grid"),gameDiv:document.getElementById("gameDiv"),loginExpiredModal:document.getElementById("loginExpiredModal"),aboutModal:document.getElementById("aboutModal"),status:document.getElementById("status"),topRight:document.getElementById("topRight"),loginButton:document.getElementById("loginButton"),channelName:document.getElementById("channelName"),darkTheme:document.getElementById("darkTheme"),toastContainer:document.getElementById("toastContainer")},darkTheme=!0,USER={channel:"",twitchLogin:!1,access_token:"",userID:"",platform:""};function handleMessage(e,t,n,o){let r=n.split(" ").filter(Boolean);if(!WORDLE.nwstarted&&!voters.includes(t.username)){if(!r[0])return;let e=r[0].toLowerCase();if(!WORDLE.verifywords)return void addWord(e,t.username);if(WORDLE.words.includes(e))return void addWord(e,t.username)}}window.onload=function(){darkTheme="true"===(localStorage.getItem("darkTheme")||"true"),elements.darkTheme.checked=darkTheme??!0,switchTheme(elements.darkTheme.checked),loadAndConnect(),USER.channel||(loginButton=new bootstrap.Popover(elements.loginButton)),loginExpiredModal=new bootstrap.Modal(elements.loginExpiredModal),aboutModal=new bootstrap.Modal(elements.aboutModal),enableTooltips(),enablePopovers(),elements.channelName.addEventListener("keydown",(e=>{"Enter"===e.key&&connect()})),elements.darkTheme.onchange=function(){switchTheme(this.checked),saveSettings()},listeners(),loadwords(),drawKeyboard(),shownw()};let WORDLE={nwletter:0,nwrow:0,nwword:[],nwusers:"",nwstarted:!1,wordList:[],wordlength:5,guesslimit:6,multiword:!1,verifywords:!0,words:[],keys:{},colors:{good:"var(--bs-green)",bad:"var(--bs-orange)",dead:"var(--bs-dark-border-subtle)"}};function addWord(e,t){if((e=escapeString(e).toLowerCase()).length!=WORDLE.wordlength)return;let n=WORDLE.wordList.findIndex((t=>t.word===e));-1==n?WORDLE.wordList.push({word:e,usernames:[t]}):WORDLE.wordList[n].usernames.push(t),WORDLE.multiword||voters.push(t),document.getElementById("wordcount").innerHTML=`Submitted words: ${WORDLE.wordList.length}`}function startnw(){if(WORDLE.wordList.length<2)return void showToast("Chat needs to submit at least 2 words before you can start.","warning",6e3);showToast("A random word has been picked from chat's suggestions. Start guessing :)","success",6e3),document.getElementById("nwoutput2").innerHTML="",shownw(),WORDLE.nwletter=0,WORDLE.nwrow=0;let e=WORDLE.wordList[Math.floor(Math.random()*WORDLE.wordList.length)];WORDLE.nwword=e.word.split(""),WORDLE.nwusers=e.usernames.join(", "),WORDLE.nwstarted=!0,WORDLE.wordList=WORDLE.wordList.filter((t=>t.word!==e.word)),document.getElementById("wordcount").innerHTML=`Submitted words: ${WORDLE.wordList.length}`,document.getElementById("startnw").style.display="none",document.getElementById("resetnw").style.display="block"}function reset(){document.getElementById("startnw").style.display="block",document.getElementById("resetnw").style.display="none",WORDLE.wordList=[],document.getElementById("wordcount").innerHTML="Submitted words: 0",document.getElementById("nwoutput").innerHTML="",document.getElementById("nwoutput2").innerHTML="",WORDLE.nwletter=0,WORDLE.nwrow=0,WORDLE.nwword=[],WORDLE.nwusers="",WORDLE.words=[],WORDLE.nwstarted=!1,voters=[],shownw()}function shownw(){let e=0,t='<div class="container nwwrapper">';for(let n=0;n<WORDLE.guesslimit;n++){t+='<div class="row nwrows">';for(let n=0;n<WORDLE.wordlength;n++)t+=`<div class="col nwsquare" id="nw${e}"></div>`,e++;t+="</div>"}t+="</div>",document.getElementById("nwoutput").innerHTML=t;for(const e in WORDLE.keys)WORDLE.keys[e].style.backgroundColor=""}async function loadwords(){const e=await fetch(`/games/wordle/words/${WORDLE.wordlength}.json`),t=await e.json();WORDLE.words=Object.keys(t)}function pressKey(e){if(WORDLE.wordList.length<1||!WORDLE.nwstarted)return;let t=0;if("Enter"==e){let e=[],n=[...WORDLE.nwword];for(let t=0;t<WORDLE.wordlength;t++)e.push(document.getElementById(`nw${WORDLE.nwrow*WORDLE.wordlength+t}`).innerHTML.toLowerCase());if(e.includes(""))return;if(WORDLE.verifywords&&!WORDLE.words.includes(e.join("")))return void showToast(`"${e.join("")}" is not a word <img src="/pics/donk.png" alt="donk" style="height:24px; width:24px;">`,"danger",3e3);for(let o=0;o<WORDLE.wordlength;o++){const r=document.getElementById(`nw${WORDLE.nwrow*WORDLE.wordlength+o}`);if(r.style.backgroundColor=WORDLE.colors.dead,e[o]==WORDLE.nwword[o]){r.style.backgroundColor=WORDLE.colors.good;let d=n.indexOf(e[o]);d>-1&&n.splice(d,1),t++,t==WORDLE.wordlength&&(WORDLE.nwstarted=!1,document.getElementById("resetnw").style.display="none",document.getElementById("nwoutput2").innerHTML=`\n          <h2>Word guessed correctly!</h2>\n          <p>word submitted by: ${WORDLE.nwusers}</p>\n          <button type="button" onclick="startnw()" class="btn btn-success">Pick another word</button>\n          <button type="button" onclick="reset()" class="btn btn-warning">Reset</button>`)}}for(let t=0;t<WORDLE.wordlength;t++){const o=document.getElementById(`nw${WORDLE.nwrow*WORDLE.wordlength+t}`);if(n.includes(e[t])&&o.style.backgroundColor!=WORDLE.colors.good){o.style.backgroundColor=WORDLE.colors.bad;let r=n.indexOf(e[t]);r>-1&&n.splice(r,1)}}for(let e=0;e<WORDLE.wordlength;e++){const t=document.getElementById(`nw${WORDLE.nwrow*WORDLE.wordlength+e}`),n=WORDLE.keys[t.innerText];if(n)for(const e in WORDLE.colors){if(n.style.backgroundColor===WORDLE.colors[e])break;if(WORDLE.colors[e]===t.style.backgroundColor){n.style.backgroundColor=WORDLE.colors[e];break}}}WORDLE.nwrow++,WORDLE.nwrow==WORDLE.guesslimit&&(document.getElementById("nwoutput2").innerHTML=`\n      <h2>No more guesses left</h2>\n      <h2>Word: ${WORDLE.nwword.join("")}</h2>\n      <p>word submitted by: ${WORDLE.nwusers}</p>\n      <button type="button" onclick="startnw()" class="btn btn-success">Pick another word</button>\n      <button type="button" onclick="reset()" class="btn btn-warning">Reset</button>`,WORDLE.nwstarted=!1)}"Backspace"==e&&WORDLE.nwletter-WORDLE.nwrow*WORDLE.wordlength>0&&(document.getElementById("nw"+(WORDLE.nwletter-1)).innerHTML="",WORDLE.nwletter--),1===e.length&&e.toLowerCase()>="a"&&e.toLowerCase()<="z"&&WORDLE.nwletter-WORDLE.nwrow*WORDLE.wordlength<WORDLE.wordlength&&(document.getElementById(`nw${WORDLE.nwletter}`).innerHTML=e.toUpperCase(),WORDLE.nwletter++)}function listeners(){document.getElementById("multiword").onchange=function(){voters=[],WORDLE.multiword=this.checked},document.getElementById("verifywords").onchange=function(){WORDLE.verifywords=this.checked,WORDLE.verifywords&&reset()},document.addEventListener("keydown",(function(e){e.key&&pressKey(e.key)}))}function updateLabel(e){switch(document.getElementById(`${e.id}label`).innerHTML=e.value,document.getElementById(e.id)!=e.value&&(document.getElementById(e.id).value=e.value),e.id){case"wordlength":WORDLE.wordlength=e.value;break;case"guesslimit":WORDLE.guesslimit=e.value;break;default:break}voters=[],WORDLE.words=[],WORDLE.wordList=[],document.getElementById("wordcount").innerHTML="Submitted words: 0",document.getElementById("nwoutput").innerHTML="",document.getElementById("nwoutput2").innerHTML="",WORDLE.nwletter=0,WORDLE.nwrow=0,WORDLE.nwword=[],WORDLE.nwusers="",shownw()}function drawKeyboard(){const e=document.getElementById("nwkeyboard");keyboardLayout.forEach((t=>{const n=document.createElement("div");n.classList="nw-keyboard-row";for(const e of t){const t=document.createElement("button");switch(t.classList="btn btn-secondary nw-keyboard-key",e){case"<":t.classList.add("nw-keyboard-key-wide"),t.innerHTML='<span class="material-icons notranslate">backspace</span>',t.addEventListener("click",(()=>pressKey("Backspace")));break;case">":t.classList.add("nw-keyboard-key-wide"),t.innerHTML='<span class="material-icons notranslate">send</span>',t.addEventListener("click",(()=>pressKey("Enter")));break;default:WORDLE.keys[e]=t,t.innerHTML=e,t.addEventListener("click",(()=>pressKey(e)));break}n.appendChild(t)}e.appendChild(n)}))}