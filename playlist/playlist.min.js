let elements={dankUpdateModal:document.getElementById("dankUpdateModal"),loginExpiredModal:document.getElementById("loginExpiredModal"),banlistModal:document.getElementById("banlistModal"),bannedUsersList:document.getElementById("bannedUsersList"),bannedItemsList:document.getElementById("bannedItemsList"),bannedChannelsList:document.getElementById("bannedChannelsList"),bannedUserCount:document.getElementById("bannedUserCount"),bannedItemCount:document.getElementById("bannedItemCount"),bannedChannelCount:document.getElementById("bannedChannelCount"),voteSkipDiv:document.getElementById("voteSkipDiv"),voteSkipHint:document.getElementById("voteSkipHint"),voteSkipVotes:document.getElementById("voteSkipVotes"),status:document.getElementById("status"),topRight:document.getElementById("topRight"),loginButton:document.getElementById("loginButton"),channelName:document.getElementById("channelName"),darkTheme:document.getElementById("darkTheme"),settingsOffcanvas:document.getElementById("settingsOffcanvas"),allowSpotifySongs:document.getElementById("allowSpotifySongs"),allowStreamable:document.getElementById("allowStreamable"),allowTwitchClips:document.getElementById("allowTwitchClips"),allowTwitchStreams:document.getElementById("allowTwitchStreams"),allowTwitchVODs:document.getElementById("allowTwitchVODs"),allowTiktokVideos:document.getElementById("allowTiktokVideos"),allowYTStreams:document.getElementById("allowYTStreams"),allowYTShorts:document.getElementById("allowYTShorts"),allowYTVideos:document.getElementById("allowYTVideos"),allowVimeoVideos:document.getElementById("allowVimeoVideos"),maxDuration:document.getElementById("maxDuration"),maxDurationUnit:document.getElementById("maxDurationUnit"),maxLength:document.getElementById("maxLength"),maxSize:document.getElementById("maxSize"),minViewCount:document.getElementById("minViewCount"),minUploadAge:document.getElementById("minUploadAge"),minUploadAgeUnit:document.getElementById("minUploadAgeUnit"),maxUploadAge:document.getElementById("maxUploadAge"),maxUploadAgeUnit:document.getElementById("maxUploadAgeUnit"),uploadAgeDesc:document.getElementById("uploadAgeDesc"),uniqueOnly:document.getElementById("uniqueOnly"),whoCanRequest:document.getElementById("whoCanRequest"),allowPlebs:document.getElementById("allowPlebs"),allowSubs:document.getElementById("allowSubs"),allowMods:document.getElementById("allowMods"),allowVips:document.getElementById("allowVips"),allowFirstTimeChatters:document.getElementById("allowFirstTimeChatters"),plebLimit:document.getElementById("plebLimit"),subLimit:document.getElementById("subLimit"),modLimit:document.getElementById("modLimit"),vipLimit:document.getElementById("vipLimit"),firstTimeChatterLimit:document.getElementById("firstTimeChatterLimit"),selectAll:document.getElementById("selectAll"),unselectAll:document.getElementById("unselectAll"),noCommand:document.getElementById("noCommand"),requestCommand:document.getElementById("requestCommand"),requestCommandAlias:document.getElementById("requestCommandAlias"),allowVoteSkip:document.getElementById("allowVoteSkip"),voteskipCommand:document.getElementById("voteskipCommand"),voteskipCommandAlias:document.getElementById("voteskipCommandAlias"),voteskipCount:document.getElementById("voteskipCount"),enableBot:document.getElementById("enableBot"),botCooldown:document.getElementById("botCooldown"),songCommand:document.getElementById("songCommand"),songCommandAlias:document.getElementById("songCommandAlias"),playlistCommand:document.getElementById("playlistCommand"),playlistCommandAlias:document.getElementById("playlistCommandAlias"),approvalQueue:document.getElementById("approvalQueue"),openCommand:document.getElementById("openCommand"),closeCommand:document.getElementById("closeCommand"),playCommand:document.getElementById("playCommand"),pauseCommand:document.getElementById("pauseCommand"),autoplayCommand:document.getElementById("autoplayCommand"),skipCommand:document.getElementById("skipCommand"),rewindCommand:document.getElementById("rewindCommand"),deleteCommand:document.getElementById("deleteCommand"),modCommands:document.getElementById("modCommands"),toastContainer:document.getElementById("toastContainer"),playersCard:document.getElementById("playersCard"),placeholder:document.getElementById("placeholder"),youtubeEmbedContainer:document.getElementById("youtubeEmbedContainer"),youtubeEmbed:document.getElementById("youtubeEmbed"),vimeoEmbedContainer:document.getElementById("vimeoEmbedContainer"),vimeoEmbed:document.getElementById("vimeoEmbed"),spotifyEmbedContainer:document.getElementById("spotifyEmbedContainer"),spotifyEmbed:document.getElementById("spotifyEmbed"),twitchEmbed:document.getElementById("twitchEmbed"),twitchClipsEmbed:document.getElementById("twitchClipsEmbed"),tiktokEmbed:document.getElementById("tiktokEmbed"),videoEmbed:document.getElementById("videoEmbed"),commandHint:document.getElementById("commandHint"),commandHint2:document.getElementById("commandHint2"),link:document.getElementById("link"),playlistTab:document.getElementById("playlistTab"),approvalTabButton:document.getElementById("approvalTabButton"),approvalTab:document.getElementById("approvalTab"),mainList:document.getElementById("mainList"),approvalList:document.getElementById("approvalList"),historyTab:document.getElementById("historyTab"),historyCount:document.getElementById("historyCount"),historyList:document.getElementById("historyList"),profileLink:document.getElementById("profileLink"),copyLinkButton:document.getElementById("copyLinkButton"),nowPlaying:document.getElementById("nowPlaying"),nowPlayingRequester:document.getElementById("nowPlayingRequester"),nowPlayingInfo:document.getElementById("nowPlayingInfo"),nowPlayingBanButtons:document.getElementById("nowPlayingBanButtons"),playlistLength:document.getElementById("playlistLength"),togglePlaylist:document.getElementById("togglePlaylist"),autoplay:document.getElementById("autoplay"),volumeSliderIcon:document.getElementById("volumeSliderIcon"),volumeSlider:document.getElementById("volumeSlider"),volumeSliderValue:document.getElementById("volumeSliderValue")};const{animate:animate}=anime;let client,loginButton,settingsOffcanvas,dankUpdateModal,loginExpiredModal,banlistModal,copyLinkButton,playlistTab,approvalTab,historyTab,togglePlaylistPopover,currentTime=0,playlist_open=!1,playlist_playing=!1,total_duration=0,streamerColor="",users=[],requests=new Map,history=[],bannedUsers=new Map,bannedItems=new Map,bannedChannels=new Map,firstTimeChatters=[],skippers=[],USER={channel:"",twitchLogin:!1,access_token:"",userID:"",platform:""},PLAYLIST={autoplay:!0,allowSpotifySongs:!0,allowStreamable:!0,allowTwitchClips:!0,allowTwitchStreams:!0,allowTwitchVODs:!0,allowTiktokVideos:!0,allowYTStreams:!0,allowYTShorts:!0,allowYTVideos:!0,allowVimeoVideos:!0,maxDuration:"",maxDurationUnit:"m",maxLength:"",maxSize:"",minViewCount:"",minUploadAge:"",minUploadAgeUnit:"h",maxUploadAge:"",maxUploadAgeUnit:"h",uniqueOnly:!1,allowPlebs:!0,allowSubs:!0,allowMods:!0,allowVips:!0,allowFirstTimeChatters:!0,plebLimit:"",subLimit:"",modLimit:"",vipLimit:"",firstTimeChatterLimit:"",noCommand:!1,requestCommand:"!request",requestCommandAlias:"!r",allowVoteSkip:!1,voteskipCommand:"!voteskip",voteskipCommandAlias:"!vs",voteskipCount:100,enableBot:!1,botCooldown:1,songCommand:"!song",songCommandAlias:"!video",playlistCommand:"!playlist",playlistCommandAlias:"!pl",approvalQueue:!1,openCommand:"!open",closeCommand:"!close",playCommand:"!play",pauseCommand:"!pause",autoplayCommand:"!autoplay",skipCommand:"!skip",rewindCommand:"!rewind",deleteCommand:"!delete",modCommands:!0};async function refreshData(){darkTheme=elements.darkTheme.checked??!0,USER.twitchLogin||(USER.channel=escapeString(elements.channelName.value.replace(/\s+/g,"").toLowerCase()),USER.platform="twitch"),!USER.userID&&USER.channel&&(USER.userID=await getUserID(USER.channel)),PLAYLIST.autoplay=elements.autoplay.checked,PLAYLIST.allowSpotifySongs=elements.allowSpotifySongs.checked,PLAYLIST.allowStreamable=elements.allowStreamable.checked,PLAYLIST.allowTwitchClips=elements.allowTwitchClips.checked,PLAYLIST.allowTwitchStreams=elements.allowTwitchStreams.checked,PLAYLIST.allowTwitchVODs=elements.allowTwitchVODs.checked,PLAYLIST.allowTiktokVideos=elements.allowTiktokVideos.checked,PLAYLIST.allowYTStreams=elements.allowYTStreams.checked,PLAYLIST.allowYTShorts=elements.allowYTShorts.checked,PLAYLIST.allowYTVideos=elements.allowYTVideos.checked,PLAYLIST.allowVimeoVideos=elements.allowVimeoVideos.checked,PLAYLIST.maxDuration=parseInt(elements.maxDuration.value,10)||"",PLAYLIST.maxDurationUnit=elements.maxDurationUnit.value||"m",PLAYLIST.maxLength=parseInt(elements.maxLength.value,10)||"",PLAYLIST.maxSize=parseInt(elements.maxSize.value,10)||"",PLAYLIST.minViewCount=parseInt(elements.minViewCount.value,10)||"",PLAYLIST.minUploadAge=parseInt(elements.minUploadAge.value,10)||"",PLAYLIST.minUploadAgeUnit=elements.minUploadAgeUnit.value||"h",PLAYLIST.maxUploadAge=parseInt(elements.maxUploadAge.value,10)||"",PLAYLIST.maxUploadAgeUnit=elements.maxUploadAgeUnit.value||"h",PLAYLIST.uniqueOnly=elements.uniqueOnly.checked,PLAYLIST.allowPlebs=elements.allowPlebs.checked,PLAYLIST.allowSubs=elements.allowSubs.checked,PLAYLIST.allowMods=elements.allowMods.checked,PLAYLIST.allowVips=elements.allowVips.checked,PLAYLIST.allowFirstTimeChatters=elements.allowFirstTimeChatters.checked,PLAYLIST.plebLimit=parseInt(elements.plebLimit.value,10)||"",PLAYLIST.subLimit=parseInt(elements.subLimit.value,10)||"",PLAYLIST.modLimit=parseInt(elements.modLimit.value,10)||"",PLAYLIST.vipLimit=parseInt(elements.vipLimit.value,10)||"",PLAYLIST.firstTimeChatterLimit=parseInt(elements.firstTimeChatterLimit.value,10)||"",PLAYLIST.noCommand=elements.noCommand.checked,PLAYLIST.requestCommand=elements.requestCommand.value.replace(/\s+/g,"").toLowerCase()||"!request",PLAYLIST.requestCommandAlias=elements.requestCommandAlias.value.replace(/\s+/g,"").toLowerCase()||"!r",PLAYLIST.allowVoteSkip=elements.allowVoteSkip.checked,PLAYLIST.voteskipCommand=elements.voteskipCommand.value.replace(/\s+/g,"").toLowerCase()||"!voteskip",PLAYLIST.voteskipCommandAlias=elements.voteskipCommandAlias.value.replace(/\s+/g,"").toLowerCase()||"!vs",PLAYLIST.voteskipCount=parseInt(elements.voteskipCount.value,10)||100,PLAYLIST.enableBot=elements.enableBot.checked,PLAYLIST.botCooldown=parseInt(elements.botCooldown.value,10)||1,PLAYLIST.songCommand=elements.songCommand.value.replace(/\s+/g,"").toLowerCase()||"!song",PLAYLIST.songCommandAlias=elements.songCommandAlias.value.replace(/\s+/g,"").toLowerCase()||"!video",PLAYLIST.playlistCommand=elements.playlistCommand.value.replace(/\s+/g,"").toLowerCase()||"!playlist",PLAYLIST.playlistCommandAlias=elements.playlistCommandAlias.value.replace(/\s+/g,"").toLowerCase()||"!pl",PLAYLIST.approvalQueue=elements.approvalQueue.checked,PLAYLIST.openCommand=elements.openCommand.value.replace(/\s+/g,"").toLowerCase()||"!open",PLAYLIST.closeCommand=elements.closeCommand.value.replace(/\s+/g,"").toLowerCase()||"!close",PLAYLIST.playCommand=elements.playCommand.value.replace(/\s+/g,"").toLowerCase()||"!play",PLAYLIST.pauseCommand=elements.pauseCommand.value.replace(/\s+/g,"").toLowerCase()||"!pause",PLAYLIST.autoplayCommand=elements.autoplayCommand.value.replace(/\s+/g,"").toLowerCase()||"!autoplay",PLAYLIST.skipCommand=elements.skipCommand.value.replace(/\s+/g,"").toLowerCase()||"!skip",PLAYLIST.rewindCommand=elements.rewindCommand.value.replace(/\s+/g,"").toLowerCase()||"!rewind",PLAYLIST.deleteCommand=elements.deleteCommand.value.replace(/\s+/g,"").toLowerCase()||"!delete",PLAYLIST.modCommands=elements.modCommands.checked,elements.voteskipCommand.disabled=!PLAYLIST.allowVoteSkip,elements.voteskipCommandAlias.disabled=!PLAYLIST.allowVoteSkip,elements.voteskipCount.disabled=!PLAYLIST.allowVoteSkip,elements.botCooldown.disabled=!PLAYLIST.enableBot,elements.songCommand.disabled=!PLAYLIST.enableBot,elements.songCommandAlias.disabled=!PLAYLIST.enableBot,elements.playlistCommand.disabled=!PLAYLIST.enableBot,elements.playlistCommandAlias.disabled=!PLAYLIST.enableBot,elements.approvalTabButton.style.display=PLAYLIST.approvalQueue?"":"none",elements.voteSkipHint.innerHTML=`<strong>${PLAYLIST.voteskipCommand}</strong> or <strong>${PLAYLIST.voteskipCommandAlias}</strong>`,PLAYLIST.noCommand?(elements.commandHint.innerHTML="Add songs or videos to the playlist by posting a link in chat",elements.commandHint2.innerHTML="Request something by posting a link in chat"):(elements.commandHint.innerHTML=`Add songs or videos to the playlist using \n    <kbd class="notranslate text-success cursor-pointer" onclick="editRequestCommand()">${PLAYLIST.requestCommand} [link]</kbd> or \n    <kbd class="notranslate text-success cursor-pointer" onclick="editRequestCommand(true)">${PLAYLIST.requestCommandAlias} [link]</kbd>`,elements.commandHint2.innerHTML=`Request something using<br />\n    <kbd class="notranslate text-success cursor-pointer" onclick="editRequestCommand()">${PLAYLIST.requestCommand} [link]</kbd> or \n    <kbd class="notranslate text-success cursor-pointer" onclick="editRequestCommand(true)">${PLAYLIST.requestCommandAlias} [link]</kbd>`);let e=1e3*numberAndUnitToSeconds(PLAYLIST.minUploadAge,PLAYLIST.minUploadAgeUnit),t=1e3*numberAndUnitToSeconds(PLAYLIST.maxUploadAge,PLAYLIST.maxUploadAgeUnit),n=Date.now();e>0&&t>0&&e==t&&(PLAYLIST.minUploadAge="",PLAYLIST.maxUploadAge="",elements.minUploadAge.value="",elements.maxUploadAge.value="",showToast("Limits can't be the same","warning",3e3)),e>0&&t>0&&e>t&&(PLAYLIST.minUploadAge="",PLAYLIST.maxUploadAge="",elements.minUploadAge.value="",elements.maxUploadAge.value="",showToast("Older than limit must be less than the Newer than limit","warning",5e3)),PLAYLIST.minUploadAge&&PLAYLIST.maxUploadAge&&(elements.uploadAgeDesc.innerHTML=`Content must be uploaded between ${new Date(n-t).toLocaleString("en-GB")} and ${new Date(n-e).toLocaleString("en-GB")}`),PLAYLIST.minUploadAge&&!PLAYLIST.maxUploadAge&&(elements.uploadAgeDesc.innerHTML=`Content must be uploaded before ${new Date(n-e).toLocaleString("en-GB")}`),!PLAYLIST.minUploadAge&&PLAYLIST.maxUploadAge&&(elements.uploadAgeDesc.innerHTML=`Content must be uploaded after ${new Date(n-t).toLocaleString("en-GB")}`),PLAYLIST.minUploadAge||PLAYLIST.maxUploadAge||(elements.uploadAgeDesc.innerHTML="No age limits set"),updateWhoCanRequest(),checkCommands()}function saveSettings(){refreshData(),localStorage.setItem("USER",JSON.stringify(USER)),localStorage.setItem("PLAYLIST",JSON.stringify(PLAYLIST)),localforage.setItem("PLAYLIST_REQUESTS",JSON.stringify(requests,replacer)),localforage.setItem("PLAYLIST_HISTORY",JSON.stringify(history)),localforage.setItem("PLAYLIST_BANNED_USERS",JSON.stringify(bannedUsers,replacer)),localforage.setItem("PLAYLIST_BANNED_ITEMS",JSON.stringify(bannedItems,replacer)),localforage.setItem("PLAYLIST_BANNED_CHANNELS",JSON.stringify(bannedChannels,replacer)),localStorage.setItem("darkTheme",darkTheme),updateSite()}async function load_localStorage(){localStorage.getItem("USER")?(USER=JSON.parse(localStorage.getItem("USER")),elements.channelName.value=USER.channel):console.log("localStorage user info not found"),localStorage.getItem("PLAYLIST")?(PLAYLIST=JSON.parse(localStorage.getItem("PLAYLIST")),elements.autoplay.checked=PLAYLIST.autoplay??!0,elements.allowSpotifySongs.checked=PLAYLIST.allowSpotifySongs??!0,elements.allowStreamable.checked=PLAYLIST.allowStreamable??!0,elements.allowTwitchClips.checked=PLAYLIST.allowTwitchClips??!0,elements.allowTwitchStreams.checked=PLAYLIST.allowTwitchStreams??!0,elements.allowTwitchVODs.checked=PLAYLIST.allowTwitchVODs??!0,elements.allowTiktokVideos.checked=PLAYLIST.allowTiktokVideos??!0,elements.allowYTStreams.checked=PLAYLIST.allowYTStreams??!0,elements.allowYTShorts.checked=PLAYLIST.allowYTShorts??!0,elements.allowYTVideos.checked=PLAYLIST.allowYTVideos??!0,elements.allowVimeoVideos.checked=PLAYLIST.allowVimeoVideos??!0,elements.maxDuration.value=PLAYLIST.maxDuration||"",elements.maxDurationUnit.value=PLAYLIST.maxDurationUnit||"m",elements.maxLength.value=PLAYLIST.maxLength||"",elements.maxSize.value=PLAYLIST.maxSize||"",elements.minViewCount.value=PLAYLIST.minViewCount||"",elements.minUploadAge.value=PLAYLIST.minUploadAge||"",elements.minUploadAgeUnit.value=PLAYLIST.minUploadAgeUnit||"h",elements.maxUploadAge.value=PLAYLIST.maxUploadAge||"",elements.maxUploadAgeUnit.value=PLAYLIST.maxUploadAgeUnit||"h",elements.uniqueOnly.checked=PLAYLIST.uniqueOnly??!1,elements.allowPlebs.checked=PLAYLIST.allowPlebs??!0,elements.allowSubs.checked=PLAYLIST.allowSubs??!0,elements.allowMods.checked=PLAYLIST.allowMods??!0,elements.allowVips.checked=PLAYLIST.allowVips??!0,elements.allowFirstTimeChatters.checked=PLAYLIST.allowFirstTimeChatters??!0,elements.plebLimit.value=PLAYLIST.plebLimit||"",elements.subLimit.value=PLAYLIST.subLimit||"",elements.modLimit.value=PLAYLIST.modLimit||"",elements.vipLimit.value=PLAYLIST.vipLimit||"",elements.firstTimeChatterLimit.value=PLAYLIST.firstTimeChatterLimit||"",elements.noCommand.checked=PLAYLIST.noCommand??!1,elements.requestCommand.value=PLAYLIST.requestCommand||"!request",elements.requestCommandAlias.value=PLAYLIST.requestCommandAlias||"!r",elements.allowVoteSkip.checked=PLAYLIST.allowVoteSkip??!1,elements.voteskipCommand.value=PLAYLIST.voteskipCommand||"!voteskip",elements.voteskipCommandAlias.value=PLAYLIST.voteskipCommandAlias||"!vs",elements.voteskipCount.value=PLAYLIST.voteskipCount||100,elements.enableBot.checked=PLAYLIST.enableBot??!1,elements.botCooldown.value=PLAYLIST.botCooldown||1,elements.songCommand.value=PLAYLIST.songCommand||"!song",elements.songCommandAlias.value=PLAYLIST.songCommandAlias||"!video",elements.playlistCommand.value=PLAYLIST.playlistCommand||"!playlist",elements.playlistCommandAlias.value=PLAYLIST.playlistCommandAlias||"!pl",elements.approvalQueue.checked=PLAYLIST.approvalQueue??!1,elements.openCommand.value=PLAYLIST.openCommand||"!open",elements.closeCommand.value=PLAYLIST.closeCommand||"!close",elements.playCommand.value=PLAYLIST.playCommand||"!play",elements.pauseCommand.value=PLAYLIST.pauseCommand||"!pause",elements.autoplayCommand.value=PLAYLIST.autoplayCommand||"!autoplay",elements.skipCommand.value=PLAYLIST.skipCommand||"!skip",elements.rewindCommand.value=PLAYLIST.rewindCommand||"!rewind",elements.deleteCommand.value=PLAYLIST.deleteCommand||"!delete",elements.modCommands.checked=PLAYLIST.modCommands??!0,elements.voteskipCommand.disabled=!PLAYLIST.allowVoteSkip,elements.voteskipCommandAlias.disabled=!PLAYLIST.allowVoteSkip,elements.voteskipCount.disabled=!PLAYLIST.allowVoteSkip,elements.botCooldown.disabled=!PLAYLIST.enableBot,elements.songCommand.disabled=!PLAYLIST.enableBot,elements.songCommandAlias.disabled=!PLAYLIST.enableBot,elements.playlistCommand.disabled=!PLAYLIST.enableBot,elements.playlistCommandAlias.disabled=!PLAYLIST.enableBot,elements.approvalTabButton.style.display=PLAYLIST.approvalQueue?"":"none",elements.voteSkipHint.innerHTML=`<strong>${PLAYLIST.voteskipCommand}</strong> or <strong>${PLAYLIST.voteskipCommandAlias}</strong>`,PLAYLIST.noCommand?(elements.commandHint.innerHTML="Add songs or videos to the playlist by posting a link in chat",elements.commandHint2.innerHTML="Request something by posting a link in chat"):(elements.commandHint.innerHTML=`Add songs or videos to the playlist using \n      <kbd class="notranslate text-success cursor-pointer" onclick="editRequestCommand()">${PLAYLIST.requestCommand}</kbd> or \n      <kbd class="notranslate text-success cursor-pointer" onclick="editRequestCommand(true)">${PLAYLIST.requestCommandAlias}</kbd>`,elements.commandHint2.innerHTML=`Request something using \n      <kbd class="notranslate text-success cursor-pointer" onclick="editRequestCommand()">${PLAYLIST.requestCommand} [link]</kbd> or \n      <kbd class="notranslate text-success cursor-pointer" onclick="editRequestCommand(true)">${PLAYLIST.requestCommandAlias} [link]</kbd>`),updateWhoCanRequest(),checkCommands()):console.log("localStorage settings not found"),localforage.config({driver:localforage.INDEXEDDB,name:"chat.vote/playlist",version:1,storeName:"playlist",description:"playlist requests and history"});try{const e=await localforage.getItem("PLAYLIST_REQUESTS");if(e){requests=JSON.parse(e,reviver),requests instanceof Map!=!0&&(requests=new Map);let t=!1;for(let e of requests.values())e?.name||(t=!0),addToPlaylist(e),updatePlaylist(e,!0);t&&dankUpdateModal.show(),updateLength(),rebuildUsersArray()}else console.log("localStorage playlist requests not found")}catch(e){console.log(e)}try{const e=await localforage.getItem("PLAYLIST_HISTORY");if(e){history=JSON.parse(e);for(let e=0;e<history.length;e++)addToHistory(history[e],!0);elements.historyCount.innerHTML=`${history.length.toLocaleString()} ${1==history.length?"request":"requests"}`}else console.log("localStorage playlist history not found")}catch(e){console.log(e)}try{const e=await localforage.getItem("PLAYLIST_BANNED_USERS");e?bannedUsers=JSON.parse(e,reviver):console.log("localStorage playlist banned users not found")}catch(e){console.log(e)}try{const e=await localforage.getItem("PLAYLIST_BANNED_ITEMS");e?bannedItems=JSON.parse(e,reviver):console.log("localStorage playlist banned items not found")}catch(e){console.log(e)}try{const e=await localforage.getItem("PLAYLIST_BANNED_CHANNELS");e?bannedChannels=JSON.parse(e,reviver):console.log("localStorage playlist banned channels not found")}catch(e){console.log(e)}}function rebuildUsersArray(){for(const[e,t]of requests.entries())for(let n=0;n<t.by.length;n++){const a=users.findIndex((e=>e.id===t.by[n].id));a>-1?users[a].requests.push(e):users.push({id:t.by[n].id,username:t.by[n].username,displayName:t.by[n].displayName,mod:t.by[n].mod,sub:t.by[n].subscriber,vip:t.by[n].vip,firstTimeChatter:t.by[n].firstTimeChatter,badges:t.by[n].badges,color:t.by[n].color,requests:[e]})}}function resetSettings(e=!1){return e&&(localStorage.setItem("USER",JSON.stringify({channel:"",twitchLogin:!1,access_token:"",userID:"",platform:""})),localforage.setItem("PLAYLIST_REQUESTS",JSON.stringify(new Map,replacer)),localforage.setItem("PLAYLIST_HISTORY",JSON.stringify([])),localforage.setItem("PLAYLIST_BANNED_USERS",JSON.stringify(new Map,replacer)),localforage.setItem("PLAYLIST_BANNED_ITEMS",JSON.stringify(new Map,replacer)),localforage.setItem("PLAYLIST_BANNED_CHANNELS",JSON.stringify(new Map,replacer))),localStorage.setItem("PLAYLIST",JSON.stringify({autoplay:!0,allowSpotifySongs:!0,allowStreamable:!0,allowTwitchClips:!0,allowTwitchStreams:!0,allowTwitchVODs:!0,allowTiktokVideos:!0,allowYTStreams:!0,allowYTShorts:!0,allowYTVideos:!0,allowVimeoVideos:!0,maxDuration:"",maxDurationUnit:"m",maxLength:"",maxSize:"",minViewCount:"",minUploadAge:"",minUploadAgeUnit:"h",maxUploadAge:"",maxUploadAgeUnit:"h",uniqueOnly:!1,allowPlebs:!0,allowSubs:!0,allowMods:!0,allowVips:!0,allowFirstTimeChatters:!0,plebLimit:"",subLimit:"",modLimit:"",vipLimit:"",firstTimeChatterLimit:"",noCommand:!1,requestCommand:"!request",requestCommandAlias:"!r",allowVoteSkip:!1,voteskipCommand:"!voteskip",voteskipCommandAlias:"!vs",voteskipCount:100,enableBot:!1,botCooldown:1,songCommand:"!song",songCommandAlias:"!video",playlistCommand:"!playlist",playlistCommandAlias:"!pl",approvalQueue:!1,openCommand:"!open",closeCommand:"!close",playCommand:"!play",pauseCommand:"!pause",autoplayCommand:"!autoplay",skipCommand:"!skip",rewindCommand:"!rewind",deleteCommand:"!delete",modCommands:!0})),location.reload(),!1}function login(){return elements.topRight.innerHTML='<div class="btn-group" role="group" aria-label="log in button group">\n    <button type="button" class="btn btn-twitch"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div></button>\n    <div class="btn-group" role="group">\n        <button id="btnGroupDropLogin" type="button" class="btn btn-twitch dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">\n      </button>\n        <ul class="dropdown-menu dropdown-menu-lg-end" aria-label="Log out">\n            <li><a class="dropdown-item" onclick="logout()" href="#"><i class="material-icons notranslate">logout</i>Log out</a></li>\n        </ul>\n    </div>\n</div>',window.open("/prompt.html","loginWindow","toolbar=0,status=0,scrollbars=0,width=500px,height=800px"),!1}function connect(){elements.status.innerHTML='\n  <h4>\n  <span class="badge bg-warning">Connecting... \n  <div class="spinner-border" style="width:18px;height:18px;" role="status"><span class="visually-hidden">Loading...</span></div>\n  </span>\n  </h4>',elements.topRight.innerHTML='\n  <div class="btn-group" role="group" aria-label="log in button group">\n  <button type="button" class="btn btn-twitch"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div></button>\n  <div class="btn-group" role="group">\n  <button id="btnGroupDropLogin" type="button" class="btn btn-twitch dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"></button>\n  <ul class="dropdown-menu dropdown-menu-lg-end" aria-label="Log out">\n  <li><a class="dropdown-item" onclick="logout()" href="#"><i class="material-icons notranslate">logout</i>Log out</a></li>\n  </ul>\n  </div>\n  </div>',refreshData(),loadBadges(USER.channel);let e={options:{clientId:CLIENT_ID,debug:!1},connection:{secure:!0,reconnect:!0},channels:[USER.channel]};client=new tmi.client(e),client.on("message",(async(e,t,n,a)=>{t["first-msg"]&&firstTimeChatters.push(t.username);let o=n.split(" ").filter(Boolean);if(PLAYLIST.noCommand&&playlist_open){if(bannedUsers.get(t["user-id"]))return void botReply("ðŸš« You are banned",t.id,!1);let e=o[0],n=!1;"youtube"!=o[0].toLowerCase()&&"spotify"!=o[0].toLowerCase()&&"vimeo"!=o[0].toLowerCase()||(e=o.join(" "),n=!0);let a=await parseLink(e);if(a&&o[o.length-1]?.toLowerCase().startsWith("start=")&&(a.timestamp=timeToSeconds(o[o.length-1].split("=")[1])),a&&linkTypeAllowed(a.type))return void addRequest(t,a,t.id,n);if(a&&!linkTypeAllowed(a.type))return void botReply(`ðŸš« ${a.type} links are not enabled`,t.id,!1)}let l=o[0].toLowerCase();switch(l){case PLAYLIST.requestCommand:case PLAYLIST.requestCommandAlias:if(!o[1])return;if(!playlist_open&&(Date.now()-currentTime)/1e3>10)return currentTime=Date.now(),togglePlaylistPopover.show(),void setTimeout((function(){togglePlaylistPopover.hide()}),2e3);if(!playlist_open)return;if(bannedUsers.get(t["user-id"]))return void botReply("ðŸš« You are banned",t.id,!1);let e=o[1],n=!1;"youtube"!=o[1].toLowerCase()&&"spotify"!=o[1].toLowerCase()&&"vimeo"!=o[1].toLowerCase()||(e=o.slice(1).join(" "),n=!0);let a=await parseLink(e);if(!a)return;if(!linkTypeAllowed(a.type))return void botReply(`ðŸš« ${a.type} links are not enabled`,t.id,!1);o[o.length-1]?.toLowerCase().startsWith("start=")&&(a.timestamp=timeToSeconds(o[o.length-1].split("=")[1])),addRequest(t,a,t.id,n);break;case PLAYLIST.voteskipCommand:case PLAYLIST.voteskipCommandAlias:if(bannedUsers.get(t["user-id"]))return;voteSkip(t["user-id"]);break;case PLAYLIST.songCommand:case PLAYLIST.songCommandAlias:if(currentItem){if(bannedUsers.get(t["user-id"]))return void botReply("ðŸš« You are banned",t.id,!1);botReply(`Now playing: ${getItemLink(currentItem)} | Requested by @${currentItem.by[0].username} ${currentItem.by.length>1?`and ${currentItem.by.length-1} other ${currentItem.by.length-1==1?"user":"users"}`:""}`,t.id,!0)}break;case PLAYLIST.playlistCommand:case PLAYLIST.playlistCommandAlias:if(USER.access_token){if(bannedUsers.get(t["user-id"]))return void botReply("ðŸš« You are banned",t.id,!1);botReply(`You can view the playlist here: https://playlist.chat.vote/${USER.channel}`,t.id,!0)}break;default:break}if((Date.now()-botCooldown)/1e3>PLAYLIST.botCooldown&&(t.username==USER.channel||PLAYLIST.modCommands&&t.mod))switch(botCooldown=Date.now(),l){case PLAYLIST.openCommand:openPlaylist(t.id);break;case PLAYLIST.closeCommand:closePlaylist(t.id);break;case PLAYLIST.playCommand:playPlaylist(t.id);break;case PLAYLIST.pauseCommand:pausePlaylist(t.id);break;case PLAYLIST.autoplayCommand:toggleAutoplay(t.id);break;case PLAYLIST.skipCommand:nextItem(t.id);break;case PLAYLIST.rewindCommand:previousItem(t.id);break;case PLAYLIST.deleteCommand:deleteItem(o[1],t.id);break;default:break}})),client.on("messagedeleted",((e,t,n,a)=>{const o=findRequestKey("msgid",a["target-msg-id"]);o&&deleteRequest(o,!1)})),client.on("connected",(async(e,t)=>{console.log(`Connected to ${e}:${t}`),elements.status.innerHTML='<h4><span class="badge bg-success">Connected :)</span></h4>',saveSettings(),sendUsername("chat.vote/playlist",USER.channel,"twitch"==USER.platform?`twitch - ${USER.twitchLogin}`:"youtube"),loadPFP()})),client.on("disconnected",(e=>{elements.status.innerHTML=`<h4><span class="badge bg-danger">Disconnected: ${e}</span></h4>`})),client.on("notice",((e,t,n)=>{elements.status.innerHTML=`<h4><span class="badge bg-danger">Disconnected: ${n}</span></h4>`})),client.connect().catch(console.error)}function getUser(e){const t=users.findIndex((t=>t.id===e["user-id"]));return-1==t?(users.push({id:e["user-id"],username:e.username,displayName:e["display-name"],mod:e?.mod||!1,sub:e?.subscriber||!1,vip:e?.vip||!1,firstTimeChatter:firstTimeChatters.includes(e.username),badges:addBadges(e.badges,e["user-id"],firstTimeChatters.includes(e.username)),color:e.color||"#FFFFFF",requests:[]}),users.length-1):t}function checkRequestLimit(e){let t=0;if(!users[e].sub&&PLAYLIST.allowPlebs){if(""===PLAYLIST.plebLimit)return-1;t=Math.max(t,PLAYLIST.plebLimit)}if(users[e].sub&&PLAYLIST.allowSubs){if(""===PLAYLIST.subLimit)return-1;t=Math.max(t,PLAYLIST.subLimit)}if(users[e].mod&&PLAYLIST.allowMods){if(""===PLAYLIST.modLimit)return-1;t=Math.max(t,PLAYLIST.modLimit)}if(users[e].vip&&PLAYLIST.allowVips){if(""===PLAYLIST.vipLimit)return-1;t=Math.max(t,PLAYLIST.vipLimit)}if(users[e].firstTimeChatter&&PLAYLIST.allowFirstTimeChatters){if(""===PLAYLIST.firstTimeChatterLimit)return-1;t=Math.max(t,PLAYLIST.firstTimeChatterLimit)}return t}function findRequestKey(e,t){for(const[n,a]of requests.entries())if(a[e]===t)return n;return null}function addRequest(e,t,n,a){if(bannedItems.get(t.name)){let n="";switch(t.type){case"twitch clip":n="ðŸš« This clip is banned";break;case"twitch vod":n="ðŸš« This VOD is banned";break;case"twitch stream":n="ðŸš« This stream is banned";break;case"youtube short":n="ðŸš« This short is banned";break;case"spotify":n="ðŸš« This song is banned";break;default:n="ðŸš« This video is banned";break}return void botReply(n,e.id,!1)}const o=getUser(e),l=checkRequestLimit(o);if(0===l)return void botReply("ðŸš« You are not allowed to send requests",e.id,!1);if(-1!==l&&users[o].requests.length>=l)return void botReply("âš  You used up all your requests",e.id,!1);if(users[o].requests.some((e=>e===t.name)))return void botReply("âš  You already requested this",e.id,!1);users[o].requests.push(t.name);let s=requests.get(t.name);if(s)s.by.push(users[o]),requests.set(t.name,s),updatePlaylist(s),botReply("âš  Someone else already requested this",e.id,!1);else{let l={id:t.id,name:t.name,msgid:n,type:t.type,platform:t.platform,approved:!PLAYLIST.approvalQueue,title:"",channel:"",uri:"",url:t?.url||"",duration:null,timestamp:t.timestamp,views:null,age:null,thumbnail:"",search:a,time:Date.now(),by:[users[o]]};requests.set(t.name,l),addToPlaylist(l),getRequestInfo(l,e.id),updatePlaylist(l)}updateLength(),updateSite()}function deleteRequest(e,t=!0){const n=requests.get(e);if(t)for(let t=0;t<n.by.length;t++){const a=users.findIndex((e=>e.username===n.by[t].username));-1!=a&&users[a].requests.splice(users[a].requests.findIndex((function(t){return t.value===e})),1)}requests.delete(e),document.getElementById(`id${e}`).remove(),updateLength(),saveSettings()}function banUser(e,t){let n;if(t){const t=history.findIndex((t=>t.name===e));t>-1&&(n=history[t])}else n=requests.get(e);if(n){for(let e=0;e<n.by.length;e++)bannedUsers.get(n.by[e].id)?showToast(`${n.by[e].username} is already banned`,"warning",2e3):(bannedUsers.set(n.by[e].id,n.by[e].username),showToast(`${n.by[e].username} is now banned`,"success",2e3));bannedItems.get(e)||bannedItems.set(e,n),t?(saveSettings(),loadBanLists()):deleteRequest(e,!1);for(const[e,t]of requests.entries())t.by[0].id==n.by[0].id&&deleteRequest(e,!1)}else showToast("Could not ban user","danger",2e3)}function banItem(e,t){let n;if(t){const t=history.findIndex((t=>t.name===e));t>-1&&(n=history[t])}else n=requests.get(e);n?(bannedItems.get(e)?showToast(("spotify"==n.platform?"Song":"Video")+" is already banned","warning",2e3):(bannedItems.set(e,n),showToast(("spotify"==n.platform?"Song":"Video")+" is now banned","success",2e3)),t?(saveSettings(),loadBanLists()):deleteRequest(e,!1)):showToast("Could not ban video/song","danger",2e3)}function banChannel(e,t){let n;if(t){const t=history.findIndex((t=>t.name===e));if(!(t>-1))return void showToast("Could not ban channel/artist","danger",2e3);if(!history[t].channelid)return void showToast("Item has no channel/artist","danger",2e3);if(n=history[t].channelid,bannedChannels.get(`${history[t].platform}:${history[t].channelid}`))return void showToast(`${history[t].channel} is already banned`,"warning",2e3);bannedChannels.set(`${history[t].platform}:${history[t].channelid}`,history[t]),showToast(`${history[t].channel} is now banned`,"success",2e3),saveSettings(),loadBanLists()}else{let t=requests.get(e);if(!t)return void showToast("Could not ban channel/artist","danger",2e3);if(!t.channelid)return void showToast("Item has no channel/artist","danger",2e3);if(n=t.channelid,bannedChannels.get(`${t.platform}:${t.channelid}`))return void showToast(`${t.channel} is already banned`,"warning",2e3);bannedChannels.set(`${t.platform}:${t.channelid}`,t),showToast(`${t.channel} is now banned`,"success",2e3),deleteRequest(e,!1)}for(const[e,t]of requests.entries())t.channelid==n&&deleteRequest(e,!1)}function unbanUser(e){bannedUsers.get(e)?(bannedUsers.delete(e),saveSettings(),loadBanLists()):showToast("That user is not banned","warning",2e3)}function unbanItem(e){bannedItems.get(e)?(bannedItems.delete(e),saveSettings(),loadBanLists()):showToast("That video/song is not banned","warning",2e3)}function unbanChannel(e){bannedChannels.get(e)?(bannedChannels.delete(e),saveSettings(),loadBanLists()):showToast("That channel/artist is not banned","warning",2e3)}function unbanAllUsers(){bannedUsers=new Map,saveSettings(),loadBanLists()}function unbanAllItems(){bannedItems=new Map,saveSettings(),loadBanLists()}function unbanAllChannels(){bannedChannels=new Map,saveSettings(),loadBanLists()}function loadBanLists(){elements.bannedUsersList.innerHTML="",elements.bannedItemsList.innerHTML="",elements.bannedChannelsList.innerHTML="";for(const[e,t]of bannedUsers.entries())elements.bannedUsersList.insertAdjacentHTML("afterbegin",`\n      <li class="list-group-item">\n      ${t} <i class="material-icons notranslate deletebtn float-end" onclick="unbanUser('${e}')" title="Unban">highlight_off</i>\n      </li>`);for(const[e,t]of bannedItems.entries())elements.bannedItemsList.insertAdjacentHTML("afterbegin",`\n      <li class="list-group-item">\n        <a \n        class="link-body-emphasis link-underline-opacity-0"\n        href="${getItemLink(t)}"\n        target="_blank"\n        rel="noopener noreferrer">\n        ${escapeString(t.title)}\n        </a>\n        <i class="material-icons notranslate deletebtn float-end" onclick="unbanItem('${e}')" title="Unban">highlight_off</i>\n      </li>`);for(const[e,t]of bannedChannels.entries())elements.bannedChannelsList.insertAdjacentHTML("afterbegin",`\n      <li class="list-group-item">\n      ${t.channel} <i class="material-icons notranslate deletebtn float-end" onclick="unbanChannel('${t.platform}:${t.channelid}')" title="Unban">highlight_off</i>\n      </li>`);elements.bannedUserCount.innerHTML=`${bannedUsers.size} ${1==bannedUsers.size?"User":"Users"}`,elements.bannedItemCount.innerHTML=`${bannedItems.size} ${1==bannedItems.size?"Video/Song":"Videos/Songs"}`,elements.bannedChannelCount.innerHTML=`${bannedChannels.size} ${1==bannedChannels.size?"Channel/Artist":"Channels/Artists"}`}function clearPlaylist(){playlist_playing=!1,total_duration=0,users=[],requests=new Map,resetVoteSkip(),resetPlayers(),elements.mainList.innerHTML="",elements.placeholder.style.display="",elements.nowPlaying.innerHTML='<span class="text-body-secondary">Nothing :)</span>',elements.nowPlayingRequester.innerHTML='<span class="text-body-secondary">No one :)</span>',elements.nowPlayingInfo.innerHTML="",elements.nowPlayingBanButtons.innerHTML="",updateLength(),saveSettings()}function clearHistory(){history=[],elements.historyList.innerHTML="",elements.historyCount.innerHTML=`${history.length.toLocaleString()} ${1==history.length?"request":"requests"}`,saveSettings()}function updateLength(){const e=requests.size;let t=0;for(let e of requests.values())-1!=e.duration&&null!=e.duration&&(t+=e.duration-e.timestamp);elements.playlistLength.innerHTML=`${secondsToTimeString(Math.round(t))||"00:00"} (${e} ${1==e?"request":"requests"})`}function makeBanButtons(e,t){let n="",a="";switch(e.type){case"streamable":n='\n      <li>\n        <span class="d-inline-block" tabindex="0" data-bs-toggle="tooltip" data-bs-title="Streamable videos are uploaded anonymously so there is no channel to ban">\n          <a class="dropdown-item disabled" aria-disabled="true"><i class="material-icons notranslate">tv_off</i> Ban Channel</a>\n        </span>\n      </li>';break;case"spotify":n=`\n      <li>\n        <a class="dropdown-item" onclick="banChannel('${e.name}', ${t})" title="All requests from this artist will be removed also">\n          <i class="material-icons notranslate">person_off</i> Ban Artist\n        </a>\n      </li>`;break;default:n=`\n      <li>\n        <a class="dropdown-item" onclick="banChannel('${e.name}', ${t})" title="All requests from this channel will be removed also">\n          <i class="material-icons notranslate">tv_off</i> Ban Channel\n        </a>\n      </li>`;break}switch(e.type){case"youtube short":a='<i class="material-icons notranslate">play_disabled</i> Ban Short';break;case"twitch clip":a='<i class="material-icons notranslate">play_disabled</i> Ban Clip';break;case"twitch stream":a='<i class="material-icons notranslate">tv_off</i> Ban Stream',n="";break;case"twitch vod":a='<i class="material-icons notranslate">play_disabled</i> Ban VOD';break;case"spotify":a='<i class="material-icons notranslate">music_off</i> Ban Song';break;default:a='<i class="material-icons notranslate">play_disabled</i> Ban Video';break}return`\n  <li><a id="id${e.name}_ban_user" class="dropdown-item" onclick="banUser('${e.name}', ${t})" title="Video/song will be banned also"><i class="material-icons notranslate">person_off</i> Ban User</a></li>\n  <li><a class="dropdown-item" onclick="banItem('${e.name}', ${t})">${a}</a></li>\n  ${n}`}function addToPlaylist(e,t="beforeend"){let n=makeBanButtons(e,!1);elements.mainList.insertAdjacentHTML(t,`<div class="container-fluid request-container p-0 mb-2" id="id${e.name}">\n        <div class="row g-1">\n          <div class="col-auto thumbnail-div">\n            <div id="id${e.name}_thumbnail" class="request-thumbnail">\n              <div class="placeholder-glow" style="width: 160px; height: 90px">\n                <span class="placeholder col-12 rounded h-100"></span>\n              </div>\n            </div>\n            <span class="badge text-bg-dark duration-label" id="id${e.name}_duration">00:00</span>\n          </div>\n          <div class="col">\n            <div class="vstack h-100">\n              <div class="request-title mb-auto" id="id${e.name}_title" >\n                <span class="placeholder-glow">\n                  <span class="placeholder col-12"></span>\n                </span>\n                <span class="placeholder-glow">\n                  <span class="placeholder col-12"></span>\n                </span>\n              </div>\n              <small class="request-info text-body-secondary" id="id${e.name}_info" >\n                <span class="placeholder-glow">\n                  <span class="placeholder col-12"></span>\n                </span>\n              </small>\n              <small class="requested-by text-body-secondary" id="id${e.name}_by" >\n              Requested by: \n              ${e.by[0].badges}\n              <span style="color: ${e.by[0].color}">${e.by.map((e=>e.username)).join(" & ")}</span>\n              </small>\n            </div>\n          </div>\n          <div class="col-auto d-flex flex-column justify-content-between">     \n            <div class="btn-group">\n              <i class="material-icons notranslate icon-button" data-bs-toggle="dropdown" aria-expanded="false">more_vert</i>\n                <ul class="dropdown-menu dropdown-menu-end cursor-pointer" style="user-select: none;">\n                  ${n}\n                </ul>\n              </div>\n            <i class="material-icons notranslate icon-button" onclick="deleteRequest('${e.name}',false)" title="Delete request">delete</i>\n          </div>\n        </div>\n      </div>`),enableTooltips()}function addToHistory(e,t=!1){t||history.unshift(e);let n="";e.timestamp>0&&(n=` (@${secondsToTimeString(Math.round(e.timestamp))})`);let a=makeBanButtons(e,!0);elements.historyList.insertAdjacentHTML(t?"beforeend":"afterbegin",`<div class="container-fluid request-container p-0 mb-2">\n        <div class="row g-1">\n          <div class="col-auto thumbnail-div">\n            <div class="request-thumbnail">\n            <img src="${e.thumbnail}" alt="thumbnail" class="rounded" />\n            </div>\n            <span class="badge text-bg-dark duration-label">${-1==e.duration?"ðŸ”´live":secondsToTimeString(Math.round(e.duration))+n}</span>\n          </div>\n          <div class="col">\n            <div class="vstack h-100">\n              <div class="request-title mb-auto" title="${e.title}">\n                <a \n                class="link-body-emphasis link-underline-opacity-0" \n                href="${getItemLink(e)}" \n                target="_blank" \n                rel="noopener noreferrer"> \n                ${escapeString(e.title)}\n                </a>\n              </div>\n              <small class="request-info text-body-secondary">\n              ${escapeString(e.channel)} ${null!==e.views?` â€¢ ${formatViewCount(e.views)} ${1==e.views?"view":"views"}`:""}\n              </small>\n              <small class="requested-by text-body-secondary" title="Requested by @${e.by.map((e=>e.username)).join(" & ")}">\n              Requested by \n              ${e.by[0].badges}\n              <a \n              class="link-body-emphasis link-underline-opacity-0"\n              href="https://www.twitch.tv/popout/${USER.channel}/viewercard/${e.by[0].username}"\n              target="_blank"\n              rel="noopener noreferrer">\n              <span style="color: ${e.by[0].color}">${e.by[0].username}</span>\n              </a>\n              ${e.by.length>1?`and ${e.by.length-1} other ${e.by.length-1==1?"user":"users"}`:""}\n              </small>\n            </div>\n          </div>\n          <div class="col-auto d-flex flex-column justify-content-between">     \n            <div class="btn-group">\n              <i class="material-icons notranslate icon-button" data-bs-toggle="dropdown" aria-expanded="false">more_vert</i>\n                <ul class="dropdown-menu dropdown-menu-end cursor-pointer" style="user-select: none;">\n                  ${a}\n                </ul>\n              </div>\n          </div>\n        </div>\n      </div>`)}function updatePlaylist(e,t=!1){if(e.thumbnail&&e.title){document.getElementById(`id${e.name}_thumbnail`).innerHTML=`\n    <img \n    onmouseup="openLink(event, '${getItemLink(e)}')" \n    src="${e.thumbnail}" \n    alt="thumbnail" \n    class="rounded cursor-pointer" />`,document.getElementById(`id${e.name}_title`).innerHTML=`\n    <a \n    class="link-body-emphasis link-underline-opacity-0"\n    href="${getItemLink(e)}"\n    target="_blank"\n    rel="noopener noreferrer">\n    ${escapeString(e.title)}\n    </a>`;let n="";e.timestamp>0&&(n=` (@${secondsToTimeString(Math.round(e.timestamp))})`),document.getElementById(`id${e.name}_title`).title=e.title,document.getElementById(`id${e.name}_info`).innerHTML=`\n    ${escapeString(e.channel)} ${null!==e.views?` â€¢ ${formatViewCount(e.views)} ${1==e.views?"view":"views"}`:""}`,document.getElementById(`id${e.name}_info`).title=`\n    ${escapeString(e.channel)} ${null!==e.views?` â€¢ ${formatViewCount(e.views)} ${1==e.views?"view":"views"}`:""}`,document.getElementById(`id${e.name}_duration`).innerText=-1==e.duration?"ðŸ”´live":secondsToTimeString(Math.round(e.duration))+n,document.getElementById(`id${e.name}_ban_user`).innerHTML=`<i class="material-icons notranslate">person_off</i> Ban ${e.by.length>1?"Users":"User"}</a>`,document.getElementById(`id${e.name}_by`).innerHTML=`\n    Requested by \n    ${e.by[0].badges}\n    <a \n    class="link-body-emphasis link-underline-opacity-0"\n    href="https://www.twitch.tv/popout/${USER.channel}/viewercard/${e.by[0].username}"\n    target="_blank"\n    rel="noopener noreferrer">\n    <span style="color: ${e.by[0].color}">${e.by[0].username}</span>\n    </a>\n     ${e.by.length>1?`and ${e.by.length-1} other ${e.by.length-1==1?"user":"users"}`:""}`,document.getElementById(`id${e.name}_by`).title=`Requested by @${e.by.map((e=>e.username)).join(" & ")}`,playlist_playing||!PLAYLIST.autoplay||t||nextItem(),t||saveSettings()}else document.getElementById(`id${e.name}_ban_user`).innerHTML=`<i class="material-icons notranslate">person_off</i> Ban ${e.by.length>1?"Users":"User"}</a>`,document.getElementById(`id${e.name}_by`).innerText=`Requested by @${e.by[0].username} ${e.by.length>1?`and ${e.by.length-1} other ${e.by.length-1==1?"user":"users"}`:""}`}let vimeoCooldown=0;async function getRequestInfo(e,t){if(e.title)updatePlaylist(e);else{if("twitch clip"==e.type)try{let t=await fetch(`https://helper.donk.workers.dev/twitch/clipsxd?id=${e.id}`),n=await t.json();console.log(n),e.title=n.data.data[0].title||"(untitled)",e.channel=n.data.data[0].broadcaster_name||"(unknown)",e.channelid=n.data.data[0].broadcaster_id,e.thumbnail=n.data.data[0].thumbnail_url,e.duration=n.data.data[0].duration,e.views=n.data.data[0].view_count,e.age=new Date(n.data.data[0].created_at).getTime(),e.mp4=`${n?.extra?.clip?.videoQualities[0]?.sourceURL}${n?.extra?.clipKey}`}catch(n){return deleteRequest(e.name),botReply("â›” Could not find this clip's info",t,!1),void console.log("getRequestInfo twitch clip error",n)}if("twitch vod"==e.type)try{let t=await fetch(`https://helper.donk.workers.dev/twitch/videos?id=${e.id}`),n=await t.json();console.log(n),e.title=n.data[0].title||"(untitled)",e.channel=n.data[0].user_login||"(unknown)",e.channelid=n.data[0].user_id,e.thumbnail=n.data[0].thumbnail_url.replace("%{width}","320").replace("%{height}","180"),e.duration=convertTwitchVODDuration(n.data[0].duration),e.views=n.data[0].view_count,e.age=new Date(n.data[0].created_at).getTime()}catch(n){return deleteRequest(e.name),botReply("â›” Could not find this video's info",t,!1),void console.log("getRequestInfo twitch vod error",n)}if("twitch stream"==e.type)try{let t=await fetch(`https://helper.donk.workers.dev/twitch/streams?user_login=${e.id}`),n=await t.json();console.log(n),e.title=n.data[0].title||"(untitled)",e.channel=n.data[0].user_name||"(unknown)",e.channelid=n.data[0].user_id,e.thumbnail=n.data[0].thumbnail_url.replace("{width}","320").replace("{height}","180"),e.duration=-1,e.views=n.data[0].viewer_count,e.age=new Date(n.data[0].started_at).getTime()}catch(n){return deleteRequest(e.name),botReply("â›” Could not find this stream's info",t,!1),void console.log("getRequestInfo twitch stream error",n)}if("spotify"==e.type)try{let n=await fetch(`https://helper.donk.workers.dev/spotify/tracks?ids=${e.id}`),a=await n.json();if(console.log(a),!a.tracks[0].is_playable)return deleteRequest(e.name),void botReply("â›” Your song is not playable",t,!1);e.title=a.tracks[0].name||"(untitled)",e.channel=a.tracks[0]?.artists[0]?.name||"(unknown)",e.channelid=a.tracks[0].artists[0].id,e.thumbnail=a.tracks[0].album.images[0].url,e.duration=a.tracks[0].duration_ms/1e3,e.views=null,e.age=spotifyReleaseDateToTimestamp(a.tracks[0].album.release_date,a.tracks[0].album.release_date_precision),e.uri=a.tracks[0].uri}catch(n){return deleteRequest(e.name),botReply("â›” Could not find this song's info",t,!1),void console.log("getRequestInfo spotify error",n)}if("tiktok video"==e.type)try{let t=await fetch(`https://www.tiktok.com/oembed?url=${encodeURIComponent(e.url)}`),n=await t.json();console.log(n),e.title=n?.title||"(untitled)",e.channel=n?.author_name||"(unknown)",e.channelid=n?.author_unique_id,e.thumbnail=n?.thumbnail_url,e.duration=null,e.views=null,e.age=null}catch(n){return deleteRequest(e.name),botReply("â›” Could not find this video's info",t,!1),void console.log("getRequestInfo tiktok error",n)}if("youtube"==e.type||"youtube short"==e.type)try{let n=await fetch(`https://helper.donk.workers.dev/youtube/videos?id=${e.id}`),a=await n.json();if(console.log(a),e.title=a.items[0].snippet.title||"(untitled)",e.channel=a.items[0].snippet.channelTitle||"(unknown)",e.channelid=a.items[0].snippet.channelId,e.thumbnail=a.items[0].snippet.thumbnails.medium.url,e.duration=ISO8601ToSeconds(a.items[0].contentDetails.duration),e.age=new Date(a.items[0].snippet.publishedAt).getTime(),e.views=a.items[0].statistics.viewCount,"ytAgeRestricted"==a.items[0].contentDetails?.contentRating?.ytRating||!a.items[0].status?.embeddable)return deleteRequest(e.name),void botReply("â›” Your video is age restricted or not embeddable",t,!1);if("none"!==a.items[0].snippet.liveBroadcastContent&&(0==e.duration&&(e.duration=-1),!PLAYLIST.allowYTStreams))return deleteRequest(e.name),void botReply("ðŸš« YouTube streams are not allowed",t,!1)}catch(n){return deleteRequest(e.name),botReply("â›” Could not find this video's info",t,!1),void console.log("getRequestInfo youtube error",n)}if("vimeo"==e.type)try{if(Date.now()<vimeoCooldown)return deleteRequest(e.name),void botReply(`âš  We reached the Vimeo API limit, ${Math.round((vimeoCooldown-Date.now())/1e3)}s cooldown...`,t,!1);let n=await fetch(`https://helper.donk.workers.dev/vimeo/videos?id=${e.id}`),a=await n.json();if(console.log(a),9e3==a?.error_code)return deleteRequest(e.name),vimeoCooldown=new Date(a["X-RateLimit-Reset"]).getTime(),void botReply(`âš  We reached the Vimeo API limit, ${Math.round((vimeoCooldown-Date.now())/1e3)}s cooldown...`,t,!1);if(vimeoCooldown=0,"video"!==a.type)return deleteRequest(e.name),void botReply("â›” Only Vimeo videos are supported",t,!1);if("safe"!==a.content_rating_class)return deleteRequest(e.name),void botReply("â›” Your video is not rated as safe",t,!1);if(!a.is_playable||"playable"!==a.play.status||"available"!==a.status)return deleteRequest(e.name),void botReply("â›” Your video is not playable",t,!1);if("public"!==a.privacy.embed)return deleteRequest(e.name),void botReply("â›” Your video is not embeddable",t,!1);e.title=a.name||"(untitled)",e.channel=a.user.name||"(unknown)",e.channelid=a.user.uri,e.thumbnail=a.pictures?.sizes?.[1]?.link,e.duration=a.duration,e.views=a?.stats?.plays||null,e.age=new Date(a.created_time).getTime()}catch(n){return deleteRequest(e.name),botReply("â›” Could not find this video's info",t,!1),void console.log("getRequestInfo vimeo error",n)}if("streamable"==e.type)try{let t=await fetch(`https://helper.donk.workers.dev/streamable/videos?id=${e.id}`),n=await t.json();console.log(n),e.title=n.title||"(untitled)",e.channel="(unknown)",e.channelid=null,e.thumbnail=n.thumbnail_url,e.duration=n.files.mp4.duration,e.views=null,e.age=null,e.video=n.files.mp4.url}catch(n){return deleteRequest(e.name),botReply("â›” Could not find this video's info",t,!1),void console.log("getRequestInfo streamable error",n)}if(bannedChannels.get(`${e?.platform}:${e?.channelid}`))return deleteRequest(e.name),void botReply(`ðŸš« This ${"spotify"==e.type?"artist":"channel"} is banned`,t,!1);if(""!==PLAYLIST.maxDuration&&-1!==e.duration&&null!==e.duration&&total_duration+e.duration-e.timestamp>numberAndUnitToSeconds(PLAYLIST.maxDuration,PLAYLIST.maxDurationUnit))return playlist_open&&togglePlaylist(),deleteRequest(e.name),void botReply(`â›” The playlist's duration limit was reached (${PLAYLIST.maxDuration}${PLAYLIST.maxDurationUnit})`,t,!1);if(""!==PLAYLIST.maxLength&&-1!==e.duration&&null!==e.duration&&e.duration-e.timestamp>60*PLAYLIST.maxLength)return deleteRequest(e.name),void botReply(`â›” Your request is too long (${PLAYLIST.maxLength}m max)`,t,!1);if(""!==PLAYLIST.maxSize&&requests.size>PLAYLIST.maxSize)return playlist_open&&togglePlaylist(),deleteRequest(e.name),void botReply(`â›” The playlist's size limit was reached (${PLAYLIST.maxSize})`,t,!1);if(""!==PLAYLIST.minViewCount&&null!==e.views&&e.views<PLAYLIST.minViewCount)return deleteRequest(e.name),void botReply(`â›” Your request does not meet the minimum view count (${PLAYLIST.minViewCount.toLocaleString()})`,t,!1);if(""!==PLAYLIST.minUploadAge&&null!==e.age&&e.age>Date.now()-1e3*numberAndUnitToSeconds(PLAYLIST.minUploadAge,PLAYLIST.minUploadAgeUnit)){deleteRequest(e.name);let n=1e3*numberAndUnitToSeconds(PLAYLIST.minUploadAge,PLAYLIST.minUploadAgeUnit),a=1e3*numberAndUnitToSeconds(PLAYLIST.maxUploadAge,PLAYLIST.maxUploadAgeUnit),o=Date.now();""!==PLAYLIST.maxUploadAge?botReply(`â›” Your request is too new (must be uploaded between ${new Date(o-a).toLocaleString("en-GB")} and ${new Date(o-n).toLocaleString("en-GB")})`,t,!1):botReply(`â›” Your request is too new (must be uploaded before ${new Date(o-n).toLocaleString("en-GB")})`,t,!1)}else if(""!==PLAYLIST.maxUploadAge&&null!==e.age&&e.age<Date.now()-1e3*numberAndUnitToSeconds(PLAYLIST.maxUploadAge,PLAYLIST.maxUploadAgeUnit)){deleteRequest(e.name);let n=1e3*numberAndUnitToSeconds(PLAYLIST.minUploadAge,PLAYLIST.minUploadAgeUnit),a=1e3*numberAndUnitToSeconds(PLAYLIST.maxUploadAge,PLAYLIST.maxUploadAgeUnit),o=Date.now();""!==PLAYLIST.minUploadAge?botReply(`â›” Your request is too old (must be uploaded between ${new Date(o-a).toLocaleString("en-GB")} and ${new Date(o-n).toLocaleString("en-GB")})`,t,!1):botReply(`â›” Your request is too old (must be uploaded after ${new Date(o-a).toLocaleString("en-GB")})`,t,!1)}else{if(PLAYLIST.uniqueOnly&&history.some((t=>t.name===e.name)))return deleteRequest(e.name),void botReply("â›” Your request is not unique",t,!1);if(e.timestamp>0&&e.duration>0&&e.timestamp>e.duration)return deleteRequest(e.name),void botReply("â›” Your time stamp is longer than the actual video",t,!1);if(e.duration>0&&(total_duration+=e.duration-e.timestamp),updatePlaylist(e),updateLength(),currentItem&&e){let n="";switch(e.search?n+=`âœ… Added ${getItemLink(e)} to the playlist`:n+="âœ… Your request has been added to the playlist",requests.size){case 0:n+=" | Playing right now!";break;case 1:n+=` | Playing right after the current request (<${secondsToTimeString(currentItem.duration)})`;break;default:n+=` | ${requests.size-1} ${requests.size-1==1?"request":"requests"} ahead of you (${secondsToTimeString(total_duration+currentItem.duration-e.duration)})`;break}botReply(n,t,!1)}else e.search?botReply(`âœ… Added ${getItemLink(e)} to the playlist`,t,!1):botReply("âœ… Your request has been added to the playlist",t,!1)}}}async function parseLink(e){if(e.includes("twitch.tv")){if(e.includes("/clip/")||e.includes("clips.twitch.tv")){let t=new URL(e),n="clips.twitch.tv"===t.hostname?/^\/(\w+(?:\/[A-Z]\w+)?(?:[\-\w]*))(?:\/|$)/.exec(t.pathname):/^\/\w+\/clip\/(\w+(?:\/[A-Z]\w+)?(?:[\-\w]*))(?:\/|$)/.exec(t.pathname);return n&&n[1]?{type:"twitch clip",id:n[1],name:`twitch:clip:${n[1]}`,platform:"twitch",timestamp:0}:null}if(e.includes("/videos/")){const t=e.match(/\/videos\/(\d+)/);if(!t||!parseInt(t[1]))return null;let n=timeStringToSeconds(new URLSearchParams(new URL(e).search)?.get("t"));return{type:"twitch vod",id:t[1],name:`twitch:vod:${t[1]}`,platform:"twitch",timestamp:n}}const t=e.match(/\/([a-zA-Z0-9_]{1,25})$/);return t?{type:"twitch stream",id:t[1],name:`twitch:stream:${t[1]}`,platform:"twitch",timestamp:0}:null}if(e.includes("youtube.com")||e.includes("youtu.be")){const t=/(youtu.*be.*)\/(watch\?v=|embed\/|v|shorts|)(.*?((?=[&#?])|$))/gm.exec(e)||null;if(11!=t[3]?.length)return null;let n=parseInt(new URLSearchParams(new URL(e).search)?.get("t"),10)||0;return{type:e.includes("/shorts/")?"youtube short":"youtube",id:t[3],name:`youtube:${t[3]}`,platform:"youtube",timestamp:n}}if(e.toLowerCase().startsWith("youtube")){if(e=e?.toLowerCase().replace("youtube","").trim(),e?.includes("start=")&&(e=e.split("start=")[0]),!e)return null;try{let t=await fetch(`https://helper.donk.workers.dev/youtube/search?query=${encodeURIComponent(e.trim())}`),n=await t.json();return console.log(n),0==n?.items?.length||"youtube#video"!==n?.items?.[0].id?.kind?null:{type:"youtube",id:n.items[0].id.videoId,name:`youtube:${n.items[0].id.videoId}`,platform:"youtube",timestamp:0}}catch(e){return null}}if(e.includes("vimeo.com")){const t=/(?:http|https)?:?\/?\/?(?:www\.)?(?:player\.)?vimeo\.com\/(?:channels\/(?:\w+\/)?|groups\/(?:[^\/]*)\/videos\/|video\/|)(\d+)(?:|\/\?)/g.exec(e)||null;if(!t[1])return null;let n=parseInt(new URL(e)?.hash?.substring(1)?.match(/t=([0-9.]+)/)?.[1],10)||0;return{type:"vimeo",id:t[1],name:`vimeo:${t[1]}`,platform:"vimeo",timestamp:n}}if(e.toLowerCase().startsWith("vimeo")){if(e=e?.toLowerCase().replace("vimeo","").trim(),e?.includes("start=")&&(e=e.split("start=")[0]),!e)return null;try{let t=await fetch(`https://helper.donk.workers.dev/vimeo/search?query=${encodeURIComponent(e.trim())}`),n=await t.json();return console.log(n),n.data[0]&&"video"===n.data[0].type&&"safe"===n.data[0].content_rating_class&&"public"===n.data[0].privacy.embed&&"playable"===n.data[0].play.status&&"available"===n.data[0].status&&!0===n.data[0].is_playable?{type:"vimeo",id:n.data[0].uri.replace("/videos/",""),name:`vimeo:${n.data[0].uri.replace("/videos/","")}`,platform:"vimeo",timestamp:0}:null}catch(e){return null}}if(e.includes("spotify.com")){const t=/https?:\/\/(?:embed\.|open\.)(?:spotify\.com\/)(?:(album|track|playlist|episode)\/|\?uri=spotify:track:)((\w|-){22})/;let n=e.match(t);return console.log(n),!n[2]||"track"!==n[1]&&"episode"!==n[1]?null:{type:"spotify",id:n[2],name:`spotify:${n[2]}`,platform:"spotify",timestamp:0}}if(e.toLowerCase().startsWith("spotify")){if(e=e?.toLowerCase().replace("spotify","").trim(),e?.includes("start=")&&(e=e.split("start=")[0]),!e)return null;try{let t=await fetch(`https://helper.donk.workers.dev/spotify/search?q=${encodeURIComponent(e.trim())}`),n=await t.json();return console.log(n),0==n.tracks.items.length?null:{type:"spotify",id:n.tracks.items[0].id,name:`spotify:${n.tracks.items[0].id}`,platform:"spotify",timestamp:0}}catch(e){return null}}if(e.includes("tiktok.com")){const t=/^.*https:\/\/(?:m|www|vm)?\.?tiktok\.com\/((?:.*\b(?:(?:usr|v|embed|user|video)\/|\?shareId=|\&item_id=)(\d+))|\w+)/;let n=e.match(t);return n[2]&&n[1].includes("/video/")?{type:"tiktok video",id:n[2],url:e.split("?")[0],name:`tiktok:${n[2]}`,platform:"tiktok",timestamp:0}:null}if(e.includes("streamable.com")){const t=e.match(/streamable\.com\/([a-zA-Z0-9]+)/);return t[1]?{type:"streamable",id:t[1],name:`streamable:${t[1]}`,platform:"streamable",timestamp:0}:null}return null}async function updateClipMP4(e){try{let t=await fetch(`https://helper.donk.workers.dev/twitch/clipsxd?id=${e}`),n=await t.json();return`${n?.extra?.clip?.videoQualities[0]?.sourceURL}${n?.extra?.clipKey}`||null}catch(e){return console.log("updateClipMP4 error",e),null}}function linkTypeAllowed(e){return!("twitch clip"==e&&!PLAYLIST.allowTwitchClips)&&(!("twitch vod"==e&&!PLAYLIST.allowTwitchVODs)&&(!("twitch stream"==e&&!PLAYLIST.allowTwitchStreams)&&(!("spotify"==e&&!PLAYLIST.allowSpotifySongs)&&(!("streamable"==e&&!PLAYLIST.allowStreamable)&&(!("tiktok video"==e&&!PLAYLIST.allowTiktokVideos)&&(!("youtube"==e&&!PLAYLIST.allowYTStreams&&!PLAYLIST.allowYTVideos)&&(!("youtube short"==e&&!PLAYLIST.allowYTShorts)&&!("vimeo"==e&&!PLAYLIST.allowVimeoVideos))))))))}function getItemLink(e){switch(e.type){case"youtube":return`https://youtu.be/${e.id}`;case"youtube short":return`https://youtube.com/shorts/${e.id}`;case"vimeo":return`https://vimeo.com/${e.id}`;case"spotify":return`https://open.spotify.com/track/${e.id}`;case"tiktok video":return e.url;case"twitch stream":return`https://www.twitch.tv/${e.id}`;case"twitch vod":return`https://www.twitch.tv/videos/${e.id}`;case"twitch clip":return`https://clips.twitch.tv/${e.id}`;case"streamable":return`https://streamable.com/${e.id}`;default:return""}}function openLink(e,t){e.button<2&&window.open(t,"_blank").focus()}async function addLink(){if(!checkLogin())return;let e=elements.link.value?.split(" ").filter(Boolean),t=e[0],n=!1;"youtube"!=e[0].toLowerCase()&&"spotify"!=e[0].toLowerCase()&&"vimeo"!=e[0].toLowerCase()||(t=e.join(" "),n=!0);let a=await parseLink(t);return a?linkTypeAllowed(a.type)?(e[e.length-1]?.toLowerCase().startsWith("start=")&&(a.timestamp=timeToSeconds(e[e.length-1].split("=")[1])),addRequest({id:"toast","user-id":USER.userID,username:USER.channel,displayName:USER.channel,mod:!0,sub:!0,vip:!0,firstTimeChatter:!1,badges:"streamer",color:streamerColor},a,0,n),void(elements.link.value="")):(showToast(`${a.type} links are not enabled`,"warning",3e3),void(elements.link.value="")):(showToast("Could not parse your request","warning",3e3),void(elements.link.value=""))}let currentItem,voteskipTimeout,historyIndex=-1;function previousItem(e){if(0!=history.length){if(resetPlayers(),resetVoteSkip(),currentItem?.name==history[historyIndex+1]?.name&&historyIndex++,currentItem=history[++historyIndex],!currentItem)return playlist_playing=!1,elements.placeholder.style.display="",elements.nowPlaying.innerHTML='<span class="text-body-secondary">Nothing :)</span>',elements.nowPlayingRequester.innerHTML='<span class="text-body-secondary">No one :)</span>',elements.nowPlayingInfo.innerHTML="",void(elements.nowPlayingBanButtons.innerHTML="");e&&botReply("âª Rewinded",e,!1),console.log(currentItem),playItem(currentItem),updateLength(),saveSettings()}}function deleteItem(e,t){requests.get(e)?(deleteRequest(e,!1),botReply("ðŸ—‘ï¸ Request deleted",t,!1),updateLength(),saveSettings()):botReply("âš  Request not found",t,!1)}function nextItem(e){if(resetPlayers(),resetVoteSkip(),e&&botReply("â© Skipped",e,!1),historyIndex>0)currentItem=history[--historyIndex];else{let e=requests.keys().next().value;currentItem=requests.get(e),requests.delete(e),historyIndex=-1,currentItem&&(addToHistory(currentItem),deleteRequest(currentItem.name,!1),elements.historyCount.innerHTML=`${history.length.toLocaleString()} ${1==history.length?"request":"requests"}`)}if(!currentItem)return playlist_playing=!1,elements.placeholder.style.display="",elements.nowPlaying.innerHTML='<span class="text-body-secondary">Nothing :)</span>',elements.nowPlayingRequester.innerHTML='<span class="text-body-secondary">No one :)</span>',elements.nowPlayingInfo.innerHTML="",void(elements.nowPlayingBanButtons.innerHTML="");console.log(currentItem),playItem(currentItem),updateLength(),saveSettings()}async function playItem(e){switch(e.type){case"youtube":case"youtube short":elements.youtubeEmbedContainer.style.display="",youtubePlayer.loadVideoById(e.id,e.timestamp);break;case"vimeo":elements.vimeoEmbedContainer.style.display="",playVimeoVideo(e.id,e.timestamp);break;case"spotify":elements.spotifyEmbedContainer.style.display="",spotifyPlay(e.uri,e.timestamp);break;case"twitch stream":elements.twitchEmbed.style.display="",twitchPlayer.setChannel(e.id);break;case"twitch vod":elements.twitchEmbed.style.display="",seekTwitchPlayer=!0,twitchPlayer.setVideo(e.id);break;case"twitch clip":if(e?.mp4&&Date.now()-e.time<684e5)elements.videoEmbed.style.display="",elements.videoEmbed.src=e.mp4;else{let t=await updateClipMP4(e.id);t?(elements.videoEmbed.style.display="",elements.videoEmbed.src=t):(elements.twitchClipsEmbed.style.display="",elements.twitchClipsEmbed.innerHTML=`<iframe src="https://clips.twitch.tv/embed?clip=${e.id}&parent=${window.location.hostname}&autoplay=true&muted=false" preload="auto" height="100%" width="100%"></iframe>`)}break;case"tiktok video":elements.tiktokEmbed.style.display="",elements.tiktokEmbed.innerHTML=`<iframe id="tiktokIframe" src="https://www.tiktok.com/player/v1/${e.id}?autoplay=1&rel=0" preload="auto" height="100%" width="100%"></iframe>`;break;case"streamable":elements.videoEmbed.style.display="",elements.videoEmbed.src=e.video;break;default:break}-1!==currentItem.duration&&null!==currentItem.duration&&(total_duration-=currentItem.duration-currentItem.timestamp),elements.nowPlaying.innerHTML=`\n  <a \n    class="link-body-emphasis link-underline-opacity-0"\n    href="${getItemLink(currentItem)}"\n    target="_blank"\n    rel="noopener noreferrer">\n      ${escapeString(currentItem.title)}\n  </a>`,elements.nowPlaying.title=currentItem.title,elements.nowPlayingRequester.innerHTML=`\n  ${currentItem.by[0].badges}\n  <a \n    class="link-body-emphasis link-underline-opacity-0"\n    href="https://www.twitch.tv/popout/${USER.channel}/viewercard/${currentItem.by[0].username}"\n    target="_blank"\n    rel="noopener noreferrer">\n      <span style="color: ${currentItem.by[0].color}">${currentItem.by[0].username}</span>\n  </a>\n  ${currentItem.by.length>1?`and ${currentItem.by.length-1} other ${currentItem.by.length-1==1?"user":"users"}`:""}`,elements.nowPlayingRequester.title=currentItem.by.map((e=>e.username)).join(" & "),elements.nowPlayingInfo.innerHTML=`\n  <small class="now-playing-info" title="${currentItem.channel}">\n    <i class="material-icons notranslate">${"spotify"==currentItem.platform?"music_note":"live_tv"}</i> ${escapeString(currentItem.channel)}\n  </small>\n  <br />\n  <small class="now-playing-info">\n    ${null!==currentItem.views?`<i class="material-icons notranslate">visibility</i> ${formatViewCount(currentItem.views)} ${1==currentItem.views?"view":"views"}`:""}\n  </small>`,elements.nowPlayingBanButtons.innerHTML=`\n    <div class="btn-group dropup">\n      <i class="material-icons notranslate icon-button" data-bs-toggle="dropdown" aria-expanded="false">more_vert</i>\n      <ul class="dropdown-menu dropdown-menu-end cursor-pointer" style="user-select: none;">\n        ${makeBanButtons(currentItem,!0)}\n      </ul>\n    </div>`,playlist_playing=!0,updateMetadata()}function updateMetadata(){"mediaSession"in navigator&&(navigator.mediaSession.metadata=new MediaMetadata({title:currentItem.title,artist:currentItem.channel,album:`Requested By: ${currentItem.by.map((e=>e.username)).join(" & ")}`,artwork:[{src:currentItem.thumbnail}]}))}function resetPlayers(){elements.placeholder.style.display="none",elements.youtubeEmbedContainer.style.display="none",elements.vimeoEmbedContainer.style.display="none",elements.spotifyEmbedContainer.style.display="none",elements.twitchEmbed.style.display="none",elements.twitchClipsEmbed.style.display="none",elements.tiktokEmbed.style.display="none",elements.videoEmbed.style.display="none",youtubePlayer?.loadVideoById(""),vimeoPlayer?.unload(),spotifyPlayer?.destroy(),elements.spotifyEmbedContainer.innerHTML='<div id="spotifyEmbed"></div>',twitchPlayer?.setChannel(""),elements.twitchClipsEmbed.innerHTML="",elements.tiktokEmbed.innerHTML="",elements.videoEmbed.src=""}function voteSkip(e){if(!playlist_playing||!PLAYLIST.allowVoteSkip)return;if("none"==elements.voteSkipDiv.style.display&&(elements.voteSkipDiv.style.display="",animate("#voteSkipDiv",{ease:"outElastic(1, .5)",translateY:["-100%",0]})),clearTimeout(voteskipTimeout),voteskipTimeout=setTimeout((()=>{animate("#voteSkipDiv",{ease:"outBounce",duration:2e3,translateY:[0,"-100%"],onComplete:function(e){elements.voteSkipDiv.style.display="none"}})}),5e3),skippers.includes(e))return;skippers.push(e);let t=PLAYLIST.voteskipCount-skippers.length;elements.voteSkipVotes.innerHTML=`${t} ${1==t?"vote":"votes"}  needed to skip`,t<=0&&(nextItem(),resetVoteSkip())}function resetVoteSkip(){skippers=[],animate("#voteSkipDiv",{ease:"outBounce",translateY:[0,"-100%"],onComplete:function(e){elements.voteSkipDiv.style.display="none"}})}async function loadPFP(){if(!USER.channel)return void(elements.topRight.innerHTML='<div class="btn-group" role="group" aria-label="login options">\n    <a\n      role="button"\n      id="loginButton"\n      onclick="login()"\n      class="btn btn-twitch"\n      tabindex="0"\n      data-bs-container="body"\n      data-bs-custom-class="custom-popover"\n      data-bs-placement="bottom"\n      data-bs-trigger="manual"\n      data-bs-toggle="popover"\n      data-bs-title="Not signed in"\n      data-bs-content="You need sign in first before adding options or enabling voting/suggestions"\n      ><span class="twitch-icon"></span>Sign in with Twitch</a\n    >\n    <div class="btn-group" role="group">\n      <button\n        id="btnGroupDropLogin"\n        type="button"\n        class="btn btn-twitch dropdown-toggle"\n        data-bs-toggle="dropdown"\n        data-bs-auto-close="outside"\n        aria-label="other login option, connect manually"\n        aria-expanded="false"\n      ></button>\n      <div class="dropdown-menu dropdown-menu-end" aria-labelledby="btnGroupDropLogin">\n        <div class="p-3" style="width: 300px">\n          <label for="channelName" class="form-label">Connect to chat directly</label>\n          <div class="input-group mb-3">\n            <span class="input-group-text" id="directLoginChannel">twitch.tv/</span>\n            <input type="text" class="form-control" id="channelName" aria-describedby="directLoginChannel" />\n          </div>\n          <small class="text-body-secondary">Some features will not be available if you connect directly</small><br />\n          <button type="button" onclick="connect()" class="btn btn-primary float-end">Connect</button>\n        </div>\n      </div>\n    </div>\n  </div>');let e=await get7TVPFP(USER.userID);"/pics/donk.png"==e&&USER.access_token&&(e=await getTwitchPFP(USER.channel,USER.access_token)),elements.topRight.innerHTML=`\n  <div class="btn-group" role="group" aria-label="Button group with nested dropdown">\n  <button type="button" id="btnGroupDrop2" class="btn btn-${darkTheme?"dark":"secondary"}"><img src="${e}" alt="profile pic" style="height:2em;"></button>\n  <div class="btn-group" role="group">\n  <button id="btnGroupDrop1" type="button" class="btn btn-${darkTheme?"dark":"secondary"} dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">\n  ${USER.channel}\n  </button>\n  <ul class="dropdown-menu dropdown-menu-lg-end" aria-labelledby="btnGroupDrop1">\n  <li><a class="dropdown-item" onclick="logout()" href="#"><i class="material-icons notranslate">logout</i>Log out</a></li>\n  </ul>\n  </div>\n  </div>`}function checkLogin(){return!!USER.channel||(loginButton.show(),setTimeout((function(){loginButton.hide()}),4e3),!1)}function logout(){elements.topRight.innerHTML=' <div class="btn-group" role="group" aria-label="login options">\n  <a\n    role="button"\n    id="loginButton"\n    onclick="login()"\n    class="btn btn-twitch"\n    tabindex="0"\n    data-bs-container="body"\n    data-bs-custom-class="custom-popover"\n    data-bs-placement="bottom"\n    data-bs-trigger="manual"\n    data-bs-toggle="popover"\n    data-bs-title="Not signed in"\n    data-bs-content="You need sign in first before adding options or enabling voting/suggestions"\n    ><span class="twitch-icon"></span>Sign in with Twitch</a\n  >\n  <div class="btn-group" role="group">\n    <button\n      id="btnGroupDropLogin"\n      type="button"\n      class="btn btn-twitch dropdown-toggle"\n      data-bs-toggle="dropdown"\n      data-bs-auto-close="outside"\n      aria-label="other login option, connect manually"\n      aria-expanded="false"\n    ></button>\n    <div class="dropdown-menu dropdown-menu-end" aria-labelledby="btnGroupDropLogin">\n      <div class="p-3" style="width: 300px">\n        <label for="channelName" class="form-label">Connect to chat directly</label>\n        <div class="input-group mb-3">\n          <span class="input-group-text" id="directLoginChannel">twitch.tv/</span>\n          <input type="text" class="form-control" id="channelName" aria-describedby="directLoginChannel" />\n        </div>\n        <small class="text-body-secondary">Some features will not be available if you connect directly</small><br />\n        <button type="button" onclick="connect()" class="btn btn-primary float-end">Connect</button>\n      </div>\n    </div>\n  </div>\n</div>',resetSettings(!0)}async function loadAndConnect(){await load_localStorage(),refreshData();const e=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});if(e.channel&&!USER.channel&&!USER.twitchLogin&&!USER.access_token&&!USER.userID){let t=e.channel.replace(/\s+/g,"").toLowerCase();elements.channelName.value=t,USER.channel=t,window.history.replaceState({},document.title,"/")}if(USER.twitchLogin&&!await checkToken(USER.access_token))return USER.channel="",void loginExpiredModal.show();USER.channel&&(connect(),elements.profileLink.value=`playlist.chat.vote/${USER.channel||""}`)}let updateCooldown,oldSliderValue,youtubePlayer,spotifyPlayer,spotifyIFrameAPI,twitchPlayer,botCooldown=Date.now();async function botReply(e,t,n){if("toast"==t)return void showToast(e,"info",2e3);if(!USER.access_token||!PLAYLIST.enableBot||!t)return;if((Date.now()-botCooldown)/1e3<PLAYLIST.botCooldown&&n)return;botCooldown=Date.now();let a={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({channel:USER.channel,id:t,msg:e,access_token:USER.access_token})};try{let e=await fetch("https://api.chat.vote/reply",a);if(418==e.status){elements.enableBot.checked=!1,saveSettings();let t=await e.text();return showToast(`Bot unable to send messages "${t}"... Disabling bot setting`,"danger",4e3),void console.log(`botReply response: 418 ${t}`)}console.log(`botReply response: ${e.status}`)}catch(e){console.log("botReply error",e)}}async function updateSite(){clearTimeout(updateCooldown),USER.access_token&&(updateCooldown=setTimeout((()=>{updateSiteSend()}),3e3))}async function updateSiteSend(){let e=[];for(let t of requests.values())e.push(t);let t={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({userid:USER.userID,username:USER.channel,access_token:USER.access_token,time:new Date,settings:PLAYLIST,playlist:e,currentitem:currentItem})};try{let e=await fetch("https://playlist.chat.vote/update",t),n=await e.json();console.log(n)}catch(e){console.log("update error",e)}}function copyLink(){navigator.clipboard.writeText(`https://playlist.chat.vote/${USER.channel||""}`),copyLinkButton.show(),setTimeout((()=>{copyLinkButton.hide()}),1e3)}function switchTheme(e){document.documentElement.setAttribute("data-bs-theme",e?"dark":"light"),document.getElementById("twitchLogo").style.filter=`invert(${e?.25:.65})`,document.getElementById("btnGroupDrop1")&&document.getElementById("btnGroupDrop2")&&(document.getElementById("btnGroupDrop1").classList.remove(""+(e?"btn-secondary":"btn-dark")),document.getElementById("btnGroupDrop1").classList.add(""+(e?"btn-dark":"btn-secondary")),document.getElementById("btnGroupDrop2").classList.remove(""+(e?"btn-secondary":"btn-dark")),document.getElementById("btnGroupDrop2").classList.add(""+(e?"btn-dark":"btn-secondary")))}function toggleEveryone(e){elements.allowPlebs.checked=e,elements.allowSubs.checked=e,elements.allowMods.checked=e,elements.allowVips.checked=e,elements.allowFirstTimeChatters.checked=e}function updateWhoCanRequest(){let e={"Non subscribers":{allowed:PLAYLIST.allowPlebs,limit:PLAYLIST.plebLimit},Subscribers:{allowed:PLAYLIST.allowSubs,limit:PLAYLIST.subLimit},Mods:{allowed:PLAYLIST.allowMods,limit:PLAYLIST.modLimit},VIPs:{allowed:PLAYLIST.allowVips,limit:PLAYLIST.vipLimit},"First time chatters":{allowed:PLAYLIST.allowFirstTimeChatters,limit:PLAYLIST.firstTimeChatterLimit}},t=[],n=[],a=[];for(let[o,l]of Object.entries(e))if(l.allowed){t.push(o);let e=""===l.limit?"unlimited":l.limit;n.push(`${o} can make ${e} ${1==e?"request":"requests"}`),a.push(e)}0!=t.length?elements.whoCanRequest.innerHTML=`${1==t.length?"Only":""} ${5==t.length?"Everyone":t.join(", ")} will be able to request.<br>\n  ${a.every((e=>e===a[0]))?`${a.length==Object.keys(e).length?"Everyone":"Viewers that can request"} will get ${a[0]} ${1==a[0]?"request":"requests"}.`:n.join(" - ")}`:elements.whoCanRequest.innerHTML='<span class="text-danger">No one will be able to request</span>'}function checkCommands(){let e=[elements.requestCommand,elements.requestCommandAlias,elements.voteskipCommand,elements.voteskipCommandAlias,elements.songCommand,elements.songCommandAlias,elements.playlistCommand,elements.playlistCommandAlias,elements.openCommand,elements.closeCommand,elements.playCommand,elements.pauseCommand,elements.autoplayCommand,elements.skipCommand,elements.rewindCommand,elements.deleteCommand],t=e.map((e=>e.value.replace(/\s+/g,"").toLowerCase())),n=t.filter(((e,n)=>t.indexOf(e.replace(/\s+/g,"").toLowerCase())!==n)),a=e.filter((e=>n.includes(e.value.replace(/\s+/g,"").toLowerCase()))),o=!1;for(let e=0;e<a.length;e++)a[e].value=a[e].dataset.default,PLAYLIST[a[e].id]=a[e].dataset.default,o=!0;o&&showToast("Commands must be unique","warning",2e3)}function editRequestCommand(e=!1){settingsOffcanvas.show(),setTimeout((()=>{e?(elements.requestCommandAlias.focus(),elements.requestCommandAlias.select()):(elements.requestCommand.focus(),elements.requestCommand.select())}),500)}function toggleMute(){"volume_off"==elements.volumeSliderIcon.innerHTML?(0==oldSliderValue&&(elements.volumeSliderIcon.innerHTML="volume_mute"),oldSliderValue>0&&oldSliderValue<50&&(elements.volumeSliderIcon.innerHTML="volume_down"),oldSliderValue>=50&&(elements.volumeSliderIcon.innerHTML="volume_up"),elements.volumeSlider.value=oldSliderValue,elements.volumeSliderValue.innerHTML=oldSliderValue):(oldSliderValue=elements.volumeSlider.value,elements.volumeSliderIcon.innerHTML="volume_off",elements.volumeSlider.value=0,elements.volumeSliderValue.innerHTML=0)}function changeVolume(e){elements.volumeSliderValue.innerHTML=e.value,0==e.value&&(elements.volumeSliderIcon.innerHTML="volume_mute"),e.value>0&&e.value<50&&(elements.volumeSliderIcon.innerHTML="volume_down"),e.value>=50&&(elements.volumeSliderIcon.innerHTML="volume_up")}function togglePlaylist(){checkLogin()&&(playlist_open=!playlist_open,playlist_open?(elements.togglePlaylist.classList="btn btn-danger",elements.togglePlaylist.innerHTML='<i class="material-icons notranslate">playlist_remove</i> Close Playlist'):(elements.togglePlaylist.classList="btn btn-success",elements.togglePlaylist.innerHTML='<i class="material-icons notranslate">playlist_add_check</i> Open Playlist'))}function openPlaylist(e){playlist_open?botReply("âœ… The playlist already open",e,!1):(playlist_open=!0,elements.togglePlaylist.classList="btn btn-danger",elements.togglePlaylist.innerHTML="Close Playlist",botReply("âœ… The playlist is now open",e,!1))}function closePlaylist(e){playlist_open?(playlist_open=!1,elements.togglePlaylist.classList="btn btn-success",elements.togglePlaylist.innerHTML="Open Playlist",botReply("â›” The playlist is now closed",e,!1)):botReply("â›” The playlist already closed",e,!1)}function playPlaylist(e){if(!currentItem)return void botReply("âš  Nothing is playing",e,!1);let t=!1;switch(currentItem.type){case"youtube":case"youtube short":youtubePlayer.playVideo();break;case"vimeo":vimeoPlayer.play();break;case"spotify":spotifyPlayer.resume();break;case"twitch stream":case"twitch vod":twitchPlayer.play();break;case"twitch clip":currentItem?.mp4&&Date.now()-currentItem.time<684e5&&(elements.videoEmbed.play(),t=!0);break;case"tiktok video":document.getElementById("tiktokIframe").contentWindow.postMessage({type:"play","x-tiktok-player":!0},"*");break;case"streamable":elements.videoEmbed.play();break;default:break}e&&(t||"twitch clip"!=currentItem.type?botReply("â–¶ Playlist is now playing",e,!1):botReply("âš  Twitch clip playback can't be controlled",e,!1))}function pausePlaylist(e){if(!currentItem)return void botReply("âš  Nothing is playing",e,!1);let t=!1;switch(currentItem.type){case"youtube":case"youtube short":youtubePlayer.pauseVideo();break;case"vimeo":vimeoPlayer.pause();break;case"spotify":spotifyPlayer.pause();break;case"twitch stream":case"twitch vod":twitchPlayer.pause();break;case"twitch clip":currentItem?.mp4&&Date.now()-currentItem.time<684e5&&(elements.videoEmbed.pause(),t=!0);break;case"tiktok video":document.getElementById("tiktokIframe").contentWindow.postMessage({type:"pause","x-tiktok-player":!0},"*");break;case"streamable":elements.videoEmbed.pause();break;default:break}e&&(t||"twitch clip"!=currentItem.type?botReply("â¸ Playlist is now paused",e,!1):botReply("âš  Twitch clip playback can't be controlled",e,!1))}function toggleAutoplay(e){let t=elements.autoplay.checked;elements.autoplay.checked=!t,botReply(`${t?"âŒ":"âœ…"} autoplay is now ${t?"disabled":"enabled"}`,e,!1),saveSettings()}function onYouTubeIframeAPIReady(){console.log("onYouTubeIframeAPIReady"),youtubePlayer=new YT.Player("youtubeEmbed",{height:"100%",width:"100%",playerVars:{autoplay:1,enablejsapi:1,playsinline:1,fs:0,rel:0,origin:"chat.vote"},events:{onStateChange:youtubePlayerOnStateChange,onError:youtubePlayerOnError,onAutoplayBlocked:youtubePlayerOnAutoplayBlocked}})}function youtubePlayerOnStateChange(e){console.log(e),e.data==YT.PlayerState.ENDED&&PLAYLIST.autoplay&&nextItem()}function youtubePlayerOnError(e){console.log(e)}function youtubePlayerOnAutoplayBlocked(e){console.log(e)}function spotifyPlay(e,t){spotifyIFrameAPI.createController(document.getElementById("spotifyEmbed"),{},(e=>{spotifyPlayer=e,e.addListener("playback_update",(e=>{e.data.position==e.data.duration&&e.data.duration>0&&PLAYLIST.autoplay&&nextItem()}))})),spotifyPlayer.loadUri(e,!0,t),spotifyPlayer.play()}window.onload=function(){darkTheme="true"===(localStorage.getItem("darkTheme")||"true"),elements.darkTheme.checked=darkTheme??!0,switchTheme(elements.darkTheme.checked),loadAndConnect(),dankUpdateModal=new bootstrap.Modal(elements.dankUpdateModal),loginExpiredModal=new bootstrap.Modal(elements.loginExpiredModal),banlistModal=new bootstrap.Modal(elements.banlistModal),settingsOffcanvas=new bootstrap.Offcanvas(elements.settingsOffcanvas),copyLinkButton=new bootstrap.Popover(elements.copyLinkButton),togglePlaylistPopover=new bootstrap.Popover(elements.togglePlaylist),elements.banlistModal.addEventListener("show.bs.modal",(e=>{loadBanLists()})),enablePopovers();new bootstrap.Popover("#resetSettingsPopover",{trigger:"focus",html:!0,sanitize:!1,container:".offcanvas-body"});playlistTab=new bootstrap.Tab(elements.playlistTab),approvalTab=new bootstrap.Tab(elements.approvalTab),historyTab=new bootstrap.Tab(elements.historyTab),USER.channel||(loginButton=new bootstrap.Popover(elements.loginButton)),elements.darkTheme.onchange=function(){switchTheme(this.checked),saveSettings()},elements.approvalQueue.onchange=function(){saveSettings(),elements.approvalTab.classList.contains("active")&&playlistTab.show()},elements.selectAll.addEventListener("click",(e=>{toggleEveryone(!0),saveSettings()})),elements.unselectAll.addEventListener("click",(e=>{toggleEveryone(!1),saveSettings()})),elements.link.addEventListener("keydown",(async e=>{"Enter"===e.key&&await addLink()})),elements.link.addEventListener("focus",(async function(){!streamerColor&&USER.userID&&(streamerColor=await getStreamerColor(USER.userID))})),"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("previoustrack",(()=>{previousItem()})),navigator.mediaSession.setActionHandler("nexttrack",(()=>{nextItem()}))),enableTooltips(),enableTwitchEmbed(),videoEmbedEventListeners(),tiktokEmbedEventListeners()},window.onSpotifyIframeApiReady=e=>{spotifyIFrameAPI=e,console.log("onSpotifyIframeApiReady");spotifyIFrameAPI.createController(elements.spotifyEmbed,{},(e=>{spotifyPlayer=e,e.addListener("playback_update",(e=>{e.data.position==e.data.duration&&e.data.duration>0&&PLAYLIST.autoplay&&nextItem()}))}))};let vimeoPlayer,seekTwitchPlayer=!0;function enableTwitchEmbed(){twitchPlayer=new Twitch.Player("twitchEmbed",{width:"100%",height:"100%",channel:"chatvote",parent:["chat.vote"]}),twitchPlayer.addEventListener(Twitch.Player.ENDED,(function(e){PLAYLIST.autoplay&&nextItem()})),twitchPlayer.addEventListener(Twitch.Player.PLAYING,(function(e){seekTwitchPlayer&&(twitchPlayer.seek(currentItem.timestamp),seekTwitchPlayer=!1)}))}function videoEmbedEventListeners(){elements.videoEmbed.addEventListener("ended",(e=>{PLAYLIST.autoplay&&nextItem()})),elements.videoEmbed.addEventListener("loadstart",(e=>{elements.videoEmbed.currentTime=currentItem?.timestamp||0}))}function tiktokEmbedEventListeners(){window.addEventListener("message",(e=>{e?.data?.["x-tiktok-player"]&&("onStateChange"==e.data.type&&0==e.data.value&&nextItem(),"onPlayerReady"==e.data.type&&(document.getElementById("tiktokIframe").contentWindow.postMessage({type:"unMute","x-tiktok-player":!0},"*"),document.getElementById("tiktokIframe").contentWindow.postMessage({type:"seekTo",value:currentItem.timestamp,"x-tiktok-player":!0},"*")))}))}function playVimeoVideo(e,t){vimeoPlayer?(vimeoPlayer.loadVideo(e),setTimeout((()=>{vimeoPlayer.setCurrentTime(t)}),1e3)):(vimeoPlayer=new Vimeo.Player(elements.vimeoEmbed,{id:e,responsive:!0,speed:!0,autoplay:!0,start_time:t}),vimeoPlayer.on("ended",(e=>{PLAYLIST.autoplay&&nextItem()})))}